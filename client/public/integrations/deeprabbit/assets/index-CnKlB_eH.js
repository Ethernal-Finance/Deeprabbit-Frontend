(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var q;(function(i){i.assertEqual=s=>{};function e(s){}i.assertIs=e;function t(s){throw new Error}i.assertNever=t,i.arrayToEnum=s=>{const o={};for(const r of s)o[r]=r;return o},i.getValidEnumValues=s=>{const o=i.objectKeys(s).filter(c=>typeof s[s[c]]!="number"),r={};for(const c of o)r[c]=s[c];return i.objectValues(r)},i.objectValues=s=>i.objectKeys(s).map(function(o){return s[o]}),i.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const o=[];for(const r in s)Object.prototype.hasOwnProperty.call(s,r)&&o.push(r);return o},i.find=(s,o)=>{for(const r of s)if(o(r))return r},i.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,o=" | "){return s.map(r=>typeof r=="string"?`'${r}'`:r).join(o)}i.joinValues=n,i.jsonStringifyReplacer=(s,o)=>typeof o=="bigint"?o.toString():o})(q||(q={}));var Bi;(function(i){i.mergeShapes=(e,t)=>({...e,...t})})(Bi||(Bi={}));const T=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ee=i=>{switch(typeof i){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(i)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(i)?T.array:i===null?T.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?T.promise:typeof Map<"u"&&i instanceof Map?T.map:typeof Set<"u"&&i instanceof Set?T.set:typeof Date<"u"&&i instanceof Date?T.date:T.object;default:return T.unknown}},b=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ce extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(o){return o.message},n={_errors:[]},s=o=>{for(const r of o.issues)if(r.code==="invalid_union")r.unionErrors.map(s);else if(r.code==="invalid_return_type")s(r.returnTypeError);else if(r.code==="invalid_arguments")s(r.argumentsError);else if(r.path.length===0)n._errors.push(t(r));else{let c=n,u=0;for(;u<r.path.length;){const d=r.path[u];u===r.path.length-1?(c[d]=c[d]||{_errors:[]},c[d]._errors.push(t(r))):c[d]=c[d]||{_errors:[]},c=c[d],u++}}};return s(this),n}static assert(e){if(!(e instanceof Ce))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const s of this.issues)if(s.path.length>0){const o=s.path[0];t[o]=t[o]||[],t[o].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ce.create=i=>new Ce(i);const Zn=(i,e)=>{let t;switch(i.code){case b.invalid_type:i.received===T.undefined?t="Required":t=`Expected ${i.expected}, received ${i.received}`;break;case b.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(i.expected,q.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:t=`Unrecognized key(s) in object: ${q.joinValues(i.keys,", ")}`;break;case b.invalid_union:t="Invalid input";break;case b.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${q.joinValues(i.options)}`;break;case b.invalid_enum_value:t=`Invalid enum value. Expected ${q.joinValues(i.options)}, received '${i.received}'`;break;case b.invalid_arguments:t="Invalid function arguments";break;case b.invalid_return_type:t="Invalid function return type";break;case b.invalid_date:t="Invalid date";break;case b.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(t=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?t=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?t=`Invalid input: must end with "${i.validation.endsWith}"`:q.assertNever(i.validation):i.validation!=="regex"?t=`Invalid ${i.validation}`:t="Invalid";break;case b.too_small:i.type==="array"?t=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?t=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?t=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="bigint"?t=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?t=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:t="Invalid input";break;case b.too_big:i.type==="array"?t=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?t=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?t=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?t=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?t=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:t="Invalid input";break;case b.custom:t="Invalid input";break;case b.invalid_intersection_types:t="Intersection results could not be merged";break;case b.not_multiple_of:t=`Number must be a multiple of ${i.multipleOf}`;break;case b.not_finite:t="Number must be finite";break;default:t=e.defaultError,q.assertNever(i)}return{message:t}};let ga=Zn;function ma(){return ga}const ya=i=>{const{data:e,path:t,errorMaps:n,issueData:s}=i,o=[...t,...s.path||[]],r={...s,path:o};if(s.message!==void 0)return{...s,path:o,message:s.message};let c="";const u=n.filter(d=>!!d).slice().reverse();for(const d of u)c=d(r,{data:e,defaultError:c}).message;return{...s,path:o,message:c}};function x(i,e){const t=ma(),n=ya({issueData:e,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,t,t===Zn?void 0:Zn].filter(s=>!!s)});i.common.issues.push(n)}class ee{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const s of t){if(s.status==="aborted")return M;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const s of t){const o=await s.key,r=await s.value;n.push({key:o,value:r})}return ee.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const s of t){const{key:o,value:r}=s;if(o.status==="aborted"||r.status==="aborted")return M;o.status==="dirty"&&e.dirty(),r.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof r.value<"u"||s.alwaysSet)&&(n[o.value]=r.value)}return{status:e.value,value:n}}}const M=Object.freeze({status:"aborted"}),It=i=>({status:"dirty",value:i}),oe=i=>({status:"valid",value:i}),qi=i=>i.status==="aborted",Gi=i=>i.status==="dirty",ft=i=>i.status==="valid",ln=i=>typeof Promise<"u"&&i instanceof Promise;var E;(function(i){i.errToObj=e=>typeof e=="string"?{message:e}:e||{},i.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(E||(E={}));class ge{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Hi=(i,e)=>{if(ft(e))return{success:!0,data:e.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ce(i.common.issues);return this._error=t,this._error}}};function N(i){if(!i)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:s}=i;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(r,c)=>{const{message:u}=i;return r.code==="invalid_enum_value"?{message:u??c.defaultError}:typeof c.data>"u"?{message:u??n??c.defaultError}:r.code!=="invalid_type"?{message:c.defaultError}:{message:u??t??c.defaultError}},description:s}}class F{get description(){return this._def.description}_getType(e){return Ee(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ee(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ee,ctx:{common:e.parent.common,data:e.data,parsedType:Ee(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ln(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ee(e)},s=this._parseSync({data:e,path:n.path,parent:n});return Hi(n,s)}"~validate"(e){var n,s;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ee(e)};if(!this["~standard"].async)try{const o=this._parseSync({data:e,path:[],parent:t});return ft(o)?{value:o.value}:{issues:t.common.issues}}catch(o){(s=(n=o==null?void 0:o.message)==null?void 0:n.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(o=>ft(o)?{value:o.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ee(e)},s=this._parse({data:e,path:n.path,parent:n}),o=await(ln(s)?s:Promise.resolve(s));return Hi(n,o)}refine(e,t){const n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,o)=>{const r=e(s),c=()=>o.addIssue({code:b.custom,...n(s)});return typeof Promise<"u"&&r instanceof Promise?r.then(u=>u?!0:(c(),!1)):r?!0:(c(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new mt({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ie.create(this,this._def)}nullable(){return yt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return pe.create(this)}promise(){return fn.create(this,this._def)}or(e){return un.create([this,e],this._def)}and(e){return dn.create(this,e,this._def)}transform(e){return new mt({...N(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new ei({...N(this._def),innerType:this,defaultValue:t,typeName:I.ZodDefault})}brand(){return new Va({typeName:I.ZodBranded,type:this,...N(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new ti({...N(this._def),innerType:this,catchValue:t,typeName:I.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Si.create(this,e)}readonly(){return ni.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const va=/^c[^\s-]{8,}$/i,_a=/^[0-9a-z]+$/,wa=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ba=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ca=/^[a-z0-9_-]{21}$/i,xa=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ta=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Sa=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ea="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Dn;const Aa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ka=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ia=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ma=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Pa=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ra=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ar="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Da=new RegExp(`^${ar}$`);function lr(i){let e="[0-5]\\d";i.precision?e=`${e}\\.\\d{${i.precision}}`:i.precision==null&&(e=`${e}(\\.\\d+)?`);const t=i.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function $a(i){return new RegExp(`^${lr(i)}$`)}function Na(i){let e=`${ar}T${lr(i)}`;const t=[];return t.push(i.local?"Z?":"Z"),i.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function La(i,e){return!!((e==="v4"||!e)&&Aa.test(i)||(e==="v6"||!e)&&Ia.test(i))}function Oa(i,e){if(!xa.test(i))return!1;try{const[t]=i.split(".");if(!t)return!1;const n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Ua(i,e){return!!((e==="v4"||!e)&&ka.test(i)||(e==="v6"||!e)&&Ma.test(i))}class fe extends F{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){const o=this._getOrReturnCtx(e);return x(o,{code:b.invalid_type,expected:T.string,received:o.parsedType}),M}const n=new ee;let s;for(const o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(s=this._getOrReturnCtx(e,s),x(s,{code:b.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="max")e.data.length>o.value&&(s=this._getOrReturnCtx(e,s),x(s,{code:b.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),n.dirty());else if(o.kind==="length"){const r=e.data.length>o.value,c=e.data.length<o.value;(r||c)&&(s=this._getOrReturnCtx(e,s),r?x(s,{code:b.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):c&&x(s,{code:b.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),n.dirty())}else if(o.kind==="email")Sa.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"email",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="emoji")Dn||(Dn=new RegExp(Ea,"u")),Dn.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"emoji",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="uuid")ba.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"uuid",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="nanoid")Ca.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"nanoid",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid")va.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"cuid",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="cuid2")_a.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"cuid2",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="ulid")wa.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"ulid",code:b.invalid_string,message:o.message}),n.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),x(s,{validation:"url",code:b.invalid_string,message:o.message}),n.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"regex",code:b.invalid_string,message:o.message}),n.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(s=this._getOrReturnCtx(e,s),x(s,{code:b.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),n.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(s=this._getOrReturnCtx(e,s),x(s,{code:b.invalid_string,validation:{startsWith:o.value},message:o.message}),n.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(s=this._getOrReturnCtx(e,s),x(s,{code:b.invalid_string,validation:{endsWith:o.value},message:o.message}),n.dirty()):o.kind==="datetime"?Na(o).test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:b.invalid_string,validation:"datetime",message:o.message}),n.dirty()):o.kind==="date"?Da.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:b.invalid_string,validation:"date",message:o.message}),n.dirty()):o.kind==="time"?$a(o).test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{code:b.invalid_string,validation:"time",message:o.message}),n.dirty()):o.kind==="duration"?Ta.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"duration",code:b.invalid_string,message:o.message}),n.dirty()):o.kind==="ip"?La(e.data,o.version)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"ip",code:b.invalid_string,message:o.message}),n.dirty()):o.kind==="jwt"?Oa(e.data,o.alg)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"jwt",code:b.invalid_string,message:o.message}),n.dirty()):o.kind==="cidr"?Ua(e.data,o.version)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"cidr",code:b.invalid_string,message:o.message}),n.dirty()):o.kind==="base64"?Pa.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"base64",code:b.invalid_string,message:o.message}),n.dirty()):o.kind==="base64url"?Ra.test(e.data)||(s=this._getOrReturnCtx(e,s),x(s,{validation:"base64url",code:b.invalid_string,message:o.message}),n.dirty()):q.assertNever(o);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:b.invalid_string,...E.errToObj(n)})}_addCheck(e){return new fe({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...E.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...E.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...E.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...E.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...E.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...E.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...E.errToObj(t)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new fe({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new fe({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new fe({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}fe.create=i=>new fe({checks:[],typeName:I.ZodString,coerce:(i==null?void 0:i.coerce)??!1,...N(i)});function Fa(i,e){const t=(i.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,o=Number.parseInt(i.toFixed(s).replace(".","")),r=Number.parseInt(e.toFixed(s).replace(".",""));return o%r/10**s}class He extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){const o=this._getOrReturnCtx(e);return x(o,{code:b.invalid_type,expected:T.number,received:o.parsedType}),M}let n;const s=new ee;for(const o of this._def.checks)o.kind==="int"?q.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),x(n,{code:b.invalid_type,expected:"integer",received:"float",message:o.message}),s.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),x(n,{code:b.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),x(n,{code:b.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),s.dirty()):o.kind==="multipleOf"?Fa(e.data,o.value)!==0&&(n=this._getOrReturnCtx(e,n),x(n,{code:b.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),x(n,{code:b.not_finite,message:o.message}),s.dirty()):q.assertNever(o);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,E.toString(t))}gt(e,t){return this.setLimit("min",e,!1,E.toString(t))}lte(e,t){return this.setLimit("max",e,!0,E.toString(t))}lt(e,t){return this.setLimit("max",e,!1,E.toString(t))}setLimit(e,t,n,s){return new He({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:E.toString(s)}]})}_addCheck(e){return new He({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:E.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&q.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}He.create=i=>new He({checks:[],typeName:I.ZodNumber,coerce:(i==null?void 0:i.coerce)||!1,...N(i)});class We extends F{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let n;const s=new ee;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(n=this._getOrReturnCtx(e,n),x(n,{code:b.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(n=this._getOrReturnCtx(e,n),x(n,{code:b.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),s.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),x(n,{code:b.not_multiple_of,multipleOf:o.value,message:o.message}),s.dirty()):q.assertNever(o);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return x(t,{code:b.invalid_type,expected:T.bigint,received:t.parsedType}),M}gte(e,t){return this.setLimit("min",e,!0,E.toString(t))}gt(e,t){return this.setLimit("min",e,!1,E.toString(t))}lte(e,t){return this.setLimit("max",e,!0,E.toString(t))}lt(e,t){return this.setLimit("max",e,!1,E.toString(t))}setLimit(e,t,n,s){return new We({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:E.toString(s)}]})}_addCheck(e){return new We({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}We.create=i=>new We({checks:[],typeName:I.ZodBigInt,coerce:(i==null?void 0:i.coerce)??!1,...N(i)});class cn extends F{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==T.boolean){const n=this._getOrReturnCtx(e);return x(n,{code:b.invalid_type,expected:T.boolean,received:n.parsedType}),M}return oe(e.data)}}cn.create=i=>new cn({typeName:I.ZodBoolean,coerce:(i==null?void 0:i.coerce)||!1,...N(i)});class pt extends F{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){const o=this._getOrReturnCtx(e);return x(o,{code:b.invalid_type,expected:T.date,received:o.parsedType}),M}if(Number.isNaN(e.data.getTime())){const o=this._getOrReturnCtx(e);return x(o,{code:b.invalid_date}),M}const n=new ee;let s;for(const o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(s=this._getOrReturnCtx(e,s),x(s,{code:b.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),n.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(s=this._getOrReturnCtx(e,s),x(s,{code:b.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),n.dirty()):q.assertNever(o);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new pt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}pt.create=i=>new pt({checks:[],coerce:(i==null?void 0:i.coerce)||!1,typeName:I.ZodDate,...N(i)});class Wi extends F{_parse(e){if(this._getType(e)!==T.symbol){const n=this._getOrReturnCtx(e);return x(n,{code:b.invalid_type,expected:T.symbol,received:n.parsedType}),M}return oe(e.data)}}Wi.create=i=>new Wi({typeName:I.ZodSymbol,...N(i)});class zi extends F{_parse(e){if(this._getType(e)!==T.undefined){const n=this._getOrReturnCtx(e);return x(n,{code:b.invalid_type,expected:T.undefined,received:n.parsedType}),M}return oe(e.data)}}zi.create=i=>new zi({typeName:I.ZodUndefined,...N(i)});class Ji extends F{_parse(e){if(this._getType(e)!==T.null){const n=this._getOrReturnCtx(e);return x(n,{code:b.invalid_type,expected:T.null,received:n.parsedType}),M}return oe(e.data)}}Ji.create=i=>new Ji({typeName:I.ZodNull,...N(i)});class Ki extends F{constructor(){super(...arguments),this._any=!0}_parse(e){return oe(e.data)}}Ki.create=i=>new Ki({typeName:I.ZodAny,...N(i)});class Xn extends F{constructor(){super(...arguments),this._unknown=!0}_parse(e){return oe(e.data)}}Xn.create=i=>new Xn({typeName:I.ZodUnknown,...N(i)});class Pe extends F{_parse(e){const t=this._getOrReturnCtx(e);return x(t,{code:b.invalid_type,expected:T.never,received:t.parsedType}),M}}Pe.create=i=>new Pe({typeName:I.ZodNever,...N(i)});class Yi extends F{_parse(e){if(this._getType(e)!==T.undefined){const n=this._getOrReturnCtx(e);return x(n,{code:b.invalid_type,expected:T.void,received:n.parsedType}),M}return oe(e.data)}}Yi.create=i=>new Yi({typeName:I.ZodVoid,...N(i)});class pe extends F{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==T.array)return x(t,{code:b.invalid_type,expected:T.array,received:t.parsedType}),M;if(s.exactLength!==null){const r=t.data.length>s.exactLength.value,c=t.data.length<s.exactLength.value;(r||c)&&(x(t,{code:r?b.too_big:b.too_small,minimum:c?s.exactLength.value:void 0,maximum:r?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(x(t,{code:b.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(x(t,{code:b.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((r,c)=>s.type._parseAsync(new ge(t,r,t.path,c)))).then(r=>ee.mergeArray(n,r));const o=[...t.data].map((r,c)=>s.type._parseSync(new ge(t,r,t.path,c)));return ee.mergeArray(n,o)}get element(){return this._def.type}min(e,t){return new pe({...this._def,minLength:{value:e,message:E.toString(t)}})}max(e,t){return new pe({...this._def,maxLength:{value:e,message:E.toString(t)}})}length(e,t){return new pe({...this._def,exactLength:{value:e,message:E.toString(t)}})}nonempty(e){return this.min(1,e)}}pe.create=(i,e)=>new pe({type:i,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...N(e)});function lt(i){if(i instanceof K){const e={};for(const t in i.shape){const n=i.shape[t];e[t]=Ie.create(lt(n))}return new K({...i._def,shape:()=>e})}else return i instanceof pe?new pe({...i._def,type:lt(i.element)}):i instanceof Ie?Ie.create(lt(i.unwrap())):i instanceof yt?yt.create(lt(i.unwrap())):i instanceof ze?ze.create(i.items.map(e=>lt(e))):i}class K extends F{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=q.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==T.object){const d=this._getOrReturnCtx(e);return x(d,{code:b.invalid_type,expected:T.object,received:d.parsedType}),M}const{status:n,ctx:s}=this._processInputParams(e),{shape:o,keys:r}=this._getCached(),c=[];if(!(this._def.catchall instanceof Pe&&this._def.unknownKeys==="strip"))for(const d in s.data)r.includes(d)||c.push(d);const u=[];for(const d of r){const h=o[d],f=s.data[d];u.push({key:{status:"valid",value:d},value:h._parse(new ge(s,f,s.path,d)),alwaysSet:d in s.data})}if(this._def.catchall instanceof Pe){const d=this._def.unknownKeys;if(d==="passthrough")for(const h of c)u.push({key:{status:"valid",value:h},value:{status:"valid",value:s.data[h]}});else if(d==="strict")c.length>0&&(x(s,{code:b.unrecognized_keys,keys:c}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const h of c){const f=s.data[h];u.push({key:{status:"valid",value:h},value:d._parse(new ge(s,f,s.path,h)),alwaysSet:h in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const d=[];for(const h of u){const f=await h.key,p=await h.value;d.push({key:f,value:p,alwaysSet:h.alwaysSet})}return d}).then(d=>ee.mergeObjectSync(n,d)):ee.mergeObjectSync(n,u)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new K({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var o,r;const s=((r=(o=this._def).errorMap)==null?void 0:r.call(o,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:E.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new K({...this._def,unknownKeys:"strip"})}passthrough(){return new K({...this._def,unknownKeys:"passthrough"})}extend(e){return new K({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new K({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new K({...this._def,catchall:e})}pick(e){const t={};for(const n of q.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new K({...this._def,shape:()=>t})}omit(e){const t={};for(const n of q.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new K({...this._def,shape:()=>t})}deepPartial(){return lt(this)}partial(e){const t={};for(const n of q.objectKeys(this.shape)){const s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new K({...this._def,shape:()=>t})}required(e){const t={};for(const n of q.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let o=this.shape[n];for(;o instanceof Ie;)o=o._def.innerType;t[n]=o}return new K({...this._def,shape:()=>t})}keyof(){return cr(q.objectKeys(this.shape))}}K.create=(i,e)=>new K({shape:()=>i,unknownKeys:"strip",catchall:Pe.create(),typeName:I.ZodObject,...N(e)});K.strictCreate=(i,e)=>new K({shape:()=>i,unknownKeys:"strict",catchall:Pe.create(),typeName:I.ZodObject,...N(e)});K.lazycreate=(i,e)=>new K({shape:i,unknownKeys:"strip",catchall:Pe.create(),typeName:I.ZodObject,...N(e)});class un extends F{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function s(o){for(const c of o)if(c.result.status==="valid")return c.result;for(const c of o)if(c.result.status==="dirty")return t.common.issues.push(...c.ctx.common.issues),c.result;const r=o.map(c=>new Ce(c.ctx.common.issues));return x(t,{code:b.invalid_union,unionErrors:r}),M}if(t.common.async)return Promise.all(n.map(async o=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await o._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(s);{let o;const r=[];for(const u of n){const d={...t,common:{...t.common,issues:[]},parent:null},h=u._parseSync({data:t.data,path:t.path,parent:d});if(h.status==="valid")return h;h.status==="dirty"&&!o&&(o={result:h,ctx:d}),d.common.issues.length&&r.push(d.common.issues)}if(o)return t.common.issues.push(...o.ctx.common.issues),o.result;const c=r.map(u=>new Ce(u));return x(t,{code:b.invalid_union,unionErrors:c}),M}}get options(){return this._def.options}}un.create=(i,e)=>new un({options:i,typeName:I.ZodUnion,...N(e)});function Qn(i,e){const t=Ee(i),n=Ee(e);if(i===e)return{valid:!0,data:i};if(t===T.object&&n===T.object){const s=q.objectKeys(e),o=q.objectKeys(i).filter(c=>s.indexOf(c)!==-1),r={...i,...e};for(const c of o){const u=Qn(i[c],e[c]);if(!u.valid)return{valid:!1};r[c]=u.data}return{valid:!0,data:r}}else if(t===T.array&&n===T.array){if(i.length!==e.length)return{valid:!1};const s=[];for(let o=0;o<i.length;o++){const r=i[o],c=e[o],u=Qn(r,c);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===T.date&&n===T.date&&+i==+e?{valid:!0,data:i}:{valid:!1}}class dn extends F{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=(o,r)=>{if(qi(o)||qi(r))return M;const c=Qn(o.value,r.value);return c.valid?((Gi(o)||Gi(r))&&t.dirty(),{status:t.value,value:c.data}):(x(n,{code:b.invalid_intersection_types}),M)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([o,r])=>s(o,r)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}dn.create=(i,e,t)=>new dn({left:i,right:e,typeName:I.ZodIntersection,...N(t)});class ze extends F{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.array)return x(n,{code:b.invalid_type,expected:T.array,received:n.parsedType}),M;if(n.data.length<this._def.items.length)return x(n,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),M;!this._def.rest&&n.data.length>this._def.items.length&&(x(n,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const o=[...n.data].map((r,c)=>{const u=this._def.items[c]||this._def.rest;return u?u._parse(new ge(n,r,n.path,c)):null}).filter(r=>!!r);return n.common.async?Promise.all(o).then(r=>ee.mergeArray(t,r)):ee.mergeArray(t,o)}get items(){return this._def.items}rest(e){return new ze({...this._def,rest:e})}}ze.create=(i,e)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ze({items:i,typeName:I.ZodTuple,rest:null,...N(e)})};class hn extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.object)return x(n,{code:b.invalid_type,expected:T.object,received:n.parsedType}),M;const s=[],o=this._def.keyType,r=this._def.valueType;for(const c in n.data)s.push({key:o._parse(new ge(n,c,n.path,c)),value:r._parse(new ge(n,n.data[c],n.path,c)),alwaysSet:c in n.data});return n.common.async?ee.mergeObjectAsync(t,s):ee.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof F?new hn({keyType:e,valueType:t,typeName:I.ZodRecord,...N(n)}):new hn({keyType:fe.create(),valueType:e,typeName:I.ZodRecord,...N(t)})}}class Zi extends F{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.map)return x(n,{code:b.invalid_type,expected:T.map,received:n.parsedType}),M;const s=this._def.keyType,o=this._def.valueType,r=[...n.data.entries()].map(([c,u],d)=>({key:s._parse(new ge(n,c,n.path,[d,"key"])),value:o._parse(new ge(n,u,n.path,[d,"value"]))}));if(n.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const u of r){const d=await u.key,h=await u.value;if(d.status==="aborted"||h.status==="aborted")return M;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),c.set(d.value,h.value)}return{status:t.value,value:c}})}else{const c=new Map;for(const u of r){const d=u.key,h=u.value;if(d.status==="aborted"||h.status==="aborted")return M;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),c.set(d.value,h.value)}return{status:t.value,value:c}}}}Zi.create=(i,e,t)=>new Zi({valueType:e,keyType:i,typeName:I.ZodMap,...N(t)});class Ft extends F{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==T.set)return x(n,{code:b.invalid_type,expected:T.set,received:n.parsedType}),M;const s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(x(n,{code:b.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(x(n,{code:b.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const o=this._def.valueType;function r(u){const d=new Set;for(const h of u){if(h.status==="aborted")return M;h.status==="dirty"&&t.dirty(),d.add(h.value)}return{status:t.value,value:d}}const c=[...n.data.values()].map((u,d)=>o._parse(new ge(n,u,n.path,d)));return n.common.async?Promise.all(c).then(u=>r(u)):r(c)}min(e,t){return new Ft({...this._def,minSize:{value:e,message:E.toString(t)}})}max(e,t){return new Ft({...this._def,maxSize:{value:e,message:E.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ft.create=(i,e)=>new Ft({valueType:i,minSize:null,maxSize:null,typeName:I.ZodSet,...N(e)});class jn extends F{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}jn.create=(i,e)=>new jn({getter:i,typeName:I.ZodLazy,...N(e)});class Xi extends F{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return x(t,{received:t.data,code:b.invalid_literal,expected:this._def.value}),M}return{status:"valid",value:e.data}}get value(){return this._def.value}}Xi.create=(i,e)=>new Xi({value:i,typeName:I.ZodLiteral,...N(e)});function cr(i,e){return new gt({values:i,typeName:I.ZodEnum,...N(e)})}class gt extends F{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return x(t,{expected:q.joinValues(n),received:t.parsedType,code:b.invalid_type}),M}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return x(t,{received:t.data,code:b.invalid_enum_value,options:n}),M}return oe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return gt.create(e,{...this._def,...t})}exclude(e,t=this._def){return gt.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}gt.create=cr;class Qi extends F{_parse(e){const t=q.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==T.string&&n.parsedType!==T.number){const s=q.objectValues(t);return x(n,{expected:q.joinValues(s),received:n.parsedType,code:b.invalid_type}),M}if(this._cache||(this._cache=new Set(q.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=q.objectValues(t);return x(n,{received:n.data,code:b.invalid_enum_value,options:s}),M}return oe(e.data)}get enum(){return this._def.values}}Qi.create=(i,e)=>new Qi({values:i,typeName:I.ZodNativeEnum,...N(e)});class fn extends F{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.promise&&t.common.async===!1)return x(t,{code:b.invalid_type,expected:T.promise,received:t.parsedType}),M;const n=t.parsedType===T.promise?t.data:Promise.resolve(t.data);return oe(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}fn.create=(i,e)=>new fn({type:i,typeName:I.ZodPromise,...N(e)});class mt extends F{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,o={addIssue:r=>{x(n,r),r.fatal?t.abort():t.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),s.type==="preprocess"){const r=s.transform(n.data,o);if(n.common.async)return Promise.resolve(r).then(async c=>{if(t.value==="aborted")return M;const u=await this._def.schema._parseAsync({data:c,path:n.path,parent:n});return u.status==="aborted"?M:u.status==="dirty"||t.value==="dirty"?It(u.value):u});{if(t.value==="aborted")return M;const c=this._def.schema._parseSync({data:r,path:n.path,parent:n});return c.status==="aborted"?M:c.status==="dirty"||t.value==="dirty"?It(c.value):c}}if(s.type==="refinement"){const r=c=>{const u=s.refinement(c,o);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(n.common.async===!1){const c=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return c.status==="aborted"?M:(c.status==="dirty"&&t.dirty(),r(c.value),{status:t.value,value:c.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(c=>c.status==="aborted"?M:(c.status==="dirty"&&t.dirty(),r(c.value).then(()=>({status:t.value,value:c.value}))))}if(s.type==="transform")if(n.common.async===!1){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!ft(r))return M;const c=s.transform(r.value,o);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:c}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(r=>ft(r)?Promise.resolve(s.transform(r.value,o)).then(c=>({status:t.value,value:c})):M);q.assertNever(s)}}mt.create=(i,e,t)=>new mt({schema:i,typeName:I.ZodEffects,effect:e,...N(t)});mt.createWithPreprocess=(i,e,t)=>new mt({schema:e,effect:{type:"preprocess",transform:i},typeName:I.ZodEffects,...N(t)});class Ie extends F{_parse(e){return this._getType(e)===T.undefined?oe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ie.create=(i,e)=>new Ie({innerType:i,typeName:I.ZodOptional,...N(e)});class yt extends F{_parse(e){return this._getType(e)===T.null?oe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}yt.create=(i,e)=>new yt({innerType:i,typeName:I.ZodNullable,...N(e)});class ei extends F{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===T.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ei.create=(i,e)=>new ei({innerType:i,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...N(e)});class ti extends F{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return ln(s)?s.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Ce(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ce(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}ti.create=(i,e)=>new ti({innerType:i,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...N(e)});class ji extends F{_parse(e){if(this._getType(e)!==T.nan){const n=this._getOrReturnCtx(e);return x(n,{code:b.invalid_type,expected:T.nan,received:n.parsedType}),M}return{status:"valid",value:e.data}}}ji.create=i=>new ji({typeName:I.ZodNaN,...N(i)});class Va extends F{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Si extends F{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?M:o.status==="dirty"?(t.dirty(),It(o.value)):this._def.out._parseAsync({data:o.value,path:n.path,parent:n})})();{const s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?M:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new Si({in:e,out:t,typeName:I.ZodPipeline})}}class ni extends F{_parse(e){const t=this._def.innerType._parse(e),n=s=>(ft(s)&&(s.value=Object.freeze(s.value)),s);return ln(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}}ni.create=(i,e)=>new ni({innerType:i,typeName:I.ZodReadonly,...N(e)});var I;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(I||(I={}));const Le=fe.create,es=He.create;We.create;const Ba=cn.create;pt.create;const ts=Xn.create;Pe.create;const Mt=pe.create,qa=K.create,Ga=un.create;dn.create;ze.create;const Ha=hn.create,Wa=jn.create,za=gt.create;fn.create;Ie.create;yt.create;const Xe={string:i=>fe.create({...i,coerce:!0}),number:i=>He.create({...i,coerce:!0}),boolean:i=>cn.create({...i,coerce:!0}),bigint:i=>We.create({...i,coerce:!0}),date:i=>pt.create({...i,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Ja,Ka;function Ya(){return{geminiUrl:Ja,vertexUrl:Ka}}function Za(i,e,t){var n,s,o;if(!(!((n=i.httpOptions)===null||n===void 0)&&n.baseUrl)){const r=Ya();return i.vertexai?(s=r.vertexUrl)!==null&&s!==void 0?s:e:(o=r.geminiUrl)!==null&&o!==void 0?o:t}return i.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ht{}function k(i,e){const t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const o=e[s];return o!=null?String(o):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function l(i,e,t){for(let o=0;o<e.length-1;o++){const r=e[o];if(r.endsWith("[]")){const c=r.slice(0,-2);if(!(c in i))if(Array.isArray(t))i[c]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${r}`);if(Array.isArray(i[c])){const u=i[c];if(Array.isArray(t))for(let d=0;d<u.length;d++){const h=u[d];l(h,e.slice(o+1),t[d])}else for(const d of u)l(d,e.slice(o+1),t)}return}else if(r.endsWith("[0]")){const c=r.slice(0,-3);c in i||(i[c]=[{}]);const u=i[c];l(u[0],e.slice(o+1),t);return}(!i[r]||typeof i[r]!="object")&&(i[r]={}),i=i[r]}const n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else i[n]=t}function a(i,e){try{if(e.length===1&&e[0]==="_self")return i;for(let t=0;t<e.length;t++){if(typeof i!="object"||i===null)return;const n=e[t];if(n.endsWith("[]")){const s=n.slice(0,-2);if(s in i){const o=i[s];return Array.isArray(o)?o.map(r=>a(r,e.slice(t+1))):void 0}else return}else i=i[n]}return i}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ns;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(ns||(ns={}));var is;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(is||(is={}));var ss;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(ss||(ss={}));var os;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(os||(os={}));var rs;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(rs||(rs={}));var he;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT"})(he||(he={}));var as;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(as||(as={}));var ls;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(ls||(ls={}));var cs;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY"})(cs||(cs={}));var us;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(us||(us={}));var ds;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ds||(ds={}));var hs;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(hs||(hs={}));var fs;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(fs||(fs={}));var pn;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(pn||(pn={}));var ps;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(ps||(ps={}));var ii;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(ii||(ii={}));var gs;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(gs||(gs={}));var ms;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(ms||(ms={}));var ys;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(ys||(ys={}));var vs;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(vs||(vs={}));var _s;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE"})(_s||(_s={}));var ws;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(ws||(ws={}));var bs;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(bs||(bs={}));var Cs;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})(Cs||(Cs={}));var xs;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi"})(xs||(xs={}));var Ts;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Ts||(Ts={}));var Ss;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Ss||(Ss={}));var Es;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Es||(Es={}));var As;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(As||(As={}));var ks;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(ks||(ks={}));var Is;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED"})(Is||(Is={}));var Ms;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(Ms||(Ms={}));var Ps;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Ps||(Ps={}));var Rs;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Rs||(Rs={}));var Ds;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(Ds||(Ds={}));var $s;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})($s||($s={}));var Ns;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(Ns||(Ns={}));var Ls;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Ls||(Ls={}));var Os;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY"})(Os||(Os={}));var ht;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(ht||(ht={}));class St{get text(){var e,t,n,s,o,r,c,u;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1;const f=[];for(const p of(u=(c=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)!==null&&u!==void 0?u:[]){for(const[g,m]of Object.entries(p))g!=="text"&&g!=="thought"&&(m!==null||m!==void 0)&&f.push(g);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;h=!0,d+=p.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,n,s,o,r,c,u;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const h=[];for(const f of(u=(c=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)!==null&&u!==void 0?u:[]){for(const[p,g]of Object.entries(f))p!=="inlineData"&&(g!==null||g!==void 0)&&h.push(p);f.inlineData&&typeof f.inlineData.data=="string"&&(d+=atob(f.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,n,s,o,r,c,u;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(u=(c=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,n,s,o,r,c,u,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const h=(u=(c=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,n,s,o,r,c,u,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const h=(u=(c=(r=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content)===null||c===void 0?void 0:c.parts)===null||u===void 0?void 0:u.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}}class Us{}class Fs{}class Xa{}class Qa{}class Vs{}class Bs{}class qs{}class ja{}class Gs{}class Hs{}class Ws{}class el{}class si{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class tl{}class nl{}class il{get text(){var e,t,n;let s="",o=!1;const r=[];for(const c of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[u,d]of Object.entries(c))u!=="text"&&u!=="thought"&&d!==null&&r.push(u);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;o=!0,s+=c.text}}return r.length>0&&console.warn(`there are non-text parts ${r} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?s:void 0}get data(){var e,t,n;let s="";const o=[];for(const r of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[c,u]of Object.entries(r))c!=="inlineData"&&u!==null&&o.push(c);r.inlineData&&typeof r.inlineData.data=="string"&&(s+=atob(r.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class sl{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function z(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function ur(i,e){const t=z(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function dr(i,e){return Array.isArray(e)?e.map(t=>gn(i,t)):[gn(i,e)]}function gn(i,e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function ol(i,e){const t=gn(i,e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function rl(i,e){const t=gn(i,e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function zs(i,e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function hr(i,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>zs(i,t)):[zs(i,e)]}function oi(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function Js(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function Ks(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function ne(i,e){if(e==null)throw new Error("ContentUnion is required");return oi(e)?e:{role:"user",parts:hr(i,e)}}function fr(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const n=ne(i,t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){const t=ne(i,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ne(i,t)):[ne(i,e)]}function ce(i,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(Js(e)||Ks(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ne(i,e)]}const t=[],n=[],s=oi(e[0]);for(const o of e){const r=oi(o);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)t.push(o);else{if(Js(o)||Ks(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return s||t.push({role:"user",parts:hr(i,n)}),t}const Ys=za(["string","number","integer","object","array","boolean","null"]),al=Ga([Ys,Mt(Ys)]);function ll(i=!0){const e=Wa(()=>{const t=qa({type:al.optional(),format:Le().optional(),title:Le().optional(),description:Le().optional(),default:ts().optional(),items:e.optional(),minItems:Xe.string().optional(),maxItems:Xe.string().optional(),enum:Mt(ts()).optional(),properties:Ha(Le(),e).optional(),required:Mt(Le()).optional(),minProperties:Xe.string().optional(),maxProperties:Xe.string().optional(),propertyOrdering:Mt(Le()).optional(),minimum:es().optional(),maximum:es().optional(),minLength:Xe.string().optional(),maxLength:Xe.string().optional(),pattern:Le().optional(),anyOf:Mt(e).optional(),additionalProperties:Ba().optional()});return i?t.strict():t});return e}function cl(i,e){i.includes("null")&&(e.nullable=!0);const t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.keys(he).includes(t[0].toUpperCase())?he[t[0].toUpperCase()]:he.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of t)e.anyOf.push({type:Object.keys(he).includes(n.toUpperCase())?he[n.toUpperCase()]:he.TYPE_UNSPECIFIED})}}function Rt(i){const e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=i.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,i=o[1]):o[1].type==="null"&&(e.nullable=!0,i=o[0])),i.type instanceof Array&&cl(i.type,e);for(const[r,c]of Object.entries(i))if(c!=null)if(r=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;e.type=Object.keys(he).includes(c.toUpperCase())?c.toUpperCase():he.TYPE_UNSPECIFIED}else if(t.includes(r))e[r]=Rt(c);else if(n.includes(r)){const u=[];for(const d of c){if(d.type=="null"){e.nullable=!0;continue}u.push(Rt(d))}e[r]=u}else if(s.includes(r)){const u={};for(const[d,h]of Object.entries(c))u[d]=Rt(h);e[r]=u}else{if(r==="additionalProperties")continue;e[r]=c}return e}function mn(i,e){if(Object.keys(e).includes("$schema")){delete e.$schema;const t=ll().parse(e);return Rt(t)}else return Rt(e)}function pr(i,e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function gr(i,e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Tn(i,e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(t.parameters=mn(i,t.parameters)),t.response&&(t.response=mn(i,t.response));return e}function Sn(i,e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const n of e)t.push(n);return t}function ul(i,e,t,n=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function De(i,e){if(typeof e!="string")throw new Error("name must be a string");return ul(i,e,"cachedContents")}function mr(i,e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function $e(i,e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}function dl(i){return i!=null&&typeof i=="object"&&"name"in i}function hl(i){return i!=null&&typeof i=="object"&&"video"in i}function fl(i){return i!=null&&typeof i=="object"&&"uri"in i}function yr(i,e){var t;let n;if(dl(e)&&(n=e.name),!(fl(e)&&(n=e.uri,n===void 0))&&!(hl(e)&&(n=(t=e.video)===null||t===void 0?void 0:t.uri,n===void 0))){if(typeof e=="string"&&(n=e),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function vr(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function _r(i,e){for(const t of["models","tunedModels","publisherModels"])if(pl(e,t))return e[t];return[]}function pl(i,e){return i!==null&&typeof i=="object"&&e in i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function gl(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function ml(i,e){const t={};if(a(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=a(e,["data"]);n!=null&&l(t,["data"],n);const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function yl(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],gl(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],ml(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function Zs(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>yl(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function vl(i,e){const t={},n=a(e,["behavior"]);n!=null&&l(t,["behavior"],n);const s=a(e,["description"]);s!=null&&l(t,["description"],s);const o=a(e,["name"]);o!=null&&l(t,["name"],o);const r=a(e,["parameters"]);r!=null&&l(t,["parameters"],r);const c=a(e,["response"]);return c!=null&&l(t,["response"],c),t}function _l(i,e){const t={},n=a(e,["startTime"]);n!=null&&l(t,["startTime"],n);const s=a(e,["endTime"]);return s!=null&&l(t,["endTime"],s),t}function wl(i,e){const t={},n=a(e,["timeRangeFilter"]);return n!=null&&l(t,["timeRangeFilter"],_l(i,n)),t}function bl(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["dynamicThreshold"]);return s!=null&&l(t,["dynamicThreshold"],s),t}function Cl(i,e){const t={},n=a(e,["dynamicRetrievalConfig"]);return n!=null&&l(t,["dynamicRetrievalConfig"],bl(i,n)),t}function xl(){return{}}function Tl(i,e){const t={},n=a(e,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>vl(i,d))),l(t,["functionDeclarations"],u)}if(a(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(e,["googleSearch"]);s!=null&&l(t,["googleSearch"],wl(i,s));const o=a(e,["googleSearchRetrieval"]);if(o!=null&&l(t,["googleSearchRetrieval"],Cl(i,o)),a(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(e,["urlContext"])!=null&&l(t,["urlContext"],xl());const c=a(e,["codeExecution"]);return c!=null&&l(t,["codeExecution"],c),t}function Sl(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["allowedFunctionNames"]);return s!=null&&l(t,["allowedFunctionNames"],s),t}function El(i,e){const t={},n=a(e,["latitude"]);n!=null&&l(t,["latitude"],n);const s=a(e,["longitude"]);return s!=null&&l(t,["longitude"],s),t}function Al(i,e){const t={},n=a(e,["latLng"]);return n!=null&&l(t,["latLng"],El(i,n)),t}function kl(i,e){const t={},n=a(e,["functionCallingConfig"]);n!=null&&l(t,["functionCallingConfig"],Sl(i,n));const s=a(e,["retrievalConfig"]);return s!=null&&l(t,["retrievalConfig"],Al(i,s)),t}function Il(i,e,t){const n={},s=a(e,["ttl"]);t!==void 0&&s!=null&&l(t,["ttl"],s);const o=a(e,["expireTime"]);t!==void 0&&o!=null&&l(t,["expireTime"],o);const r=a(e,["displayName"]);t!==void 0&&r!=null&&l(t,["displayName"],r);const c=a(e,["contents"]);if(t!==void 0&&c!=null){let f=ce(i,c);Array.isArray(f)&&(f=f.map(p=>Zs(i,p))),l(t,["contents"],f)}const u=a(e,["systemInstruction"]);t!==void 0&&u!=null&&l(t,["systemInstruction"],Zs(i,ne(i,u)));const d=a(e,["tools"]);if(t!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>Tl(i,p))),l(t,["tools"],f)}const h=a(e,["toolConfig"]);if(t!==void 0&&h!=null&&l(t,["toolConfig"],kl(i,h)),a(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function Ml(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["model"],ur(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],Il(i,s,t)),t}function Pl(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],De(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Rl(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],De(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Dl(i,e,t){const n={},s=a(e,["ttl"]);t!==void 0&&s!=null&&l(t,["ttl"],s);const o=a(e,["expireTime"]);return t!==void 0&&o!=null&&l(t,["expireTime"],o),n}function $l(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],De(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],Dl(i,s,t)),t}function Nl(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);return t!==void 0&&o!=null&&l(t,["_query","pageToken"],o),n}function Ll(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],Nl(i,n,t)),t}function Ol(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function Ul(i,e){const t={},n=a(e,["displayName"]);n!=null&&l(t,["displayName"],n);const s=a(e,["data"]);s!=null&&l(t,["data"],s);const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function Fl(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],Ol(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Ul(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function Xs(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Fl(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function Vl(i,e){const t={};if(a(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=a(e,["description"]);n!=null&&l(t,["description"],n);const s=a(e,["name"]);s!=null&&l(t,["name"],s);const o=a(e,["parameters"]);o!=null&&l(t,["parameters"],o);const r=a(e,["response"]);return r!=null&&l(t,["response"],r),t}function Bl(i,e){const t={},n=a(e,["startTime"]);n!=null&&l(t,["startTime"],n);const s=a(e,["endTime"]);return s!=null&&l(t,["endTime"],s),t}function ql(i,e){const t={},n=a(e,["timeRangeFilter"]);return n!=null&&l(t,["timeRangeFilter"],Bl(i,n)),t}function Gl(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["dynamicThreshold"]);return s!=null&&l(t,["dynamicThreshold"],s),t}function Hl(i,e){const t={},n=a(e,["dynamicRetrievalConfig"]);return n!=null&&l(t,["dynamicRetrievalConfig"],Gl(i,n)),t}function Wl(){return{}}function zl(i,e){const t={},n=a(e,["apiKeyString"]);return n!=null&&l(t,["apiKeyString"],n),t}function Jl(i,e){const t={},n=a(e,["apiKeyConfig"]);n!=null&&l(t,["apiKeyConfig"],zl(i,n));const s=a(e,["authType"]);s!=null&&l(t,["authType"],s);const o=a(e,["googleServiceAccountConfig"]);o!=null&&l(t,["googleServiceAccountConfig"],o);const r=a(e,["httpBasicAuthConfig"]);r!=null&&l(t,["httpBasicAuthConfig"],r);const c=a(e,["oauthConfig"]);c!=null&&l(t,["oauthConfig"],c);const u=a(e,["oidcConfig"]);return u!=null&&l(t,["oidcConfig"],u),t}function Kl(i,e){const t={},n=a(e,["authConfig"]);return n!=null&&l(t,["authConfig"],Jl(i,n)),t}function Yl(i,e){const t={},n=a(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(f=>Vl(i,f))),l(t,["functionDeclarations"],h)}const s=a(e,["retrieval"]);s!=null&&l(t,["retrieval"],s);const o=a(e,["googleSearch"]);o!=null&&l(t,["googleSearch"],ql(i,o));const r=a(e,["googleSearchRetrieval"]);r!=null&&l(t,["googleSearchRetrieval"],Hl(i,r)),a(e,["enterpriseWebSearch"])!=null&&l(t,["enterpriseWebSearch"],Wl());const u=a(e,["googleMaps"]);if(u!=null&&l(t,["googleMaps"],Kl(i,u)),a(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const d=a(e,["codeExecution"]);return d!=null&&l(t,["codeExecution"],d),t}function Zl(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["allowedFunctionNames"]);return s!=null&&l(t,["allowedFunctionNames"],s),t}function Xl(i,e){const t={},n=a(e,["latitude"]);n!=null&&l(t,["latitude"],n);const s=a(e,["longitude"]);return s!=null&&l(t,["longitude"],s),t}function Ql(i,e){const t={},n=a(e,["latLng"]);return n!=null&&l(t,["latLng"],Xl(i,n)),t}function jl(i,e){const t={},n=a(e,["functionCallingConfig"]);n!=null&&l(t,["functionCallingConfig"],Zl(i,n));const s=a(e,["retrievalConfig"]);return s!=null&&l(t,["retrievalConfig"],Ql(i,s)),t}function ec(i,e,t){const n={},s=a(e,["ttl"]);t!==void 0&&s!=null&&l(t,["ttl"],s);const o=a(e,["expireTime"]);t!==void 0&&o!=null&&l(t,["expireTime"],o);const r=a(e,["displayName"]);t!==void 0&&r!=null&&l(t,["displayName"],r);const c=a(e,["contents"]);if(t!==void 0&&c!=null){let p=ce(i,c);Array.isArray(p)&&(p=p.map(g=>Xs(i,g))),l(t,["contents"],p)}const u=a(e,["systemInstruction"]);t!==void 0&&u!=null&&l(t,["systemInstruction"],Xs(i,ne(i,u)));const d=a(e,["tools"]);if(t!==void 0&&d!=null){let p=d;Array.isArray(p)&&(p=p.map(g=>Yl(i,g))),l(t,["tools"],p)}const h=a(e,["toolConfig"]);t!==void 0&&h!=null&&l(t,["toolConfig"],jl(i,h));const f=a(e,["kmsKeyName"]);return t!==void 0&&f!=null&&l(t,["encryption_spec","kmsKeyName"],f),n}function tc(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["model"],ur(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],ec(i,s,t)),t}function nc(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],De(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function ic(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],De(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function sc(i,e,t){const n={},s=a(e,["ttl"]);t!==void 0&&s!=null&&l(t,["ttl"],s);const o=a(e,["expireTime"]);return t!==void 0&&o!=null&&l(t,["expireTime"],o),n}function oc(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],De(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],sc(i,s,t)),t}function rc(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);return t!==void 0&&o!=null&&l(t,["_query","pageToken"],o),n}function ac(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],rc(i,n,t)),t}function nn(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["displayName"]);s!=null&&l(t,["displayName"],s);const o=a(e,["model"]);o!=null&&l(t,["model"],o);const r=a(e,["createTime"]);r!=null&&l(t,["createTime"],r);const c=a(e,["updateTime"]);c!=null&&l(t,["updateTime"],c);const u=a(e,["expireTime"]);u!=null&&l(t,["expireTime"],u);const d=a(e,["usageMetadata"]);return d!=null&&l(t,["usageMetadata"],d),t}function lc(){return{}}function cc(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>nn(i,r))),l(t,["cachedContents"],o)}return t}function sn(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["displayName"]);s!=null&&l(t,["displayName"],s);const o=a(e,["model"]);o!=null&&l(t,["model"],o);const r=a(e,["createTime"]);r!=null&&l(t,["createTime"],r);const c=a(e,["updateTime"]);c!=null&&l(t,["updateTime"],c);const u=a(e,["expireTime"]);u!=null&&l(t,["expireTime"],u);const d=a(e,["usageMetadata"]);return d!=null&&l(t,["usageMetadata"],d),t}function uc(){return{}}function dc(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>sn(i,r))),l(t,["cachedContents"],o)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var vt;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(vt||(vt={}));class En{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let r={config:{}};n?typeof n=="object"?r=Object.assign({},n):r=n:r={config:{}},r.config&&(r.config.pageToken=t.nextPageToken),this.paramsInternal=r,this.pageInternalSize=(o=(s=r.config)===null||s===void 0?void 0:s.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hc extends Ht{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new En(vt.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=tc(this.apiClient,e);return c=k("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>sn(this.apiClient,h))}else{const d=Ml(this.apiClient,e);return c=k("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>nn(this.apiClient,h))}}async get(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=nc(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>sn(this.apiClient,h))}else{const d=Pl(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>nn(this.apiClient,h))}}async delete(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=ic(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(()=>{const h=uc(),f=new Hs;return Object.assign(f,h),f})}else{const d=Rl(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(()=>{const h=lc(),f=new Hs;return Object.assign(f,h),f})}}async update(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=oc(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>sn(this.apiClient,h))}else{const d=$l(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>nn(this.apiClient,h))}}async listInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=ac(this.apiClient,e);return c=k("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=dc(this.apiClient,h),p=new Ws;return Object.assign(p,f),p})}else{const d=Ll(this.apiClient,e);return c=k("cachedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=cc(this.apiClient,h),p=new Ws;return Object.assign(p,f),p})}}}function Qs(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(i){return this instanceof J?(this.v=i,this):new J(i)}function Dt(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",r),s[Symbol.asyncIterator]=function(){return this},s;function r(g){return function(m){return Promise.resolve(m).then(g,f)}}function c(g,m){n[g]&&(s[g]=function(y){return new Promise(function(v,w){o.push([g,y,v,w])>1||u(g,y)})},m&&(s[g]=m(s[g])))}function u(g,m){try{d(n[g](m))}catch(y){p(o[0][3],y)}}function d(g){g.value instanceof J?Promise.resolve(g.value.v).then(h,f):p(o[0][2],g)}function h(g){u("next",g)}function f(g){u("throw",g)}function p(g,m){g(m),o.shift(),o.length&&u(o[0][0],o[0][1])}}function on(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Qs=="function"?Qs(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=i[o]&&function(r){return new Promise(function(c,u){r=i[o](r),s(c,u,r.done,r.value)})}}function s(o,r,c,u){Promise.resolve(u).then(function(d){o({value:d,done:c})},r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fc(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;const t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:wr(t)}function wr(i){if(i.parts===void 0||i.parts.length===0)return!1;for(const e of i.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function pc(i){if(i.length!==0){for(const e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function js(i){if(i===void 0||i.length===0)return[];const e=[],t=i.length;let n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{const s=[];let o=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),o&&!wr(i[n])&&(o=!1),n++;o?e.push(...s):e.pop()}return e}class gc{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new mc(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class mc{constructor(e,t,n,s={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=o,this.sendPromise=Promise.resolve(),pc(o)}async sendMessage(e){var t;await this.sendPromise;const n=ne(this.apiClient,e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,r,c;const u=await s,d=(r=(o=u.candidates)===null||o===void 0?void 0:o[0])===null||r===void 0?void 0:r.content,h=u.automaticFunctionCallingHistory,f=this.getHistory(!0).length;let p=[];h!=null&&(p=(c=h.slice(f))!==null&&c!==void 0?c:[]);const g=d?[d]:[];this.recordHistory(n,g,p)})(),await this.sendPromise,s}async sendMessageStream(e){var t;await this.sendPromise;const n=ne(this.apiClient,e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const o=await s;return this.processStreamResponse(o,n)}getHistory(e=!1){const t=e?js(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var n,s;return Dt(this,arguments,function*(){var r,c,u,d;const h=[];try{for(var f=!0,p=on(e),g;g=yield J(p.next()),r=g.done,!r;f=!0){d=g.value,f=!1;const m=d;if(fc(m)){const y=(s=(n=m.candidates)===null||n===void 0?void 0:n[0])===null||s===void 0?void 0:s.content;y!==void 0&&h.push(y)}yield yield J(m)}}catch(m){c={error:m}}finally{try{!f&&!r&&(u=p.return)&&(yield J(u.call(p)))}finally{if(c)throw c.error}}this.recordHistory(t,h)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(o=>o.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...js(n)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yc(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);return t!==void 0&&o!=null&&l(t,["_query","pageToken"],o),n}function vc(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],yc(i,n,t)),t}function _c(i,e){const t={},n=a(e,["details"]);n!=null&&l(t,["details"],n);const s=a(e,["message"]);s!=null&&l(t,["message"],s);const o=a(e,["code"]);return o!=null&&l(t,["code"],o),t}function wc(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["displayName"]);s!=null&&l(t,["displayName"],s);const o=a(e,["mimeType"]);o!=null&&l(t,["mimeType"],o);const r=a(e,["sizeBytes"]);r!=null&&l(t,["sizeBytes"],r);const c=a(e,["createTime"]);c!=null&&l(t,["createTime"],c);const u=a(e,["expirationTime"]);u!=null&&l(t,["expirationTime"],u);const d=a(e,["updateTime"]);d!=null&&l(t,["updateTime"],d);const h=a(e,["sha256Hash"]);h!=null&&l(t,["sha256Hash"],h);const f=a(e,["uri"]);f!=null&&l(t,["uri"],f);const p=a(e,["downloadUri"]);p!=null&&l(t,["downloadUri"],p);const g=a(e,["state"]);g!=null&&l(t,["state"],g);const m=a(e,["source"]);m!=null&&l(t,["source"],m);const y=a(e,["videoMetadata"]);y!=null&&l(t,["videoMetadata"],y);const v=a(e,["error"]);return v!=null&&l(t,["error"],_c(i,v)),t}function bc(i,e){const t={},n=a(e,["file"]);n!=null&&l(t,["file"],wc(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Cc(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","file"],yr(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function xc(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","file"],yr(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Tc(i,e){const t={},n=a(e,["details"]);n!=null&&l(t,["details"],n);const s=a(e,["message"]);s!=null&&l(t,["message"],s);const o=a(e,["code"]);return o!=null&&l(t,["code"],o),t}function ri(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["displayName"]);s!=null&&l(t,["displayName"],s);const o=a(e,["mimeType"]);o!=null&&l(t,["mimeType"],o);const r=a(e,["sizeBytes"]);r!=null&&l(t,["sizeBytes"],r);const c=a(e,["createTime"]);c!=null&&l(t,["createTime"],c);const u=a(e,["expirationTime"]);u!=null&&l(t,["expirationTime"],u);const d=a(e,["updateTime"]);d!=null&&l(t,["updateTime"],d);const h=a(e,["sha256Hash"]);h!=null&&l(t,["sha256Hash"],h);const f=a(e,["uri"]);f!=null&&l(t,["uri"],f);const p=a(e,["downloadUri"]);p!=null&&l(t,["downloadUri"],p);const g=a(e,["state"]);g!=null&&l(t,["state"],g);const m=a(e,["source"]);m!=null&&l(t,["source"],m);const y=a(e,["videoMetadata"]);y!=null&&l(t,["videoMetadata"],y);const v=a(e,["error"]);return v!=null&&l(t,["error"],Tc(i,v)),t}function Sc(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["files"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>ri(i,r))),l(t,["files"],o)}return t}function Ec(){return{}}function Ac(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kc extends Ht{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new En(vt.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>ri(this.apiClient,t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=vc(this.apiClient,e);return o=k("files",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const d=Sc(this.apiClient,u),h=new el;return Object.assign(h,d),h})}}async createInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=bc(this.apiClient,e);return o=k("upload/v1beta/files",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(()=>{const u=Ec(),d=new tl;return Object.assign(d,u),d})}}async get(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Cc(this.apiClient,e);return o=k("files/{file}",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>ri(this.apiClient,u))}}async delete(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=xc(this.apiClient,e);return o=k("files/{file}",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(()=>{const u=Ac(),d=new nl;return Object.assign(d,u),d})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ic(i,e){const t={},n=a(e,["voiceName"]);return n!=null&&l(t,["voiceName"],n),t}function Mc(i,e){const t={},n=a(e,["voiceName"]);return n!=null&&l(t,["voiceName"],n),t}function br(i,e){const t={},n=a(e,["prebuiltVoiceConfig"]);return n!=null&&l(t,["prebuiltVoiceConfig"],Ic(i,n)),t}function Pc(i,e){const t={},n=a(e,["prebuiltVoiceConfig"]);return n!=null&&l(t,["prebuiltVoiceConfig"],Mc(i,n)),t}function Rc(i,e){const t={},n=a(e,["speaker"]);n!=null&&l(t,["speaker"],n);const s=a(e,["voiceConfig"]);return s!=null&&l(t,["voiceConfig"],br(i,s)),t}function Dc(i,e){const t={},n=a(e,["speakerVoiceConfigs"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Rc(i,o))),l(t,["speakerVoiceConfigs"],s)}return t}function $c(i,e){const t={},n=a(e,["voiceConfig"]);n!=null&&l(t,["voiceConfig"],br(i,n));const s=a(e,["multiSpeakerVoiceConfig"]);s!=null&&l(t,["multiSpeakerVoiceConfig"],Dc(i,s));const o=a(e,["languageCode"]);return o!=null&&l(t,["languageCode"],o),t}function Nc(i,e){const t={},n=a(e,["voiceConfig"]);if(n!=null&&l(t,["voiceConfig"],Pc(i,n)),a(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=a(e,["languageCode"]);return s!=null&&l(t,["languageCode"],s),t}function Lc(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function Oc(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function Uc(i,e){const t={};if(a(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=a(e,["data"]);n!=null&&l(t,["data"],n);const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function Fc(i,e){const t={},n=a(e,["displayName"]);n!=null&&l(t,["displayName"],n);const s=a(e,["data"]);s!=null&&l(t,["data"],s);const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function Vc(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],Lc(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Uc(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function Bc(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],Oc(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Fc(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function qc(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Vc(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function Gc(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Bc(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function Hc(i,e){const t={},n=a(e,["behavior"]);n!=null&&l(t,["behavior"],n);const s=a(e,["description"]);s!=null&&l(t,["description"],s);const o=a(e,["name"]);o!=null&&l(t,["name"],o);const r=a(e,["parameters"]);r!=null&&l(t,["parameters"],r);const c=a(e,["response"]);return c!=null&&l(t,["response"],c),t}function Wc(i,e){const t={};if(a(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=a(e,["description"]);n!=null&&l(t,["description"],n);const s=a(e,["name"]);s!=null&&l(t,["name"],s);const o=a(e,["parameters"]);o!=null&&l(t,["parameters"],o);const r=a(e,["response"]);return r!=null&&l(t,["response"],r),t}function zc(i,e){const t={},n=a(e,["startTime"]);n!=null&&l(t,["startTime"],n);const s=a(e,["endTime"]);return s!=null&&l(t,["endTime"],s),t}function Jc(i,e){const t={},n=a(e,["startTime"]);n!=null&&l(t,["startTime"],n);const s=a(e,["endTime"]);return s!=null&&l(t,["endTime"],s),t}function Kc(i,e){const t={},n=a(e,["timeRangeFilter"]);return n!=null&&l(t,["timeRangeFilter"],zc(i,n)),t}function Yc(i,e){const t={},n=a(e,["timeRangeFilter"]);return n!=null&&l(t,["timeRangeFilter"],Jc(i,n)),t}function Zc(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["dynamicThreshold"]);return s!=null&&l(t,["dynamicThreshold"],s),t}function Xc(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["dynamicThreshold"]);return s!=null&&l(t,["dynamicThreshold"],s),t}function Qc(i,e){const t={},n=a(e,["dynamicRetrievalConfig"]);return n!=null&&l(t,["dynamicRetrievalConfig"],Zc(i,n)),t}function jc(i,e){const t={},n=a(e,["dynamicRetrievalConfig"]);return n!=null&&l(t,["dynamicRetrievalConfig"],Xc(i,n)),t}function eu(){return{}}function tu(i,e){const t={},n=a(e,["apiKeyString"]);return n!=null&&l(t,["apiKeyString"],n),t}function nu(i,e){const t={},n=a(e,["apiKeyConfig"]);n!=null&&l(t,["apiKeyConfig"],tu(i,n));const s=a(e,["authType"]);s!=null&&l(t,["authType"],s);const o=a(e,["googleServiceAccountConfig"]);o!=null&&l(t,["googleServiceAccountConfig"],o);const r=a(e,["httpBasicAuthConfig"]);r!=null&&l(t,["httpBasicAuthConfig"],r);const c=a(e,["oauthConfig"]);c!=null&&l(t,["oauthConfig"],c);const u=a(e,["oidcConfig"]);return u!=null&&l(t,["oidcConfig"],u),t}function iu(i,e){const t={},n=a(e,["authConfig"]);return n!=null&&l(t,["authConfig"],nu(i,n)),t}function su(){return{}}function ou(i,e){const t={},n=a(e,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>Hc(i,d))),l(t,["functionDeclarations"],u)}if(a(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(e,["googleSearch"]);s!=null&&l(t,["googleSearch"],Kc(i,s));const o=a(e,["googleSearchRetrieval"]);if(o!=null&&l(t,["googleSearchRetrieval"],Qc(i,o)),a(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(e,["urlContext"])!=null&&l(t,["urlContext"],su());const c=a(e,["codeExecution"]);return c!=null&&l(t,["codeExecution"],c),t}function ru(i,e){const t={},n=a(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(f=>Wc(i,f))),l(t,["functionDeclarations"],h)}const s=a(e,["retrieval"]);s!=null&&l(t,["retrieval"],s);const o=a(e,["googleSearch"]);o!=null&&l(t,["googleSearch"],Yc(i,o));const r=a(e,["googleSearchRetrieval"]);r!=null&&l(t,["googleSearchRetrieval"],jc(i,r)),a(e,["enterpriseWebSearch"])!=null&&l(t,["enterpriseWebSearch"],eu());const u=a(e,["googleMaps"]);if(u!=null&&l(t,["googleMaps"],iu(i,u)),a(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const d=a(e,["codeExecution"]);return d!=null&&l(t,["codeExecution"],d),t}function au(i,e){const t={},n=a(e,["handle"]);if(n!=null&&l(t,["handle"],n),a(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function lu(i,e){const t={},n=a(e,["handle"]);n!=null&&l(t,["handle"],n);const s=a(e,["transparent"]);return s!=null&&l(t,["transparent"],s),t}function eo(){return{}}function to(){return{}}function cu(i,e){const t={},n=a(e,["disabled"]);n!=null&&l(t,["disabled"],n);const s=a(e,["startOfSpeechSensitivity"]);s!=null&&l(t,["startOfSpeechSensitivity"],s);const o=a(e,["endOfSpeechSensitivity"]);o!=null&&l(t,["endOfSpeechSensitivity"],o);const r=a(e,["prefixPaddingMs"]);r!=null&&l(t,["prefixPaddingMs"],r);const c=a(e,["silenceDurationMs"]);return c!=null&&l(t,["silenceDurationMs"],c),t}function uu(i,e){const t={},n=a(e,["disabled"]);n!=null&&l(t,["disabled"],n);const s=a(e,["startOfSpeechSensitivity"]);s!=null&&l(t,["startOfSpeechSensitivity"],s);const o=a(e,["endOfSpeechSensitivity"]);o!=null&&l(t,["endOfSpeechSensitivity"],o);const r=a(e,["prefixPaddingMs"]);r!=null&&l(t,["prefixPaddingMs"],r);const c=a(e,["silenceDurationMs"]);return c!=null&&l(t,["silenceDurationMs"],c),t}function du(i,e){const t={},n=a(e,["automaticActivityDetection"]);n!=null&&l(t,["automaticActivityDetection"],cu(i,n));const s=a(e,["activityHandling"]);s!=null&&l(t,["activityHandling"],s);const o=a(e,["turnCoverage"]);return o!=null&&l(t,["turnCoverage"],o),t}function hu(i,e){const t={},n=a(e,["automaticActivityDetection"]);n!=null&&l(t,["automaticActivityDetection"],uu(i,n));const s=a(e,["activityHandling"]);s!=null&&l(t,["activityHandling"],s);const o=a(e,["turnCoverage"]);return o!=null&&l(t,["turnCoverage"],o),t}function fu(i,e){const t={},n=a(e,["targetTokens"]);return n!=null&&l(t,["targetTokens"],n),t}function pu(i,e){const t={},n=a(e,["targetTokens"]);return n!=null&&l(t,["targetTokens"],n),t}function gu(i,e){const t={},n=a(e,["triggerTokens"]);n!=null&&l(t,["triggerTokens"],n);const s=a(e,["slidingWindow"]);return s!=null&&l(t,["slidingWindow"],fu(i,s)),t}function mu(i,e){const t={},n=a(e,["triggerTokens"]);n!=null&&l(t,["triggerTokens"],n);const s=a(e,["slidingWindow"]);return s!=null&&l(t,["slidingWindow"],pu(i,s)),t}function yu(i,e){const t={},n=a(e,["proactiveAudio"]);return n!=null&&l(t,["proactiveAudio"],n),t}function vu(i,e){const t={},n=a(e,["proactiveAudio"]);return n!=null&&l(t,["proactiveAudio"],n),t}function _u(i,e,t){const n={},s=a(e,["generationConfig"]);t!==void 0&&s!=null&&l(t,["setup","generationConfig"],s);const o=a(e,["responseModalities"]);t!==void 0&&o!=null&&l(t,["setup","generationConfig","responseModalities"],o);const r=a(e,["temperature"]);t!==void 0&&r!=null&&l(t,["setup","generationConfig","temperature"],r);const c=a(e,["topP"]);t!==void 0&&c!=null&&l(t,["setup","generationConfig","topP"],c);const u=a(e,["topK"]);t!==void 0&&u!=null&&l(t,["setup","generationConfig","topK"],u);const d=a(e,["maxOutputTokens"]);t!==void 0&&d!=null&&l(t,["setup","generationConfig","maxOutputTokens"],d);const h=a(e,["mediaResolution"]);t!==void 0&&h!=null&&l(t,["setup","generationConfig","mediaResolution"],h);const f=a(e,["seed"]);t!==void 0&&f!=null&&l(t,["setup","generationConfig","seed"],f);const p=a(e,["speechConfig"]);t!==void 0&&p!=null&&l(t,["setup","generationConfig","speechConfig"],$c(i,gr(i,p)));const g=a(e,["enableAffectiveDialog"]);t!==void 0&&g!=null&&l(t,["setup","generationConfig","enableAffectiveDialog"],g);const m=a(e,["systemInstruction"]);t!==void 0&&m!=null&&l(t,["setup","systemInstruction"],qc(i,ne(i,m)));const y=a(e,["tools"]);if(t!==void 0&&y!=null){let R=Sn(i,y);Array.isArray(R)&&(R=R.map($=>ou(i,Tn(i,$)))),l(t,["setup","tools"],R)}const v=a(e,["sessionResumption"]);t!==void 0&&v!=null&&l(t,["setup","sessionResumption"],au(i,v));const w=a(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&l(t,["setup","inputAudioTranscription"],eo());const S=a(e,["outputAudioTranscription"]);t!==void 0&&S!=null&&l(t,["setup","outputAudioTranscription"],eo());const _=a(e,["realtimeInputConfig"]);t!==void 0&&_!=null&&l(t,["setup","realtimeInputConfig"],du(i,_));const C=a(e,["contextWindowCompression"]);t!==void 0&&C!=null&&l(t,["setup","contextWindowCompression"],gu(i,C));const P=a(e,["proactivity"]);return t!==void 0&&P!=null&&l(t,["setup","proactivity"],yu(i,P)),n}function wu(i,e,t){const n={},s=a(e,["generationConfig"]);t!==void 0&&s!=null&&l(t,["setup","generationConfig"],s);const o=a(e,["responseModalities"]);t!==void 0&&o!=null&&l(t,["setup","generationConfig","responseModalities"],o);const r=a(e,["temperature"]);t!==void 0&&r!=null&&l(t,["setup","generationConfig","temperature"],r);const c=a(e,["topP"]);t!==void 0&&c!=null&&l(t,["setup","generationConfig","topP"],c);const u=a(e,["topK"]);t!==void 0&&u!=null&&l(t,["setup","generationConfig","topK"],u);const d=a(e,["maxOutputTokens"]);t!==void 0&&d!=null&&l(t,["setup","generationConfig","maxOutputTokens"],d);const h=a(e,["mediaResolution"]);t!==void 0&&h!=null&&l(t,["setup","generationConfig","mediaResolution"],h);const f=a(e,["seed"]);t!==void 0&&f!=null&&l(t,["setup","generationConfig","seed"],f);const p=a(e,["speechConfig"]);t!==void 0&&p!=null&&l(t,["setup","generationConfig","speechConfig"],Nc(i,gr(i,p)));const g=a(e,["enableAffectiveDialog"]);t!==void 0&&g!=null&&l(t,["setup","generationConfig","enableAffectiveDialog"],g);const m=a(e,["systemInstruction"]);t!==void 0&&m!=null&&l(t,["setup","systemInstruction"],Gc(i,ne(i,m)));const y=a(e,["tools"]);if(t!==void 0&&y!=null){let R=Sn(i,y);Array.isArray(R)&&(R=R.map($=>ru(i,Tn(i,$)))),l(t,["setup","tools"],R)}const v=a(e,["sessionResumption"]);t!==void 0&&v!=null&&l(t,["setup","sessionResumption"],lu(i,v));const w=a(e,["inputAudioTranscription"]);t!==void 0&&w!=null&&l(t,["setup","inputAudioTranscription"],to());const S=a(e,["outputAudioTranscription"]);t!==void 0&&S!=null&&l(t,["setup","outputAudioTranscription"],to());const _=a(e,["realtimeInputConfig"]);t!==void 0&&_!=null&&l(t,["setup","realtimeInputConfig"],hu(i,_));const C=a(e,["contextWindowCompression"]);t!==void 0&&C!=null&&l(t,["setup","contextWindowCompression"],mu(i,C));const P=a(e,["proactivity"]);return t!==void 0&&P!=null&&l(t,["setup","proactivity"],vu(i,P)),n}function bu(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["setup","model"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],_u(i,s,t)),t}function Cu(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["setup","model"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],wu(i,s,t)),t}function xu(){return{}}function Tu(){return{}}function Su(){return{}}function Eu(){return{}}function Au(i,e){const t={},n=a(e,["media"]);n!=null&&l(t,["mediaChunks"],dr(i,n));const s=a(e,["audio"]);s!=null&&l(t,["audio"],rl(i,s));const o=a(e,["audioStreamEnd"]);o!=null&&l(t,["audioStreamEnd"],o);const r=a(e,["video"]);r!=null&&l(t,["video"],ol(i,r));const c=a(e,["text"]);return c!=null&&l(t,["text"],c),a(e,["activityStart"])!=null&&l(t,["activityStart"],xu()),a(e,["activityEnd"])!=null&&l(t,["activityEnd"],Su()),t}function ku(i,e){const t={},n=a(e,["media"]);if(n!=null&&l(t,["mediaChunks"],dr(i,n)),a(e,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const s=a(e,["audioStreamEnd"]);if(s!=null&&l(t,["audioStreamEnd"],s),a(e,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(a(e,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return a(e,["activityStart"])!=null&&l(t,["activityStart"],Tu()),a(e,["activityEnd"])!=null&&l(t,["activityEnd"],Eu()),t}function Cr(i,e){const t={},n=a(e,["text"]);n!=null&&l(t,["text"],n);const s=a(e,["weight"]);return s!=null&&l(t,["weight"],s),t}function Iu(i,e){const t={},n=a(e,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Cr(i,o))),l(t,["weightedPrompts"],s)}return t}function xr(i,e){const t={},n=a(e,["temperature"]);n!=null&&l(t,["temperature"],n);const s=a(e,["topK"]);s!=null&&l(t,["topK"],s);const o=a(e,["seed"]);o!=null&&l(t,["seed"],o);const r=a(e,["guidance"]);r!=null&&l(t,["guidance"],r);const c=a(e,["bpm"]);c!=null&&l(t,["bpm"],c);const u=a(e,["density"]);u!=null&&l(t,["density"],u);const d=a(e,["brightness"]);d!=null&&l(t,["brightness"],d);const h=a(e,["scale"]);h!=null&&l(t,["scale"],h);const f=a(e,["muteBass"]);f!=null&&l(t,["muteBass"],f);const p=a(e,["muteDrums"]);p!=null&&l(t,["muteDrums"],p);const g=a(e,["onlyBassAndDrums"]);g!=null&&l(t,["onlyBassAndDrums"],g);const m=a(e,["musicGenerationMode"]);return m!=null&&l(t,["musicGenerationMode"],m),t}function Mu(i,e){const t={},n=a(e,["musicGenerationConfig"]);return n!=null&&l(t,["musicGenerationConfig"],xr(i,n)),t}function Tr(i,e){const t={},n=a(e,["model"]);return n!=null&&l(t,["model"],n),t}function Sr(i,e){const t={},n=a(e,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Cr(i,o))),l(t,["weightedPrompts"],s)}return t}function ai(i,e){const t={},n=a(e,["setup"]);n!=null&&l(t,["setup"],Tr(i,n));const s=a(e,["clientContent"]);s!=null&&l(t,["clientContent"],Sr(i,s));const o=a(e,["musicGenerationConfig"]);o!=null&&l(t,["musicGenerationConfig"],xr(i,o));const r=a(e,["playbackControl"]);return r!=null&&l(t,["playbackControl"],r),t}function Pu(){return{}}function Ru(){return{}}function Du(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function $u(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function Nu(i,e){const t={},n=a(e,["data"]);n!=null&&l(t,["data"],n);const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function Lu(i,e){const t={},n=a(e,["displayName"]);n!=null&&l(t,["displayName"],n);const s=a(e,["data"]);s!=null&&l(t,["data"],s);const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function Ou(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],Du(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Nu(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function Uu(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],$u(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Lu(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function Fu(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ou(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function Vu(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Uu(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function no(i,e){const t={},n=a(e,["text"]);n!=null&&l(t,["text"],n);const s=a(e,["finished"]);return s!=null&&l(t,["finished"],s),t}function io(i,e){const t={},n=a(e,["text"]);n!=null&&l(t,["text"],n);const s=a(e,["finished"]);return s!=null&&l(t,["finished"],s),t}function Bu(i,e){const t={},n=a(e,["retrievedUrl"]);n!=null&&l(t,["retrievedUrl"],n);const s=a(e,["urlRetrievalStatus"]);return s!=null&&l(t,["urlRetrievalStatus"],s),t}function qu(i,e){const t={},n=a(e,["urlMetadata"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Bu(i,o))),l(t,["urlMetadata"],s)}return t}function Gu(i,e){const t={},n=a(e,["modelTurn"]);n!=null&&l(t,["modelTurn"],Fu(i,n));const s=a(e,["turnComplete"]);s!=null&&l(t,["turnComplete"],s);const o=a(e,["interrupted"]);o!=null&&l(t,["interrupted"],o);const r=a(e,["groundingMetadata"]);r!=null&&l(t,["groundingMetadata"],r);const c=a(e,["generationComplete"]);c!=null&&l(t,["generationComplete"],c);const u=a(e,["inputTranscription"]);u!=null&&l(t,["inputTranscription"],no(i,u));const d=a(e,["outputTranscription"]);d!=null&&l(t,["outputTranscription"],no(i,d));const h=a(e,["urlContextMetadata"]);return h!=null&&l(t,["urlContextMetadata"],qu(i,h)),t}function Hu(i,e){const t={},n=a(e,["modelTurn"]);n!=null&&l(t,["modelTurn"],Vu(i,n));const s=a(e,["turnComplete"]);s!=null&&l(t,["turnComplete"],s);const o=a(e,["interrupted"]);o!=null&&l(t,["interrupted"],o);const r=a(e,["groundingMetadata"]);r!=null&&l(t,["groundingMetadata"],r);const c=a(e,["generationComplete"]);c!=null&&l(t,["generationComplete"],c);const u=a(e,["inputTranscription"]);u!=null&&l(t,["inputTranscription"],io(i,u));const d=a(e,["outputTranscription"]);return d!=null&&l(t,["outputTranscription"],io(i,d)),t}function Wu(i,e){const t={},n=a(e,["id"]);n!=null&&l(t,["id"],n);const s=a(e,["args"]);s!=null&&l(t,["args"],s);const o=a(e,["name"]);return o!=null&&l(t,["name"],o),t}function zu(i,e){const t={},n=a(e,["args"]);n!=null&&l(t,["args"],n);const s=a(e,["name"]);return s!=null&&l(t,["name"],s),t}function Ju(i,e){const t={},n=a(e,["functionCalls"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Wu(i,o))),l(t,["functionCalls"],s)}return t}function Ku(i,e){const t={},n=a(e,["functionCalls"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>zu(i,o))),l(t,["functionCalls"],s)}return t}function Yu(i,e){const t={},n=a(e,["ids"]);return n!=null&&l(t,["ids"],n),t}function Zu(i,e){const t={},n=a(e,["ids"]);return n!=null&&l(t,["ids"],n),t}function Yt(i,e){const t={},n=a(e,["modality"]);n!=null&&l(t,["modality"],n);const s=a(e,["tokenCount"]);return s!=null&&l(t,["tokenCount"],s),t}function Zt(i,e){const t={},n=a(e,["modality"]);n!=null&&l(t,["modality"],n);const s=a(e,["tokenCount"]);return s!=null&&l(t,["tokenCount"],s),t}function Xu(i,e){const t={},n=a(e,["promptTokenCount"]);n!=null&&l(t,["promptTokenCount"],n);const s=a(e,["cachedContentTokenCount"]);s!=null&&l(t,["cachedContentTokenCount"],s);const o=a(e,["responseTokenCount"]);o!=null&&l(t,["responseTokenCount"],o);const r=a(e,["toolUsePromptTokenCount"]);r!=null&&l(t,["toolUsePromptTokenCount"],r);const c=a(e,["thoughtsTokenCount"]);c!=null&&l(t,["thoughtsTokenCount"],c);const u=a(e,["totalTokenCount"]);u!=null&&l(t,["totalTokenCount"],u);const d=a(e,["promptTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(m=>Yt(i,m))),l(t,["promptTokensDetails"],g)}const h=a(e,["cacheTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(m=>Yt(i,m))),l(t,["cacheTokensDetails"],g)}const f=a(e,["responseTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(m=>Yt(i,m))),l(t,["responseTokensDetails"],g)}const p=a(e,["toolUsePromptTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(m=>Yt(i,m))),l(t,["toolUsePromptTokensDetails"],g)}return t}function Qu(i,e){const t={},n=a(e,["promptTokenCount"]);n!=null&&l(t,["promptTokenCount"],n);const s=a(e,["cachedContentTokenCount"]);s!=null&&l(t,["cachedContentTokenCount"],s);const o=a(e,["candidatesTokenCount"]);o!=null&&l(t,["responseTokenCount"],o);const r=a(e,["toolUsePromptTokenCount"]);r!=null&&l(t,["toolUsePromptTokenCount"],r);const c=a(e,["thoughtsTokenCount"]);c!=null&&l(t,["thoughtsTokenCount"],c);const u=a(e,["totalTokenCount"]);u!=null&&l(t,["totalTokenCount"],u);const d=a(e,["promptTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>Zt(i,y))),l(t,["promptTokensDetails"],m)}const h=a(e,["cacheTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(y=>Zt(i,y))),l(t,["cacheTokensDetails"],m)}const f=a(e,["candidatesTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(y=>Zt(i,y))),l(t,["responseTokensDetails"],m)}const p=a(e,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(y=>Zt(i,y))),l(t,["toolUsePromptTokensDetails"],m)}const g=a(e,["trafficType"]);return g!=null&&l(t,["trafficType"],g),t}function ju(i,e){const t={},n=a(e,["timeLeft"]);return n!=null&&l(t,["timeLeft"],n),t}function ed(i,e){const t={},n=a(e,["timeLeft"]);return n!=null&&l(t,["timeLeft"],n),t}function td(i,e){const t={},n=a(e,["newHandle"]);n!=null&&l(t,["newHandle"],n);const s=a(e,["resumable"]);s!=null&&l(t,["resumable"],s);const o=a(e,["lastConsumedClientMessageIndex"]);return o!=null&&l(t,["lastConsumedClientMessageIndex"],o),t}function nd(i,e){const t={},n=a(e,["newHandle"]);n!=null&&l(t,["newHandle"],n);const s=a(e,["resumable"]);s!=null&&l(t,["resumable"],s);const o=a(e,["lastConsumedClientMessageIndex"]);return o!=null&&l(t,["lastConsumedClientMessageIndex"],o),t}function id(i,e){const t={};a(e,["setupComplete"])!=null&&l(t,["setupComplete"],Pu());const s=a(e,["serverContent"]);s!=null&&l(t,["serverContent"],Gu(i,s));const o=a(e,["toolCall"]);o!=null&&l(t,["toolCall"],Ju(i,o));const r=a(e,["toolCallCancellation"]);r!=null&&l(t,["toolCallCancellation"],Yu(i,r));const c=a(e,["usageMetadata"]);c!=null&&l(t,["usageMetadata"],Xu(i,c));const u=a(e,["goAway"]);u!=null&&l(t,["goAway"],ju(i,u));const d=a(e,["sessionResumptionUpdate"]);return d!=null&&l(t,["sessionResumptionUpdate"],td(i,d)),t}function sd(i,e){const t={};a(e,["setupComplete"])!=null&&l(t,["setupComplete"],Ru());const s=a(e,["serverContent"]);s!=null&&l(t,["serverContent"],Hu(i,s));const o=a(e,["toolCall"]);o!=null&&l(t,["toolCall"],Ku(i,o));const r=a(e,["toolCallCancellation"]);r!=null&&l(t,["toolCallCancellation"],Zu(i,r));const c=a(e,["usageMetadata"]);c!=null&&l(t,["usageMetadata"],Qu(i,c));const u=a(e,["goAway"]);u!=null&&l(t,["goAway"],ed(i,u));const d=a(e,["sessionResumptionUpdate"]);return d!=null&&l(t,["sessionResumptionUpdate"],nd(i,d)),t}function od(){return{}}function rd(i,e){const t={},n=a(e,["text"]);n!=null&&l(t,["text"],n);const s=a(e,["weight"]);return s!=null&&l(t,["weight"],s),t}function ad(i,e){const t={},n=a(e,["weightedPrompts"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>rd(i,o))),l(t,["weightedPrompts"],s)}return t}function ld(i,e){const t={},n=a(e,["temperature"]);n!=null&&l(t,["temperature"],n);const s=a(e,["topK"]);s!=null&&l(t,["topK"],s);const o=a(e,["seed"]);o!=null&&l(t,["seed"],o);const r=a(e,["guidance"]);r!=null&&l(t,["guidance"],r);const c=a(e,["bpm"]);c!=null&&l(t,["bpm"],c);const u=a(e,["density"]);u!=null&&l(t,["density"],u);const d=a(e,["brightness"]);d!=null&&l(t,["brightness"],d);const h=a(e,["scale"]);h!=null&&l(t,["scale"],h);const f=a(e,["muteBass"]);f!=null&&l(t,["muteBass"],f);const p=a(e,["muteDrums"]);p!=null&&l(t,["muteDrums"],p);const g=a(e,["onlyBassAndDrums"]);g!=null&&l(t,["onlyBassAndDrums"],g);const m=a(e,["musicGenerationMode"]);return m!=null&&l(t,["musicGenerationMode"],m),t}function cd(i,e){const t={},n=a(e,["clientContent"]);n!=null&&l(t,["clientContent"],ad(i,n));const s=a(e,["musicGenerationConfig"]);return s!=null&&l(t,["musicGenerationConfig"],ld(i,s)),t}function ud(i,e){const t={},n=a(e,["data"]);n!=null&&l(t,["data"],n);const s=a(e,["mimeType"]);s!=null&&l(t,["mimeType"],s);const o=a(e,["sourceMetadata"]);return o!=null&&l(t,["sourceMetadata"],cd(i,o)),t}function dd(i,e){const t={},n=a(e,["audioChunks"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>ud(i,o))),l(t,["audioChunks"],s)}return t}function hd(i,e){const t={},n=a(e,["text"]);n!=null&&l(t,["text"],n);const s=a(e,["filteredReason"]);return s!=null&&l(t,["filteredReason"],s),t}function fd(i,e){const t={};a(e,["setupComplete"])!=null&&l(t,["setupComplete"],od());const s=a(e,["serverContent"]);s!=null&&l(t,["serverContent"],dd(i,s));const o=a(e,["filteredPrompt"]);return o!=null&&l(t,["filteredPrompt"],hd(i,o)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pd(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function gd(i,e){const t={};if(a(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=a(e,["data"]);n!=null&&l(t,["data"],n);const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function md(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],pd(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],gd(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function An(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>md(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function yd(i,e){const t={};if(a(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=a(e,["category"]);n!=null&&l(t,["category"],n);const s=a(e,["threshold"]);return s!=null&&l(t,["threshold"],s),t}function vd(i,e){const t={},n=a(e,["behavior"]);n!=null&&l(t,["behavior"],n);const s=a(e,["description"]);s!=null&&l(t,["description"],s);const o=a(e,["name"]);o!=null&&l(t,["name"],o);const r=a(e,["parameters"]);r!=null&&l(t,["parameters"],r);const c=a(e,["response"]);return c!=null&&l(t,["response"],c),t}function _d(i,e){const t={},n=a(e,["startTime"]);n!=null&&l(t,["startTime"],n);const s=a(e,["endTime"]);return s!=null&&l(t,["endTime"],s),t}function wd(i,e){const t={},n=a(e,["timeRangeFilter"]);return n!=null&&l(t,["timeRangeFilter"],_d(i,n)),t}function bd(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["dynamicThreshold"]);return s!=null&&l(t,["dynamicThreshold"],s),t}function Cd(i,e){const t={},n=a(e,["dynamicRetrievalConfig"]);return n!=null&&l(t,["dynamicRetrievalConfig"],bd(i,n)),t}function xd(){return{}}function Td(i,e){const t={},n=a(e,["functionDeclarations"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(d=>vd(i,d))),l(t,["functionDeclarations"],u)}if(a(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(e,["googleSearch"]);s!=null&&l(t,["googleSearch"],wd(i,s));const o=a(e,["googleSearchRetrieval"]);if(o!=null&&l(t,["googleSearchRetrieval"],Cd(i,o)),a(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(e,["urlContext"])!=null&&l(t,["urlContext"],xd());const c=a(e,["codeExecution"]);return c!=null&&l(t,["codeExecution"],c),t}function Sd(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["allowedFunctionNames"]);return s!=null&&l(t,["allowedFunctionNames"],s),t}function Ed(i,e){const t={},n=a(e,["latitude"]);n!=null&&l(t,["latitude"],n);const s=a(e,["longitude"]);return s!=null&&l(t,["longitude"],s),t}function Ad(i,e){const t={},n=a(e,["latLng"]);return n!=null&&l(t,["latLng"],Ed(i,n)),t}function kd(i,e){const t={},n=a(e,["functionCallingConfig"]);n!=null&&l(t,["functionCallingConfig"],Sd(i,n));const s=a(e,["retrievalConfig"]);return s!=null&&l(t,["retrievalConfig"],Ad(i,s)),t}function Id(i,e){const t={},n=a(e,["voiceName"]);return n!=null&&l(t,["voiceName"],n),t}function Er(i,e){const t={},n=a(e,["prebuiltVoiceConfig"]);return n!=null&&l(t,["prebuiltVoiceConfig"],Id(i,n)),t}function Md(i,e){const t={},n=a(e,["speaker"]);n!=null&&l(t,["speaker"],n);const s=a(e,["voiceConfig"]);return s!=null&&l(t,["voiceConfig"],Er(i,s)),t}function Pd(i,e){const t={},n=a(e,["speakerVoiceConfigs"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Md(i,o))),l(t,["speakerVoiceConfigs"],s)}return t}function Rd(i,e){const t={},n=a(e,["voiceConfig"]);n!=null&&l(t,["voiceConfig"],Er(i,n));const s=a(e,["multiSpeakerVoiceConfig"]);s!=null&&l(t,["multiSpeakerVoiceConfig"],Pd(i,s));const o=a(e,["languageCode"]);return o!=null&&l(t,["languageCode"],o),t}function Dd(i,e){const t={},n=a(e,["includeThoughts"]);n!=null&&l(t,["includeThoughts"],n);const s=a(e,["thinkingBudget"]);return s!=null&&l(t,["thinkingBudget"],s),t}function $d(i,e,t){const n={},s=a(e,["systemInstruction"]);t!==void 0&&s!=null&&l(t,["systemInstruction"],An(i,ne(i,s)));const o=a(e,["temperature"]);o!=null&&l(n,["temperature"],o);const r=a(e,["topP"]);r!=null&&l(n,["topP"],r);const c=a(e,["topK"]);c!=null&&l(n,["topK"],c);const u=a(e,["candidateCount"]);u!=null&&l(n,["candidateCount"],u);const d=a(e,["maxOutputTokens"]);d!=null&&l(n,["maxOutputTokens"],d);const h=a(e,["stopSequences"]);h!=null&&l(n,["stopSequences"],h);const f=a(e,["responseLogprobs"]);f!=null&&l(n,["responseLogprobs"],f);const p=a(e,["logprobs"]);p!=null&&l(n,["logprobs"],p);const g=a(e,["presencePenalty"]);g!=null&&l(n,["presencePenalty"],g);const m=a(e,["frequencyPenalty"]);m!=null&&l(n,["frequencyPenalty"],m);const y=a(e,["seed"]);y!=null&&l(n,["seed"],y);const v=a(e,["responseMimeType"]);v!=null&&l(n,["responseMimeType"],v);const w=a(e,["responseSchema"]);if(w!=null&&l(n,["responseSchema"],mn(i,w)),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=a(e,["safetySettings"]);if(t!==void 0&&S!=null){let H=S;Array.isArray(H)&&(H=H.map(de=>yd(i,de))),l(t,["safetySettings"],H)}const _=a(e,["tools"]);if(t!==void 0&&_!=null){let H=Sn(i,_);Array.isArray(H)&&(H=H.map(de=>Td(i,Tn(i,de)))),l(t,["tools"],H)}const C=a(e,["toolConfig"]);if(t!==void 0&&C!=null&&l(t,["toolConfig"],kd(i,C)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=a(e,["cachedContent"]);t!==void 0&&P!=null&&l(t,["cachedContent"],De(i,P));const R=a(e,["responseModalities"]);R!=null&&l(n,["responseModalities"],R);const $=a(e,["mediaResolution"]);$!=null&&l(n,["mediaResolution"],$);const re=a(e,["speechConfig"]);if(re!=null&&l(n,["speechConfig"],Rd(i,pr(i,re))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=a(e,["thinkingConfig"]);return V!=null&&l(n,["thinkingConfig"],Dd(i,V)),n}function so(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);if(s!=null){let r=ce(i,s);Array.isArray(r)&&(r=r.map(c=>An(i,c))),l(t,["contents"],r)}const o=a(e,["config"]);return o!=null&&l(t,["generationConfig"],$d(i,o,t)),t}function Nd(i,e,t){const n={},s=a(e,["taskType"]);t!==void 0&&s!=null&&l(t,["requests[]","taskType"],s);const o=a(e,["title"]);t!==void 0&&o!=null&&l(t,["requests[]","title"],o);const r=a(e,["outputDimensionality"]);if(t!==void 0&&r!=null&&l(t,["requests[]","outputDimensionality"],r),a(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Ld(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);s!=null&&l(t,["requests[]","content"],fr(i,s));const o=a(e,["config"]);o!=null&&l(t,["config"],Nd(i,o,t));const r=a(e,["model"]);return r!==void 0&&l(t,["requests[]","model"],z(i,r)),t}function Od(i,e,t){const n={};if(a(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=a(e,["numberOfImages"]);t!==void 0&&s!=null&&l(t,["parameters","sampleCount"],s);const o=a(e,["aspectRatio"]);t!==void 0&&o!=null&&l(t,["parameters","aspectRatio"],o);const r=a(e,["guidanceScale"]);if(t!==void 0&&r!=null&&l(t,["parameters","guidanceScale"],r),a(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=a(e,["safetyFilterLevel"]);t!==void 0&&c!=null&&l(t,["parameters","safetySetting"],c);const u=a(e,["personGeneration"]);t!==void 0&&u!=null&&l(t,["parameters","personGeneration"],u);const d=a(e,["includeSafetyAttributes"]);t!==void 0&&d!=null&&l(t,["parameters","includeSafetyAttributes"],d);const h=a(e,["includeRaiReason"]);t!==void 0&&h!=null&&l(t,["parameters","includeRaiReason"],h);const f=a(e,["language"]);t!==void 0&&f!=null&&l(t,["parameters","language"],f);const p=a(e,["outputMimeType"]);t!==void 0&&p!=null&&l(t,["parameters","outputOptions","mimeType"],p);const g=a(e,["outputCompressionQuality"]);if(t!==void 0&&g!=null&&l(t,["parameters","outputOptions","compressionQuality"],g),a(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Ud(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["prompt"]);s!=null&&l(t,["instances[0]","prompt"],s);const o=a(e,["config"]);return o!=null&&l(t,["config"],Od(i,o,t)),t}function Fd(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","name"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Vd(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);const r=a(e,["filter"]);t!==void 0&&r!=null&&l(t,["_query","filter"],r);const c=a(e,["queryBase"]);return t!==void 0&&c!=null&&l(t,["_url","models_url"],vr(i,c)),n}function Bd(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],Vd(i,n,t)),t}function qd(i,e,t){const n={},s=a(e,["displayName"]);t!==void 0&&s!=null&&l(t,["displayName"],s);const o=a(e,["description"]);t!==void 0&&o!=null&&l(t,["description"],o);const r=a(e,["defaultCheckpointId"]);return t!==void 0&&r!=null&&l(t,["defaultCheckpointId"],r),n}function Gd(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","name"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],qd(i,s,t)),t}function Hd(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","name"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Wd(i,e){const t={};if(a(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function zd(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);if(s!=null){let r=ce(i,s);Array.isArray(r)&&(r=r.map(c=>An(i,c))),l(t,["contents"],r)}const o=a(e,["config"]);return o!=null&&l(t,["config"],Wd(i,o)),t}function Jd(i,e){const t={};if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=a(e,["imageBytes"]);n!=null&&l(t,["bytesBase64Encoded"],$e(i,n));const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function Kd(i,e,t){const n={},s=a(e,["numberOfVideos"]);if(t!==void 0&&s!=null&&l(t,["parameters","sampleCount"],s),a(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=a(e,["durationSeconds"]);if(t!==void 0&&o!=null&&l(t,["parameters","durationSeconds"],o),a(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=a(e,["aspectRatio"]);if(t!==void 0&&r!=null&&l(t,["parameters","aspectRatio"],r),a(e,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const c=a(e,["personGeneration"]);if(t!==void 0&&c!=null&&l(t,["parameters","personGeneration"],c),a(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=a(e,["negativePrompt"]);if(t!==void 0&&u!=null&&l(t,["parameters","negativePrompt"],u),a(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Yd(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["prompt"]);s!=null&&l(t,["instances[0]","prompt"],s);const o=a(e,["image"]);o!=null&&l(t,["instances[0]","image"],Jd(i,o));const r=a(e,["config"]);return r!=null&&l(t,["config"],Kd(i,r,t)),t}function Zd(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function Xd(i,e){const t={},n=a(e,["displayName"]);n!=null&&l(t,["displayName"],n);const s=a(e,["data"]);s!=null&&l(t,["data"],s);const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function Qd(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],Zd(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Xd(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function xt(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Qd(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function jd(i,e){const t={},n=a(e,["featureSelectionPreference"]);return n!=null&&l(t,["featureSelectionPreference"],n),t}function eh(i,e){const t={},n=a(e,["method"]);n!=null&&l(t,["method"],n);const s=a(e,["category"]);s!=null&&l(t,["category"],s);const o=a(e,["threshold"]);return o!=null&&l(t,["threshold"],o),t}function th(i,e){const t={};if(a(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const n=a(e,["description"]);n!=null&&l(t,["description"],n);const s=a(e,["name"]);s!=null&&l(t,["name"],s);const o=a(e,["parameters"]);o!=null&&l(t,["parameters"],o);const r=a(e,["response"]);return r!=null&&l(t,["response"],r),t}function nh(i,e){const t={},n=a(e,["startTime"]);n!=null&&l(t,["startTime"],n);const s=a(e,["endTime"]);return s!=null&&l(t,["endTime"],s),t}function ih(i,e){const t={},n=a(e,["timeRangeFilter"]);return n!=null&&l(t,["timeRangeFilter"],nh(i,n)),t}function sh(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["dynamicThreshold"]);return s!=null&&l(t,["dynamicThreshold"],s),t}function oh(i,e){const t={},n=a(e,["dynamicRetrievalConfig"]);return n!=null&&l(t,["dynamicRetrievalConfig"],sh(i,n)),t}function rh(){return{}}function ah(i,e){const t={},n=a(e,["apiKeyString"]);return n!=null&&l(t,["apiKeyString"],n),t}function lh(i,e){const t={},n=a(e,["apiKeyConfig"]);n!=null&&l(t,["apiKeyConfig"],ah(i,n));const s=a(e,["authType"]);s!=null&&l(t,["authType"],s);const o=a(e,["googleServiceAccountConfig"]);o!=null&&l(t,["googleServiceAccountConfig"],o);const r=a(e,["httpBasicAuthConfig"]);r!=null&&l(t,["httpBasicAuthConfig"],r);const c=a(e,["oauthConfig"]);c!=null&&l(t,["oauthConfig"],c);const u=a(e,["oidcConfig"]);return u!=null&&l(t,["oidcConfig"],u),t}function ch(i,e){const t={},n=a(e,["authConfig"]);return n!=null&&l(t,["authConfig"],lh(i,n)),t}function Ar(i,e){const t={},n=a(e,["functionDeclarations"]);if(n!=null){let h=n;Array.isArray(h)&&(h=h.map(f=>th(i,f))),l(t,["functionDeclarations"],h)}const s=a(e,["retrieval"]);s!=null&&l(t,["retrieval"],s);const o=a(e,["googleSearch"]);o!=null&&l(t,["googleSearch"],ih(i,o));const r=a(e,["googleSearchRetrieval"]);r!=null&&l(t,["googleSearchRetrieval"],oh(i,r)),a(e,["enterpriseWebSearch"])!=null&&l(t,["enterpriseWebSearch"],rh());const u=a(e,["googleMaps"]);if(u!=null&&l(t,["googleMaps"],ch(i,u)),a(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const d=a(e,["codeExecution"]);return d!=null&&l(t,["codeExecution"],d),t}function uh(i,e){const t={},n=a(e,["mode"]);n!=null&&l(t,["mode"],n);const s=a(e,["allowedFunctionNames"]);return s!=null&&l(t,["allowedFunctionNames"],s),t}function dh(i,e){const t={},n=a(e,["latitude"]);n!=null&&l(t,["latitude"],n);const s=a(e,["longitude"]);return s!=null&&l(t,["longitude"],s),t}function hh(i,e){const t={},n=a(e,["latLng"]);return n!=null&&l(t,["latLng"],dh(i,n)),t}function fh(i,e){const t={},n=a(e,["functionCallingConfig"]);n!=null&&l(t,["functionCallingConfig"],uh(i,n));const s=a(e,["retrievalConfig"]);return s!=null&&l(t,["retrievalConfig"],hh(i,s)),t}function ph(i,e){const t={},n=a(e,["voiceName"]);return n!=null&&l(t,["voiceName"],n),t}function gh(i,e){const t={},n=a(e,["prebuiltVoiceConfig"]);return n!=null&&l(t,["prebuiltVoiceConfig"],ph(i,n)),t}function mh(i,e){const t={},n=a(e,["voiceConfig"]);if(n!=null&&l(t,["voiceConfig"],gh(i,n)),a(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=a(e,["languageCode"]);return s!=null&&l(t,["languageCode"],s),t}function yh(i,e){const t={},n=a(e,["includeThoughts"]);n!=null&&l(t,["includeThoughts"],n);const s=a(e,["thinkingBudget"]);return s!=null&&l(t,["thinkingBudget"],s),t}function vh(i,e,t){const n={},s=a(e,["systemInstruction"]);t!==void 0&&s!=null&&l(t,["systemInstruction"],xt(i,ne(i,s)));const o=a(e,["temperature"]);o!=null&&l(n,["temperature"],o);const r=a(e,["topP"]);r!=null&&l(n,["topP"],r);const c=a(e,["topK"]);c!=null&&l(n,["topK"],c);const u=a(e,["candidateCount"]);u!=null&&l(n,["candidateCount"],u);const d=a(e,["maxOutputTokens"]);d!=null&&l(n,["maxOutputTokens"],d);const h=a(e,["stopSequences"]);h!=null&&l(n,["stopSequences"],h);const f=a(e,["responseLogprobs"]);f!=null&&l(n,["responseLogprobs"],f);const p=a(e,["logprobs"]);p!=null&&l(n,["logprobs"],p);const g=a(e,["presencePenalty"]);g!=null&&l(n,["presencePenalty"],g);const m=a(e,["frequencyPenalty"]);m!=null&&l(n,["frequencyPenalty"],m);const y=a(e,["seed"]);y!=null&&l(n,["seed"],y);const v=a(e,["responseMimeType"]);v!=null&&l(n,["responseMimeType"],v);const w=a(e,["responseSchema"]);w!=null&&l(n,["responseSchema"],mn(i,w));const S=a(e,["routingConfig"]);S!=null&&l(n,["routingConfig"],S);const _=a(e,["modelSelectionConfig"]);_!=null&&l(n,["modelConfig"],jd(i,_));const C=a(e,["safetySettings"]);if(t!==void 0&&C!=null){let ve=C;Array.isArray(ve)&&(ve=ve.map(Rn=>eh(i,Rn))),l(t,["safetySettings"],ve)}const P=a(e,["tools"]);if(t!==void 0&&P!=null){let ve=Sn(i,P);Array.isArray(ve)&&(ve=ve.map(Rn=>Ar(i,Tn(i,Rn)))),l(t,["tools"],ve)}const R=a(e,["toolConfig"]);t!==void 0&&R!=null&&l(t,["toolConfig"],fh(i,R));const $=a(e,["labels"]);t!==void 0&&$!=null&&l(t,["labels"],$);const re=a(e,["cachedContent"]);t!==void 0&&re!=null&&l(t,["cachedContent"],De(i,re));const V=a(e,["responseModalities"]);V!=null&&l(n,["responseModalities"],V);const H=a(e,["mediaResolution"]);H!=null&&l(n,["mediaResolution"],H);const de=a(e,["speechConfig"]);de!=null&&l(n,["speechConfig"],mh(i,pr(i,de)));const Fi=a(e,["audioTimestamp"]);Fi!=null&&l(n,["audioTimestamp"],Fi);const Vi=a(e,["thinkingConfig"]);return Vi!=null&&l(n,["thinkingConfig"],yh(i,Vi)),n}function oo(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);if(s!=null){let r=ce(i,s);Array.isArray(r)&&(r=r.map(c=>xt(i,c))),l(t,["contents"],r)}const o=a(e,["config"]);return o!=null&&l(t,["generationConfig"],vh(i,o,t)),t}function _h(i,e,t){const n={},s=a(e,["taskType"]);t!==void 0&&s!=null&&l(t,["instances[]","task_type"],s);const o=a(e,["title"]);t!==void 0&&o!=null&&l(t,["instances[]","title"],o);const r=a(e,["outputDimensionality"]);t!==void 0&&r!=null&&l(t,["parameters","outputDimensionality"],r);const c=a(e,["mimeType"]);t!==void 0&&c!=null&&l(t,["instances[]","mimeType"],c);const u=a(e,["autoTruncate"]);return t!==void 0&&u!=null&&l(t,["parameters","autoTruncate"],u),n}function wh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);s!=null&&l(t,["instances[]","content"],fr(i,s));const o=a(e,["config"]);return o!=null&&l(t,["config"],_h(i,o,t)),t}function bh(i,e,t){const n={},s=a(e,["outputGcsUri"]);t!==void 0&&s!=null&&l(t,["parameters","storageUri"],s);const o=a(e,["negativePrompt"]);t!==void 0&&o!=null&&l(t,["parameters","negativePrompt"],o);const r=a(e,["numberOfImages"]);t!==void 0&&r!=null&&l(t,["parameters","sampleCount"],r);const c=a(e,["aspectRatio"]);t!==void 0&&c!=null&&l(t,["parameters","aspectRatio"],c);const u=a(e,["guidanceScale"]);t!==void 0&&u!=null&&l(t,["parameters","guidanceScale"],u);const d=a(e,["seed"]);t!==void 0&&d!=null&&l(t,["parameters","seed"],d);const h=a(e,["safetyFilterLevel"]);t!==void 0&&h!=null&&l(t,["parameters","safetySetting"],h);const f=a(e,["personGeneration"]);t!==void 0&&f!=null&&l(t,["parameters","personGeneration"],f);const p=a(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&l(t,["parameters","includeSafetyAttributes"],p);const g=a(e,["includeRaiReason"]);t!==void 0&&g!=null&&l(t,["parameters","includeRaiReason"],g);const m=a(e,["language"]);t!==void 0&&m!=null&&l(t,["parameters","language"],m);const y=a(e,["outputMimeType"]);t!==void 0&&y!=null&&l(t,["parameters","outputOptions","mimeType"],y);const v=a(e,["outputCompressionQuality"]);t!==void 0&&v!=null&&l(t,["parameters","outputOptions","compressionQuality"],v);const w=a(e,["addWatermark"]);t!==void 0&&w!=null&&l(t,["parameters","addWatermark"],w);const S=a(e,["enhancePrompt"]);return t!==void 0&&S!=null&&l(t,["parameters","enhancePrompt"],S),n}function Ch(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["prompt"]);s!=null&&l(t,["instances[0]","prompt"],s);const o=a(e,["config"]);return o!=null&&l(t,["config"],bh(i,o,t)),t}function Ei(i,e){const t={},n=a(e,["gcsUri"]);n!=null&&l(t,["gcsUri"],n);const s=a(e,["imageBytes"]);s!=null&&l(t,["bytesBase64Encoded"],$e(i,s));const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function xh(i,e){const t={},n=a(e,["maskMode"]);n!=null&&l(t,["maskMode"],n);const s=a(e,["segmentationClasses"]);s!=null&&l(t,["maskClasses"],s);const o=a(e,["maskDilation"]);return o!=null&&l(t,["dilation"],o),t}function Th(i,e){const t={},n=a(e,["controlType"]);n!=null&&l(t,["controlType"],n);const s=a(e,["enableControlImageComputation"]);return s!=null&&l(t,["computeControl"],s),t}function Sh(i,e){const t={},n=a(e,["styleDescription"]);return n!=null&&l(t,["styleDescription"],n),t}function Eh(i,e){const t={},n=a(e,["subjectType"]);n!=null&&l(t,["subjectType"],n);const s=a(e,["subjectDescription"]);return s!=null&&l(t,["subjectDescription"],s),t}function Ah(i,e){const t={},n=a(e,["referenceImage"]);n!=null&&l(t,["referenceImage"],Ei(i,n));const s=a(e,["referenceId"]);s!=null&&l(t,["referenceId"],s);const o=a(e,["referenceType"]);o!=null&&l(t,["referenceType"],o);const r=a(e,["maskImageConfig"]);r!=null&&l(t,["maskImageConfig"],xh(i,r));const c=a(e,["controlImageConfig"]);c!=null&&l(t,["controlImageConfig"],Th(i,c));const u=a(e,["styleImageConfig"]);u!=null&&l(t,["styleImageConfig"],Sh(i,u));const d=a(e,["subjectImageConfig"]);return d!=null&&l(t,["subjectImageConfig"],Eh(i,d)),t}function kh(i,e,t){const n={},s=a(e,["outputGcsUri"]);t!==void 0&&s!=null&&l(t,["parameters","storageUri"],s);const o=a(e,["negativePrompt"]);t!==void 0&&o!=null&&l(t,["parameters","negativePrompt"],o);const r=a(e,["numberOfImages"]);t!==void 0&&r!=null&&l(t,["parameters","sampleCount"],r);const c=a(e,["aspectRatio"]);t!==void 0&&c!=null&&l(t,["parameters","aspectRatio"],c);const u=a(e,["guidanceScale"]);t!==void 0&&u!=null&&l(t,["parameters","guidanceScale"],u);const d=a(e,["seed"]);t!==void 0&&d!=null&&l(t,["parameters","seed"],d);const h=a(e,["safetyFilterLevel"]);t!==void 0&&h!=null&&l(t,["parameters","safetySetting"],h);const f=a(e,["personGeneration"]);t!==void 0&&f!=null&&l(t,["parameters","personGeneration"],f);const p=a(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&l(t,["parameters","includeSafetyAttributes"],p);const g=a(e,["includeRaiReason"]);t!==void 0&&g!=null&&l(t,["parameters","includeRaiReason"],g);const m=a(e,["language"]);t!==void 0&&m!=null&&l(t,["parameters","language"],m);const y=a(e,["outputMimeType"]);t!==void 0&&y!=null&&l(t,["parameters","outputOptions","mimeType"],y);const v=a(e,["outputCompressionQuality"]);t!==void 0&&v!=null&&l(t,["parameters","outputOptions","compressionQuality"],v);const w=a(e,["editMode"]);t!==void 0&&w!=null&&l(t,["parameters","editMode"],w);const S=a(e,["baseSteps"]);return t!==void 0&&S!=null&&l(t,["parameters","editConfig","baseSteps"],S),n}function Ih(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["prompt"]);s!=null&&l(t,["instances[0]","prompt"],s);const o=a(e,["referenceImages"]);if(o!=null){let c=o;Array.isArray(c)&&(c=c.map(u=>Ah(i,u))),l(t,["instances[0]","referenceImages"],c)}const r=a(e,["config"]);return r!=null&&l(t,["config"],kh(i,r,t)),t}function Mh(i,e,t){const n={},s=a(e,["includeRaiReason"]);t!==void 0&&s!=null&&l(t,["parameters","includeRaiReason"],s);const o=a(e,["outputMimeType"]);t!==void 0&&o!=null&&l(t,["parameters","outputOptions","mimeType"],o);const r=a(e,["outputCompressionQuality"]);t!==void 0&&r!=null&&l(t,["parameters","outputOptions","compressionQuality"],r);const c=a(e,["numberOfImages"]);t!==void 0&&c!=null&&l(t,["parameters","sampleCount"],c);const u=a(e,["mode"]);return t!==void 0&&u!=null&&l(t,["parameters","mode"],u),n}function Ph(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["image"]);s!=null&&l(t,["instances[0]","image"],Ei(i,s));const o=a(e,["upscaleFactor"]);o!=null&&l(t,["parameters","upscaleConfig","upscaleFactor"],o);const r=a(e,["config"]);return r!=null&&l(t,["config"],Mh(i,r,t)),t}function Rh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","name"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Dh(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);const r=a(e,["filter"]);t!==void 0&&r!=null&&l(t,["_query","filter"],r);const c=a(e,["queryBase"]);return t!==void 0&&c!=null&&l(t,["_url","models_url"],vr(i,c)),n}function $h(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],Dh(i,n,t)),t}function Nh(i,e,t){const n={},s=a(e,["displayName"]);t!==void 0&&s!=null&&l(t,["displayName"],s);const o=a(e,["description"]);t!==void 0&&o!=null&&l(t,["description"],o);const r=a(e,["defaultCheckpointId"]);return t!==void 0&&r!=null&&l(t,["defaultCheckpointId"],r),n}function Lh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],Nh(i,s,t)),t}function Oh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","name"],z(i,n));const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Uh(i,e,t){const n={},s=a(e,["systemInstruction"]);t!==void 0&&s!=null&&l(t,["systemInstruction"],xt(i,ne(i,s)));const o=a(e,["tools"]);if(t!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(u=>Ar(i,u))),l(t,["tools"],c)}const r=a(e,["generationConfig"]);return t!==void 0&&r!=null&&l(t,["generationConfig"],r),n}function Fh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);if(s!=null){let r=ce(i,s);Array.isArray(r)&&(r=r.map(c=>xt(i,c))),l(t,["contents"],r)}const o=a(e,["config"]);return o!=null&&l(t,["config"],Uh(i,o,t)),t}function Vh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["contents"]);if(s!=null){let r=ce(i,s);Array.isArray(r)&&(r=r.map(c=>xt(i,c))),l(t,["contents"],r)}const o=a(e,["config"]);return o!=null&&l(t,["config"],o),t}function Bh(i,e,t){const n={},s=a(e,["numberOfVideos"]);t!==void 0&&s!=null&&l(t,["parameters","sampleCount"],s);const o=a(e,["outputGcsUri"]);t!==void 0&&o!=null&&l(t,["parameters","storageUri"],o);const r=a(e,["fps"]);t!==void 0&&r!=null&&l(t,["parameters","fps"],r);const c=a(e,["durationSeconds"]);t!==void 0&&c!=null&&l(t,["parameters","durationSeconds"],c);const u=a(e,["seed"]);t!==void 0&&u!=null&&l(t,["parameters","seed"],u);const d=a(e,["aspectRatio"]);t!==void 0&&d!=null&&l(t,["parameters","aspectRatio"],d);const h=a(e,["resolution"]);t!==void 0&&h!=null&&l(t,["parameters","resolution"],h);const f=a(e,["personGeneration"]);t!==void 0&&f!=null&&l(t,["parameters","personGeneration"],f);const p=a(e,["pubsubTopic"]);t!==void 0&&p!=null&&l(t,["parameters","pubsubTopic"],p);const g=a(e,["negativePrompt"]);t!==void 0&&g!=null&&l(t,["parameters","negativePrompt"],g);const m=a(e,["enhancePrompt"]);return t!==void 0&&m!=null&&l(t,["parameters","enhancePrompt"],m),n}function qh(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["_url","model"],z(i,n));const s=a(e,["prompt"]);s!=null&&l(t,["instances[0]","prompt"],s);const o=a(e,["image"]);o!=null&&l(t,["instances[0]","image"],Ei(i,o));const r=a(e,["config"]);return r!=null&&l(t,["config"],Bh(i,r,t)),t}function Gh(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function Hh(i,e){const t={},n=a(e,["data"]);n!=null&&l(t,["data"],n);const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function Wh(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],Gh(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],Hh(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function zh(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Wh(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function Jh(i,e){const t={},n=a(e,["citationSources"]);return n!=null&&l(t,["citations"],n),t}function Kh(i,e){const t={},n=a(e,["retrievedUrl"]);n!=null&&l(t,["retrievedUrl"],n);const s=a(e,["urlRetrievalStatus"]);return s!=null&&l(t,["urlRetrievalStatus"],s),t}function Yh(i,e){const t={},n=a(e,["urlMetadata"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Kh(i,o))),l(t,["urlMetadata"],s)}return t}function Zh(i,e){const t={},n=a(e,["content"]);n!=null&&l(t,["content"],zh(i,n));const s=a(e,["citationMetadata"]);s!=null&&l(t,["citationMetadata"],Jh(i,s));const o=a(e,["tokenCount"]);o!=null&&l(t,["tokenCount"],o);const r=a(e,["finishReason"]);r!=null&&l(t,["finishReason"],r);const c=a(e,["urlContextMetadata"]);c!=null&&l(t,["urlContextMetadata"],Yh(i,c));const u=a(e,["avgLogprobs"]);u!=null&&l(t,["avgLogprobs"],u);const d=a(e,["groundingMetadata"]);d!=null&&l(t,["groundingMetadata"],d);const h=a(e,["index"]);h!=null&&l(t,["index"],h);const f=a(e,["logprobsResult"]);f!=null&&l(t,["logprobsResult"],f);const p=a(e,["safetyRatings"]);return p!=null&&l(t,["safetyRatings"],p),t}function ro(i,e){const t={},n=a(e,["candidates"]);if(n!=null){let c=n;Array.isArray(c)&&(c=c.map(u=>Zh(i,u))),l(t,["candidates"],c)}const s=a(e,["modelVersion"]);s!=null&&l(t,["modelVersion"],s);const o=a(e,["promptFeedback"]);o!=null&&l(t,["promptFeedback"],o);const r=a(e,["usageMetadata"]);return r!=null&&l(t,["usageMetadata"],r),t}function Xh(i,e){const t={},n=a(e,["values"]);return n!=null&&l(t,["values"],n),t}function Qh(){return{}}function jh(i,e){const t={},n=a(e,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Xh(i,r))),l(t,["embeddings"],o)}return a(e,["metadata"])!=null&&l(t,["metadata"],Qh()),t}function ef(i,e){const t={},n=a(e,["bytesBase64Encoded"]);n!=null&&l(t,["imageBytes"],$e(i,n));const s=a(e,["mimeType"]);return s!=null&&l(t,["mimeType"],s),t}function kr(i,e){const t={},n=a(e,["safetyAttributes","categories"]);n!=null&&l(t,["categories"],n);const s=a(e,["safetyAttributes","scores"]);s!=null&&l(t,["scores"],s);const o=a(e,["contentType"]);return o!=null&&l(t,["contentType"],o),t}function tf(i,e){const t={},n=a(e,["_self"]);n!=null&&l(t,["image"],ef(i,n));const s=a(e,["raiFilteredReason"]);s!=null&&l(t,["raiFilteredReason"],s);const o=a(e,["_self"]);return o!=null&&l(t,["safetyAttributes"],kr(i,o)),t}function nf(i,e){const t={},n=a(e,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>tf(i,r))),l(t,["generatedImages"],o)}const s=a(e,["positivePromptSafetyAttributes"]);return s!=null&&l(t,["positivePromptSafetyAttributes"],kr(i,s)),t}function sf(i,e){const t={},n=a(e,["baseModel"]);n!=null&&l(t,["baseModel"],n);const s=a(e,["createTime"]);s!=null&&l(t,["createTime"],s);const o=a(e,["updateTime"]);return o!=null&&l(t,["updateTime"],o),t}function li(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["displayName"]);s!=null&&l(t,["displayName"],s);const o=a(e,["description"]);o!=null&&l(t,["description"],o);const r=a(e,["version"]);r!=null&&l(t,["version"],r);const c=a(e,["_self"]);c!=null&&l(t,["tunedModelInfo"],sf(i,c));const u=a(e,["inputTokenLimit"]);u!=null&&l(t,["inputTokenLimit"],u);const d=a(e,["outputTokenLimit"]);d!=null&&l(t,["outputTokenLimit"],d);const h=a(e,["supportedGenerationMethods"]);return h!=null&&l(t,["supportedActions"],h),t}function of(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["_self"]);if(s!=null){let o=_r(i,s);Array.isArray(o)&&(o=o.map(r=>li(i,r))),l(t,["models"],o)}return t}function rf(){return{}}function af(i,e){const t={},n=a(e,["totalTokens"]);n!=null&&l(t,["totalTokens"],n);const s=a(e,["cachedContentTokenCount"]);return s!=null&&l(t,["cachedContentTokenCount"],s),t}function lf(i,e){const t={},n=a(e,["video","uri"]);n!=null&&l(t,["uri"],n);const s=a(e,["video","encodedVideo"]);s!=null&&l(t,["videoBytes"],$e(i,s));const o=a(e,["encoding"]);return o!=null&&l(t,["mimeType"],o),t}function cf(i,e){const t={},n=a(e,["_self"]);return n!=null&&l(t,["video"],lf(i,n)),t}function uf(i,e){const t={},n=a(e,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>cf(i,c))),l(t,["generatedVideos"],r)}const s=a(e,["raiMediaFilteredCount"]);s!=null&&l(t,["raiMediaFilteredCount"],s);const o=a(e,["raiMediaFilteredReasons"]);return o!=null&&l(t,["raiMediaFilteredReasons"],o),t}function df(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["metadata"]);s!=null&&l(t,["metadata"],s);const o=a(e,["done"]);o!=null&&l(t,["done"],o);const r=a(e,["error"]);r!=null&&l(t,["error"],r);const c=a(e,["response","generateVideoResponse"]);return c!=null&&l(t,["response"],uf(i,c)),t}function hf(i,e){const t={},n=a(e,["fps"]);n!=null&&l(t,["fps"],n);const s=a(e,["endOffset"]);s!=null&&l(t,["endOffset"],s);const o=a(e,["startOffset"]);return o!=null&&l(t,["startOffset"],o),t}function ff(i,e){const t={},n=a(e,["displayName"]);n!=null&&l(t,["displayName"],n);const s=a(e,["data"]);s!=null&&l(t,["data"],s);const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function pf(i,e){const t={},n=a(e,["videoMetadata"]);n!=null&&l(t,["videoMetadata"],hf(i,n));const s=a(e,["thought"]);s!=null&&l(t,["thought"],s);const o=a(e,["inlineData"]);o!=null&&l(t,["inlineData"],ff(i,o));const r=a(e,["codeExecutionResult"]);r!=null&&l(t,["codeExecutionResult"],r);const c=a(e,["executableCode"]);c!=null&&l(t,["executableCode"],c);const u=a(e,["fileData"]);u!=null&&l(t,["fileData"],u);const d=a(e,["functionCall"]);d!=null&&l(t,["functionCall"],d);const h=a(e,["functionResponse"]);h!=null&&l(t,["functionResponse"],h);const f=a(e,["text"]);return f!=null&&l(t,["text"],f),t}function gf(i,e){const t={},n=a(e,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>pf(i,r))),l(t,["parts"],o)}const s=a(e,["role"]);return s!=null&&l(t,["role"],s),t}function mf(i,e){const t={},n=a(e,["citations"]);return n!=null&&l(t,["citations"],n),t}function yf(i,e){const t={},n=a(e,["content"]);n!=null&&l(t,["content"],gf(i,n));const s=a(e,["citationMetadata"]);s!=null&&l(t,["citationMetadata"],mf(i,s));const o=a(e,["finishMessage"]);o!=null&&l(t,["finishMessage"],o);const r=a(e,["finishReason"]);r!=null&&l(t,["finishReason"],r);const c=a(e,["avgLogprobs"]);c!=null&&l(t,["avgLogprobs"],c);const u=a(e,["groundingMetadata"]);u!=null&&l(t,["groundingMetadata"],u);const d=a(e,["index"]);d!=null&&l(t,["index"],d);const h=a(e,["logprobsResult"]);h!=null&&l(t,["logprobsResult"],h);const f=a(e,["safetyRatings"]);return f!=null&&l(t,["safetyRatings"],f),t}function ao(i,e){const t={},n=a(e,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(h=>yf(i,h))),l(t,["candidates"],d)}const s=a(e,["createTime"]);s!=null&&l(t,["createTime"],s);const o=a(e,["responseId"]);o!=null&&l(t,["responseId"],o);const r=a(e,["modelVersion"]);r!=null&&l(t,["modelVersion"],r);const c=a(e,["promptFeedback"]);c!=null&&l(t,["promptFeedback"],c);const u=a(e,["usageMetadata"]);return u!=null&&l(t,["usageMetadata"],u),t}function vf(i,e){const t={},n=a(e,["truncated"]);n!=null&&l(t,["truncated"],n);const s=a(e,["token_count"]);return s!=null&&l(t,["tokenCount"],s),t}function _f(i,e){const t={},n=a(e,["values"]);n!=null&&l(t,["values"],n);const s=a(e,["statistics"]);return s!=null&&l(t,["statistics"],vf(i,s)),t}function wf(i,e){const t={},n=a(e,["billableCharacterCount"]);return n!=null&&l(t,["billableCharacterCount"],n),t}function bf(i,e){const t={},n=a(e,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>_f(i,r))),l(t,["embeddings"],o)}const s=a(e,["metadata"]);return s!=null&&l(t,["metadata"],wf(i,s)),t}function Cf(i,e){const t={},n=a(e,["gcsUri"]);n!=null&&l(t,["gcsUri"],n);const s=a(e,["bytesBase64Encoded"]);s!=null&&l(t,["imageBytes"],$e(i,s));const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function Ir(i,e){const t={},n=a(e,["safetyAttributes","categories"]);n!=null&&l(t,["categories"],n);const s=a(e,["safetyAttributes","scores"]);s!=null&&l(t,["scores"],s);const o=a(e,["contentType"]);return o!=null&&l(t,["contentType"],o),t}function Ai(i,e){const t={},n=a(e,["_self"]);n!=null&&l(t,["image"],Cf(i,n));const s=a(e,["raiFilteredReason"]);s!=null&&l(t,["raiFilteredReason"],s);const o=a(e,["_self"]);o!=null&&l(t,["safetyAttributes"],Ir(i,o));const r=a(e,["prompt"]);return r!=null&&l(t,["enhancedPrompt"],r),t}function xf(i,e){const t={},n=a(e,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ai(i,r))),l(t,["generatedImages"],o)}const s=a(e,["positivePromptSafetyAttributes"]);return s!=null&&l(t,["positivePromptSafetyAttributes"],Ir(i,s)),t}function Tf(i,e){const t={},n=a(e,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Ai(i,o))),l(t,["generatedImages"],s)}return t}function Sf(i,e){const t={},n=a(e,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>Ai(i,o))),l(t,["generatedImages"],s)}return t}function Ef(i,e){const t={},n=a(e,["endpoint"]);n!=null&&l(t,["name"],n);const s=a(e,["deployedModelId"]);return s!=null&&l(t,["deployedModelId"],s),t}function Af(i,e){const t={},n=a(e,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&l(t,["baseModel"],n);const s=a(e,["createTime"]);s!=null&&l(t,["createTime"],s);const o=a(e,["updateTime"]);return o!=null&&l(t,["updateTime"],o),t}function kf(i,e){const t={},n=a(e,["checkpointId"]);n!=null&&l(t,["checkpointId"],n);const s=a(e,["epoch"]);s!=null&&l(t,["epoch"],s);const o=a(e,["step"]);return o!=null&&l(t,["step"],o),t}function ci(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["displayName"]);s!=null&&l(t,["displayName"],s);const o=a(e,["description"]);o!=null&&l(t,["description"],o);const r=a(e,["versionId"]);r!=null&&l(t,["version"],r);const c=a(e,["deployedModels"]);if(c!=null){let p=c;Array.isArray(p)&&(p=p.map(g=>Ef(i,g))),l(t,["endpoints"],p)}const u=a(e,["labels"]);u!=null&&l(t,["labels"],u);const d=a(e,["_self"]);d!=null&&l(t,["tunedModelInfo"],Af(i,d));const h=a(e,["defaultCheckpointId"]);h!=null&&l(t,["defaultCheckpointId"],h);const f=a(e,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(g=>kf(i,g))),l(t,["checkpoints"],p)}return t}function If(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["_self"]);if(s!=null){let o=_r(i,s);Array.isArray(o)&&(o=o.map(r=>ci(i,r))),l(t,["models"],o)}return t}function Mf(){return{}}function Pf(i,e){const t={},n=a(e,["totalTokens"]);return n!=null&&l(t,["totalTokens"],n),t}function Rf(i,e){const t={},n=a(e,["tokensInfo"]);return n!=null&&l(t,["tokensInfo"],n),t}function Df(i,e){const t={},n=a(e,["gcsUri"]);n!=null&&l(t,["uri"],n);const s=a(e,["bytesBase64Encoded"]);s!=null&&l(t,["videoBytes"],$e(i,s));const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function $f(i,e){const t={},n=a(e,["_self"]);return n!=null&&l(t,["video"],Df(i,n)),t}function Nf(i,e){const t={},n=a(e,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>$f(i,c))),l(t,["generatedVideos"],r)}const s=a(e,["raiMediaFilteredCount"]);s!=null&&l(t,["raiMediaFilteredCount"],s);const o=a(e,["raiMediaFilteredReasons"]);return o!=null&&l(t,["raiMediaFilteredReasons"],o),t}function Lf(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["metadata"]);s!=null&&l(t,["metadata"],s);const o=a(e,["done"]);o!=null&&l(t,["done"],o);const r=a(e,["error"]);r!=null&&l(t,["error"],r);const c=a(e,["response"]);return c!=null&&l(t,["response"],Nf(i,c)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Of="Content-Type",Uf="X-Server-Timeout",Ff="User-Agent",ui="x-goog-api-client",Vf="1.0.0",Bf=`google-genai-sdk/${Vf}`,qf="v1beta1",Gf="v1beta",lo=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Mr extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ClientError"}}class di extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ServerError"}}class Hf{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:qf,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:Gf,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){const s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[r,c]of Object.entries(e.queryParams))s.searchParams.append(r,String(c));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,e.abortSignal),this.unaryApiCall(s,o,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[s,o]of Object.entries(t))typeof o=="object"?n[s]=Object.assign(Object.assign({},n[s]),o):o!==void 0&&(n[s]=o);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,e.abortSignal),this.streamApiCall(s,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n){if(t&&t.timeout||n){const s=new AbortController,o=s.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>s.abort(),t.timeout),n&&n.addEventListener("abort",()=>{s.abort()}),e.signal=o}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await co(s),new si(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await co(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){var t;return Dt(this,arguments,function*(){const s=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),o=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let r="";for(;;){const{done:c,value:u}=yield J(s.read());if(c){if(r.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=o.decode(u);try{const f=JSON.parse(d);if("error"in f){const p=JSON.parse(JSON.stringify(f.error)),g=p.status,m=p.code,y=`got status: ${g}. ${JSON.stringify(f)}`;if(m>=400&&m<500)throw new Mr(y);if(m>=500&&m<600)throw new di(y)}}catch(f){const p=f;if(p.name==="ClientError"||p.name==="ServerError")throw f}r+=d;let h=r.match(lo);for(;h;){const f=h[1];try{const p=new Response(f,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield J(new si(p)),r=r.slice(h[0].length),h=r.match(lo)}catch(p){throw new Error(`exception parsing stream chunk ${f}. ${p}`)}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const e={},t=Bf+" "+this.clientOptions.userAgentExtra;return e[Ff]=t,e[ui]=t,e[Of]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[n,s]of Object.entries(e.headers))t.append(n,s);e.timeout&&e.timeout>0&&t.append(Uf,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var n;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const o=this.clientOptions.uploader,r=await o.stat(e);s.sizeBytes=String(r.size);const c=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:r.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=c;const u=await this.fetchUploadUrl(s,t);return o.upload(e,u,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var n;let s={};t!=null&&t.httpOptions?s=t.httpOptions:s={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const o={file:e},r=await this.request({path:k("upload/v1beta/files",o._url),body:JSON.stringify(o),httpMethod:"POST",httpOptions:s});if(!r||!(r!=null&&r.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=(n=r==null?void 0:r.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(c===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function co(i){var e;if(i===void 0)throw new di("response is undefined");if(!i.ok){const t=i.status,n=i.statusText;let s;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await i.json():s={error:{message:await i.text(),code:i.status,status:i.statusText}};const o=`got status: ${t} ${n}. ${JSON.stringify(s)}`;throw t>=400&&t<500?new Mr(o):t>=500&&t<600?new di(o):new Error(o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const uo="mcp_used/unknown";function Pr(i){for(const e of i)if(ki(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function Rr(i){var e;const t=(e=i[ui])!==null&&e!==void 0?e:"";t.includes(uo)||(i[ui]=(t+` ${uo}`).trimStart())}function Wf(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>ki(s)))!==null&&n!==void 0?n:!1}function zf(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>!ki(s)))!==null&&n!==void 0?n:!1}function ki(i){return i!==null&&typeof i=="object"&&"tool"in i&&"callTool"in i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Jf(i,e,t){const n=new sl;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data);const o=fd(i,s);Object.assign(n,o),e(n)}class Kf{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),r=Xf(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),u=`${s}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${c}`;let d=()=>{};const h=new Promise(_=>{d=_}),f=e.callbacks,p=function(){d({})},g=this.apiClient,m={onopen:p,onmessage:_=>{Jf(g,f.onmessage,_)},onerror:(t=f==null?void 0:f.onerror)!==null&&t!==void 0?t:function(_){},onclose:(n=f==null?void 0:f.onclose)!==null&&n!==void 0?n:function(_){}},y=this.webSocketFactory.create(u,Zf(r),m);y.connect(),await h;const v=z(this.apiClient,e.model),w=Tr(this.apiClient,{model:v}),S=ai(this.apiClient,{setup:w});return y.send(JSON.stringify(S)),new Yf(y,this.apiClient)}}class Yf{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=Iu(this.apiClient,e),n=Sr(this.apiClient,t);this.conn.send(JSON.stringify({clientContent:n}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=Mu(this.apiClient,e),n=ai(this.apiClient,t);this.conn.send(JSON.stringify(n))}sendPlaybackControl(e){const t=ai(this.apiClient,{playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(ht.PLAY)}pause(){this.sendPlaybackControl(ht.PAUSE)}stop(){this.sendPlaybackControl(ht.STOP)}resetContext(){this.sendPlaybackControl(ht.RESET_CONTEXT)}close(){this.conn.close()}}function Zf(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function Xf(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Qf="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function jf(i,e,t){const n=new il;let s;if(t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),i.isVertexAI()){const o=sd(i,s);Object.assign(n,o)}else{const o=id(i,s);Object.assign(n,o)}e(n)}class ep{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new Kf(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,o,r,c;const u=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let h;const f=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&Pr(e.config.tools)&&Rr(f);const p=sp(f);if(this.apiClient.isVertexAI())h=`${u}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p);else{const V=this.apiClient.getApiKey();h=`${u}/ws/google.ai.generativelanguage.${d}.GenerativeService.BidiGenerateContent?key=${V}`}let g=()=>{};const m=new Promise(V=>{g=V}),y=e.callbacks,v=function(){var V;(V=y==null?void 0:y.onopen)===null||V===void 0||V.call(y),g({})},w=this.apiClient,S={onopen:v,onmessage:V=>{jf(w,y.onmessage,V)},onerror:(t=y==null?void 0:y.onerror)!==null&&t!==void 0?t:function(V){},onclose:(n=y==null?void 0:y.onclose)!==null&&n!==void 0?n:function(V){}},_=this.webSocketFactory.create(h,ip(p),S);_.connect(),await m;let C=z(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){const V=this.apiClient.getProject(),H=this.apiClient.getLocation();C=`projects/${V}/locations/${H}/`+C}let P={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[pn.AUDIO]}:e.config.responseModalities=[pn.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const R=(c=(r=e.config)===null||r===void 0?void 0:r.tools)!==null&&c!==void 0?c:[],$=[];for(const V of R)if(this.isCallableTool(V)){const H=V;$.push(await H.tool())}else $.push(V);$.length>0&&(e.config.tools=$);const re={model:C,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?P=Cu(this.apiClient,re):P=bu(this.apiClient,re),delete P.config,_.send(JSON.stringify(P)),new np(_,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const tp={turnComplete:!0};class np{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=ce(e,t.turns),e.isVertexAI()?n=n.map(s=>xt(e,s)):n=n.map(s=>An(e,s))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(Qf)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},tp),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:ku(this.apiClient,e)}:t={realtimeInput:Au(this.apiClient,e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function ip(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function sp(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ho=10;function fo(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const r of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(rn(r)){s=!0;break}if(!s)return!0;const o=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function rn(i){return"callTool"in i&&typeof i.callTool=="function"}function po(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class op extends Ht{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var n,s,o,r,c;const u=await this.processParamsForMcpUsage(t);if(!Wf(t)||fo(t.config))return await this.generateContentInternal(u);if(zf(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,h;const f=ce(this.apiClient,u.contents),p=(o=(s=(n=u.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:ho;let g=0;for(;g<p&&(d=await this.generateContentInternal(u),!(!d.functionCalls||d.functionCalls.length===0));){const m=d.candidates[0].content,y=[];for(const v of(c=(r=t.config)===null||r===void 0?void 0:r.tools)!==null&&c!==void 0?c:[])if(rn(v)){const S=await v.callTool(d.functionCalls);y.push(...S)}g++,h={role:"user",parts:y},u.contents=ce(this.apiClient,u.contents),u.contents.push(m),u.contents.push(h),po(u.config)&&(f.push(m),f.push(h))}return po(u.config)&&(d.automaticFunctionCallingHistory=f),d},this.generateContentStream=async t=>{if(fo(t.config)){const n=await this.processParamsForMcpUsage(t);return await this.generateContentStreamInternal(n)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let o;const r=[];if(n!=null&&n.generatedImages)for(const u of n.generatedImages)u&&(u!=null&&u.safetyAttributes)&&((s=u==null?void 0:u.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?o=u==null?void 0:u.safetyAttributes:r.push(u);let c;return o?c={generatedImages:r,positivePromptSafetyAttributes:o}:c={generatedImages:r},c}),this.list=async t=>{var n;const r={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!r.config.queryBase){if(!((n=r.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");r.config.filter="labels.tune-type:*"}return new En(vt.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(r),r)},this.editImage=async t=>{const n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)}}async processParamsForMcpUsage(e){var t,n,s;const o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;const r=await Promise.all(o.map(async u=>rn(u)?await u.tool():u)),c={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:r})};if(c.config.tools=r,e.config&&e.config.tools&&Pr(e.config.tools)){const u=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{};let d=Object.assign({},u);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Rr(d),c.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return c}async initAfcToolsMap(e){var t,n,s;const o=new Map;for(const r of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(rn(r)){const c=r,u=await c.tool();for(const d of(s=u.functionDeclarations)!==null&&s!==void 0?s:[]){if(!d.name)throw new Error("Function declaration name is required.");if(o.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);o.set(d.name,c)}}return o}async processAfcStream(e){var t,n,s;const o=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:ho;let r=!1,c=0;const u=await this.initAfcToolsMap(e);return function(d,h,f){var p,g;return Dt(this,arguments,function*(){for(var m,y,v,w;c<o;){r&&(c++,r=!1);const P=yield J(d.processParamsForMcpUsage(f)),R=yield J(d.generateContentStreamInternal(P)),$=[],re=[];try{for(var S=!0,_=(y=void 0,on(R)),C;C=yield J(_.next()),m=C.done,!m;S=!0){w=C.value,S=!1;const V=w;if(yield yield J(V),V.candidates&&(!((p=V.candidates[0])===null||p===void 0)&&p.content)){re.push(V.candidates[0].content);for(const H of(g=V.candidates[0].content.parts)!==null&&g!==void 0?g:[])if(c<o&&H.functionCall){if(!H.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(H.functionCall.name)){const de=yield J(h.get(H.functionCall.name).callTool([H.functionCall]));$.push(...de)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${H.functionCall.name}`)}}}}catch(V){y={error:V}}finally{try{!S&&!m&&(v=_.return)&&(yield J(v.call(_)))}finally{if(y)throw y.error}}if($.length>0){r=!0;const V=new St;V.candidates=[{content:{role:"user",parts:$}}],yield yield J(V);const H=[];H.push(...re),H.push({role:"user",parts:$});const de=ce(d.apiClient,f.contents).concat(H);f.contents=de}else break}})}(this,u,e)}async generateContentInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=oo(this.apiClient,e);return c=k("{model}:generateContent",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=ao(this.apiClient,h),p=new St;return Object.assign(p,f),p})}else{const d=so(this.apiClient,e);return c=k("{model}:generateContent",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=ro(this.apiClient,h),p=new St;return Object.assign(p,f),p})}}async generateContentStreamInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=oo(this.apiClient,e);c=k("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d.config,delete d._url,delete d._query;const h=this.apiClient;return r=h.requestStream({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),r.then(function(f){return Dt(this,arguments,function*(){var p,g,m,y;try{for(var v=!0,w=on(f),S;S=yield J(w.next()),p=S.done,!p;v=!0){y=S.value,v=!1;const C=ao(h,yield J(y.json())),P=new St;Object.assign(P,C),yield yield J(P)}}catch(_){g={error:_}}finally{try{!v&&!p&&(m=w.return)&&(yield J(m.call(w)))}finally{if(g)throw g.error}}})})}else{const d=so(this.apiClient,e);c=k("{model}:streamGenerateContent?alt=sse",d._url),u=d._query,delete d.config,delete d._url,delete d._query;const h=this.apiClient;return r=h.requestStream({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),r.then(function(f){return Dt(this,arguments,function*(){var p,g,m,y;try{for(var v=!0,w=on(f),S;S=yield J(w.next()),p=S.done,!p;v=!0){y=S.value,v=!1;const C=ro(h,yield J(y.json())),P=new St;Object.assign(P,C),yield yield J(P)}}catch(_){g={error:_}}finally{try{!v&&!p&&(m=w.return)&&(yield J(m.call(w)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=wh(this.apiClient,e);return c=k("{model}:predict",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=bf(this.apiClient,h),p=new Us;return Object.assign(p,f),p})}else{const d=Ld(this.apiClient,e);return c=k("{model}:batchEmbedContents",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=jh(this.apiClient,h),p=new Us;return Object.assign(p,f),p})}}async generateImagesInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Ch(this.apiClient,e);return c=k("{model}:predict",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=xf(this.apiClient,h),p=new Fs;return Object.assign(p,f),p})}else{const d=Ud(this.apiClient,e);return c=k("{model}:predict",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=nf(this.apiClient,h),p=new Fs;return Object.assign(p,f),p})}}async editImageInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI()){const c=Ih(this.apiClient,e);return o=k("{model}:predict",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const d=Tf(this.apiClient,u),h=new Xa;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI()){const c=Ph(this.apiClient,e);return o=k("{model}:predict",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const d=Sf(this.apiClient,u),h=new Qa;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Rh(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>ci(this.apiClient,h))}else{const d=Fd(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>li(this.apiClient,h))}}async listInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=$h(this.apiClient,e);return c=k("{models_url}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=If(this.apiClient,h),p=new Vs;return Object.assign(p,f),p})}else{const d=Bd(this.apiClient,e);return c=k("{models_url}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=of(this.apiClient,h),p=new Vs;return Object.assign(p,f),p})}}async update(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Lh(this.apiClient,e);return c=k("{model}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>ci(this.apiClient,h))}else{const d=Gd(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>li(this.apiClient,h))}}async delete(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Oh(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(()=>{const h=Mf(),f=new Bs;return Object.assign(f,h),f})}else{const d=Hd(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(()=>{const h=rf(),f=new Bs;return Object.assign(f,h),f})}}async countTokens(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Fh(this.apiClient,e);return c=k("{model}:countTokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=Pf(this.apiClient,h),p=new qs;return Object.assign(p,f),p})}else{const d=zd(this.apiClient,e);return c=k("{model}:countTokens",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=af(this.apiClient,h),p=new qs;return Object.assign(p,f),p})}}async computeTokens(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI()){const c=Vh(this.apiClient,e);return o=k("{model}:computeTokens",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>{const d=Rf(this.apiClient,u),h=new ja;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=qh(this.apiClient,e);return c=k("{model}:predictLongRunning",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>Lf(this.apiClient,h))}else{const d=Yd(this.apiClient,e);return c=k("{model}:predictLongRunning",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>df(this.apiClient,h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function rp(i,e){const t={},n=a(e,["operationName"]);n!=null&&l(t,["_url","operationName"],n);const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function ap(i,e){const t={},n=a(e,["operationName"]);n!=null&&l(t,["_url","operationName"],n);const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function lp(i,e){const t={},n=a(e,["operationName"]);n!=null&&l(t,["operationName"],n);const s=a(e,["resourceName"]);s!=null&&l(t,["_url","resourceName"],s);const o=a(e,["config"]);return o!=null&&l(t,["config"],o),t}function cp(i,e){const t={},n=a(e,["video","uri"]);n!=null&&l(t,["uri"],n);const s=a(e,["video","encodedVideo"]);s!=null&&l(t,["videoBytes"],$e(i,s));const o=a(e,["encoding"]);return o!=null&&l(t,["mimeType"],o),t}function up(i,e){const t={},n=a(e,["_self"]);return n!=null&&l(t,["video"],cp(i,n)),t}function dp(i,e){const t={},n=a(e,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>up(i,c))),l(t,["generatedVideos"],r)}const s=a(e,["raiMediaFilteredCount"]);s!=null&&l(t,["raiMediaFilteredCount"],s);const o=a(e,["raiMediaFilteredReasons"]);return o!=null&&l(t,["raiMediaFilteredReasons"],o),t}function hp(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["metadata"]);s!=null&&l(t,["metadata"],s);const o=a(e,["done"]);o!=null&&l(t,["done"],o);const r=a(e,["error"]);r!=null&&l(t,["error"],r);const c=a(e,["response","generateVideoResponse"]);return c!=null&&l(t,["response"],dp(i,c)),t}function fp(i,e){const t={},n=a(e,["gcsUri"]);n!=null&&l(t,["uri"],n);const s=a(e,["bytesBase64Encoded"]);s!=null&&l(t,["videoBytes"],$e(i,s));const o=a(e,["mimeType"]);return o!=null&&l(t,["mimeType"],o),t}function pp(i,e){const t={},n=a(e,["_self"]);return n!=null&&l(t,["video"],fp(i,n)),t}function gp(i,e){const t={},n=a(e,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(c=>pp(i,c))),l(t,["generatedVideos"],r)}const s=a(e,["raiMediaFilteredCount"]);s!=null&&l(t,["raiMediaFilteredCount"],s);const o=a(e,["raiMediaFilteredReasons"]);return o!=null&&l(t,["raiMediaFilteredReasons"],o),t}function go(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["metadata"]);s!=null&&l(t,["metadata"],s);const o=a(e,["done"]);o!=null&&l(t,["done"],o);const r=a(e,["error"]);r!=null&&l(t,["error"],r);const c=a(e,["response"]);return c!=null&&l(t,["response"],gp(i,c)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mp extends Ht{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;return n&&"httpOptions"in n&&(o=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}})}else return this.getVideosOperationInternal({operationName:t.name,config:n})}async getVideosOperationInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=ap(this.apiClient,e);return c=k("{operationName}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>go(this.apiClient,h))}else{const d=rp(this.apiClient,e);return c=k("{operationName}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>hp(this.apiClient,h))}}async fetchPredictVideosOperationInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI()){const c=lp(this.apiClient,e);return o=k("{resourceName}:fetchPredictOperation",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>go(this.apiClient,u))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yp(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],n);const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function vp(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);const r=a(e,["filter"]);return t!==void 0&&r!=null&&l(t,["_query","filter"],r),n}function _p(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],vp(i,n,t)),t}function wp(i,e){const t={},n=a(e,["textInput"]);n!=null&&l(t,["textInput"],n);const s=a(e,["output"]);return s!=null&&l(t,["output"],s),t}function bp(i,e){const t={};if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=a(e,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>wp(i,o))),l(t,["examples","examples"],s)}return t}function Cp(i,e,t){const n={};if(a(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=a(e,["tunedModelDisplayName"]);if(t!==void 0&&s!=null&&l(t,["displayName"],s),a(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=a(e,["epochCount"]);t!==void 0&&o!=null&&l(t,["tuningTask","hyperparameters","epochCount"],o);const r=a(e,["learningRateMultiplier"]);if(r!=null&&l(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),a(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const c=a(e,["batchSize"]);t!==void 0&&c!=null&&l(t,["tuningTask","hyperparameters","batchSize"],c);const u=a(e,["learningRate"]);return t!==void 0&&u!=null&&l(t,["tuningTask","hyperparameters","learningRate"],u),n}function xp(i,e){const t={},n=a(e,["baseModel"]);n!=null&&l(t,["baseModel"],n);const s=a(e,["trainingDataset"]);s!=null&&l(t,["tuningTask","trainingData"],bp(i,s));const o=a(e,["config"]);return o!=null&&l(t,["config"],Cp(i,o,t)),t}function Tp(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["_url","name"],n);const s=a(e,["config"]);return s!=null&&l(t,["config"],s),t}function Sp(i,e,t){const n={},s=a(e,["pageSize"]);t!==void 0&&s!=null&&l(t,["_query","pageSize"],s);const o=a(e,["pageToken"]);t!==void 0&&o!=null&&l(t,["_query","pageToken"],o);const r=a(e,["filter"]);return t!==void 0&&r!=null&&l(t,["_query","filter"],r),n}function Ep(i,e){const t={},n=a(e,["config"]);return n!=null&&l(t,["config"],Sp(i,n,t)),t}function Ap(i,e,t){const n={},s=a(e,["gcsUri"]);if(t!==void 0&&s!=null&&l(t,["supervisedTuningSpec","trainingDatasetUri"],s),a(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function kp(i,e){const t={},n=a(e,["gcsUri"]);return n!=null&&l(t,["validationDatasetUri"],n),t}function Ip(i,e,t){const n={},s=a(e,["validationDataset"]);t!==void 0&&s!=null&&l(t,["supervisedTuningSpec"],kp(i,s));const o=a(e,["tunedModelDisplayName"]);t!==void 0&&o!=null&&l(t,["tunedModelDisplayName"],o);const r=a(e,["description"]);t!==void 0&&r!=null&&l(t,["description"],r);const c=a(e,["epochCount"]);t!==void 0&&c!=null&&l(t,["supervisedTuningSpec","hyperParameters","epochCount"],c);const u=a(e,["learningRateMultiplier"]);t!==void 0&&u!=null&&l(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);const d=a(e,["exportLastCheckpointOnly"]);t!==void 0&&d!=null&&l(t,["supervisedTuningSpec","exportLastCheckpointOnly"],d);const h=a(e,["adapterSize"]);if(t!==void 0&&h!=null&&l(t,["supervisedTuningSpec","hyperParameters","adapterSize"],h),a(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function Mp(i,e){const t={},n=a(e,["baseModel"]);n!=null&&l(t,["baseModel"],n);const s=a(e,["trainingDataset"]);s!=null&&l(t,["supervisedTuningSpec","trainingDatasetUri"],Ap(i,s,t));const o=a(e,["config"]);return o!=null&&l(t,["config"],Ip(i,o,t)),t}function Pp(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["model"],n);const s=a(e,["name"]);return s!=null&&l(t,["endpoint"],s),t}function Dr(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["state"]);s!=null&&l(t,["state"],mr(i,s));const o=a(e,["createTime"]);o!=null&&l(t,["createTime"],o);const r=a(e,["tuningTask","startTime"]);r!=null&&l(t,["startTime"],r);const c=a(e,["tuningTask","completeTime"]);c!=null&&l(t,["endTime"],c);const u=a(e,["updateTime"]);u!=null&&l(t,["updateTime"],u);const d=a(e,["description"]);d!=null&&l(t,["description"],d);const h=a(e,["baseModel"]);h!=null&&l(t,["baseModel"],h);const f=a(e,["_self"]);f!=null&&l(t,["tunedModel"],Pp(i,f));const p=a(e,["distillationSpec"]);p!=null&&l(t,["distillationSpec"],p);const g=a(e,["experiment"]);g!=null&&l(t,["experiment"],g);const m=a(e,["labels"]);m!=null&&l(t,["labels"],m);const y=a(e,["pipelineJob"]);y!=null&&l(t,["pipelineJob"],y);const v=a(e,["tunedModelDisplayName"]);return v!=null&&l(t,["tunedModelDisplayName"],v),t}function Rp(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["tunedModels"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>Dr(i,r))),l(t,["tuningJobs"],o)}return t}function Dp(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["metadata"]);s!=null&&l(t,["metadata"],s);const o=a(e,["done"]);o!=null&&l(t,["done"],o);const r=a(e,["error"]);return r!=null&&l(t,["error"],r),t}function $p(i,e){const t={},n=a(e,["checkpointId"]);n!=null&&l(t,["checkpointId"],n);const s=a(e,["epoch"]);s!=null&&l(t,["epoch"],s);const o=a(e,["step"]);o!=null&&l(t,["step"],o);const r=a(e,["endpoint"]);return r!=null&&l(t,["endpoint"],r),t}function Np(i,e){const t={},n=a(e,["model"]);n!=null&&l(t,["model"],n);const s=a(e,["endpoint"]);s!=null&&l(t,["endpoint"],s);const o=a(e,["checkpoints"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(c=>$p(i,c))),l(t,["checkpoints"],r)}return t}function hi(i,e){const t={},n=a(e,["name"]);n!=null&&l(t,["name"],n);const s=a(e,["state"]);s!=null&&l(t,["state"],mr(i,s));const o=a(e,["createTime"]);o!=null&&l(t,["createTime"],o);const r=a(e,["startTime"]);r!=null&&l(t,["startTime"],r);const c=a(e,["endTime"]);c!=null&&l(t,["endTime"],c);const u=a(e,["updateTime"]);u!=null&&l(t,["updateTime"],u);const d=a(e,["error"]);d!=null&&l(t,["error"],d);const h=a(e,["description"]);h!=null&&l(t,["description"],h);const f=a(e,["baseModel"]);f!=null&&l(t,["baseModel"],f);const p=a(e,["tunedModel"]);p!=null&&l(t,["tunedModel"],Np(i,p));const g=a(e,["supervisedTuningSpec"]);g!=null&&l(t,["supervisedTuningSpec"],g);const m=a(e,["tuningDataStats"]);m!=null&&l(t,["tuningDataStats"],m);const y=a(e,["encryptionSpec"]);y!=null&&l(t,["encryptionSpec"],y);const v=a(e,["partnerModelTuningSpec"]);v!=null&&l(t,["partnerModelTuningSpec"],v);const w=a(e,["distillationSpec"]);w!=null&&l(t,["distillationSpec"],w);const S=a(e,["experiment"]);S!=null&&l(t,["experiment"],S);const _=a(e,["labels"]);_!=null&&l(t,["labels"],_);const C=a(e,["pipelineJob"]);C!=null&&l(t,["pipelineJob"],C);const P=a(e,["tunedModelDisplayName"]);return P!=null&&l(t,["tunedModelDisplayName"],P),t}function Lp(i,e){const t={},n=a(e,["nextPageToken"]);n!=null&&l(t,["nextPageToken"],n);const s=a(e,["tuningJobs"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(r=>hi(i,r))),l(t,["tuningJobs"],o)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Op extends Ht{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new En(vt.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const n=await this.tuneMldevInternal(t);let s="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?s=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(s=n.name.split("/operations/")[0]),{name:s,state:ii.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Tp(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>hi(this.apiClient,h))}else{const d=yp(this.apiClient,e);return c=k("{name}",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>Dr(this.apiClient,h))}}async listInternal(e){var t,n,s,o;let r,c="",u={};if(this.apiClient.isVertexAI()){const d=Ep(this.apiClient,e);return c=k("tuningJobs",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),r.then(h=>{const f=Lp(this.apiClient,h),p=new Gs;return Object.assign(p,f),p})}else{const d=_p(this.apiClient,e);return c=k("tunedModels",d._url),u=d._query,delete d.config,delete d._url,delete d._query,r=this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),r.then(h=>{const f=Rp(this.apiClient,h),p=new Gs;return Object.assign(p,f),p})}}async tuneInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI()){const c=Mp(this.apiClient,e);return o=k("tuningJobs",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>hi(this.apiClient,u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=xp(this.apiClient,e);return o=k("tunedModels",c._url),r=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(u=>u.json()),s.then(u=>Dp(this.apiClient,u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Up{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Fp=1024*1024*8,Vp=3,Bp=1e3,qp=2,$n="x-goog-upload-status";async function Gp(i,e,t){var n,s,o;let r=0,c=0,u=new si(new Response),d="upload";for(r=i.size;c<r;){const f=Math.min(Fp,r-c),p=i.slice(c,c+f);c+f>=r&&(d+=", finalize");let g=0,m=Bp;for(;g<Vp&&(u=await t.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(c),"Content-Length":String(f)}}}),!(!((n=u==null?void 0:u.headers)===null||n===void 0)&&n[$n]));)g++,await Wp(m),m=m*qp;if(c+=f,((s=u==null?void 0:u.headers)===null||s===void 0?void 0:s[$n])!=="active")break;if(r<=c)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const h=await(u==null?void 0:u.json());if(((o=u==null?void 0:u.headers)===null||o===void 0?void 0:o[$n])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return h.file}async function Hp(i){return{size:i.size,type:i.type}}function Wp(i){return new Promise(e=>setTimeout(e,i))}class zp{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Gp(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Hp(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Jp{create(e,t,n){return new Kp(e,t,n)}}class Kp{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const mo="x-goog-api-key";class Yp{constructor(e){this.apiKey=e}async addAuthHeaders(e){e.get(mo)===null&&e.append(mo,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zp="gl-node/";class Xp{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const n=Za(e,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion;const s=new Yp(this.apiKey);this.apiClient=new Hf({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Zp+"web",uploader:new zp,downloader:new Up}),this.models=new op(this.apiClient),this.live=new ep(this.apiClient,s,new Jp),this.chats=new gc(this.models,this.apiClient),this.caches=new hc(this.apiClient),this.files=new kc(this.apiClient),this.operations=new mp(this.apiClient),this.tunings=new Op(this.apiClient)}}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const an=globalThis,Ii=an.ShadowRoot&&(an.ShadyCSS===void 0||an.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Mi=Symbol(),yo=new WeakMap;let $r=class{constructor(e,t,n){if(this._$cssResult$=!0,n!==Mi)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Ii&&e===void 0){const n=t!==void 0&&t.length===1;n&&(e=yo.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&yo.set(t,e))}return e}toString(){return this.cssText}};const Qp=i=>new $r(typeof i=="string"?i:i+"",void 0,Mi),me=(i,...e)=>{const t=i.length===1?i[0]:e.reduce((n,s,o)=>n+(r=>{if(r._$cssResult$===!0)return r.cssText;if(typeof r=="number")return r;throw Error("Value passed to 'css' function must be a 'css' function result: "+r+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+i[o+1],i[0]);return new $r(t,i,Mi)},jp=(i,e)=>{if(Ii)i.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(const t of e){const n=document.createElement("style"),s=an.litNonce;s!==void 0&&n.setAttribute("nonce",s),n.textContent=t.cssText,i.appendChild(n)}},vo=Ii?i=>i:i=>i instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return Qp(t)})(i):i;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:eg,defineProperty:tg,getOwnPropertyDescriptor:ng,getOwnPropertyNames:ig,getOwnPropertySymbols:sg,getPrototypeOf:og}=Object,Me=globalThis,_o=Me.trustedTypes,rg=_o?_o.emptyScript:"",Nn=Me.reactiveElementPolyfillSupport,$t=(i,e)=>i,yn={toAttribute(i,e){switch(e){case Boolean:i=i?rg:null;break;case Object:case Array:i=i==null?i:JSON.stringify(i)}return i},fromAttribute(i,e){let t=i;switch(e){case Boolean:t=i!==null;break;case Number:t=i===null?null:Number(i);break;case Object:case Array:try{t=JSON.parse(i)}catch{t=null}}return t}},Pi=(i,e)=>!eg(i,e),wo={attribute:!0,type:String,converter:yn,reflect:!1,useDefault:!1,hasChanged:Pi};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Me.litPropertyMetadata??(Me.litPropertyMetadata=new WeakMap);let ct=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=wo){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const n=Symbol(),s=this.getPropertyDescriptor(e,n,t);s!==void 0&&tg(this.prototype,e,s)}}static getPropertyDescriptor(e,t,n){const{get:s,set:o}=ng(this.prototype,e)??{get(){return this[t]},set(r){this[t]=r}};return{get:s,set(r){const c=s==null?void 0:s.call(this);o==null||o.call(this,r),this.requestUpdate(e,c,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??wo}static _$Ei(){if(this.hasOwnProperty($t("elementProperties")))return;const e=og(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty($t("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty($t("properties"))){const t=this.properties,n=[...ig(t),...sg(t)];for(const s of n)this.createProperty(s,t[s])}const e=this[Symbol.metadata];if(e!==null){const t=litPropertyMetadata.get(e);if(t!==void 0)for(const[n,s]of t)this.elementProperties.set(n,s)}this._$Eh=new Map;for(const[t,n]of this.elementProperties){const s=this._$Eu(t,n);s!==void 0&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const s of n)t.unshift(vo(s))}else e!==void 0&&t.push(vo(e));return t}static _$Eu(e,t){const n=t.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const n of t.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return jp(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var n;return(n=t.hostConnected)==null?void 0:n.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var n;return(n=t.hostDisconnected)==null?void 0:n.call(t)})}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$ET(e,t){var o;const n=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,n);if(s!==void 0&&n.reflect===!0){const r=(((o=n.converter)==null?void 0:o.toAttribute)!==void 0?n.converter:yn).toAttribute(t,n.type);this._$Em=e,r==null?this.removeAttribute(s):this.setAttribute(s,r),this._$Em=null}}_$AK(e,t){var o,r;const n=this.constructor,s=n._$Eh.get(e);if(s!==void 0&&this._$Em!==s){const c=n.getPropertyOptions(s),u=typeof c.converter=="function"?{fromAttribute:c.converter}:((o=c.converter)==null?void 0:o.fromAttribute)!==void 0?c.converter:yn;this._$Em=s;const d=u.fromAttribute(t,c.type);this[s]=d??((r=this._$Ej)==null?void 0:r.get(s))??d,this._$Em=null}}requestUpdate(e,t,n){var s;if(e!==void 0){const o=this.constructor,r=this[e];if(n??(n=o.getPropertyOptions(e)),!((n.hasChanged??Pi)(r,t)||n.useDefault&&n.reflect&&r===((s=this._$Ej)==null?void 0:s.get(e))&&!this.hasAttribute(o._$Eu(e,n))))return;this.C(e,t,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,t,{useDefault:n,reflect:s,wrapped:o},r){n&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,r??t??this[e]),o!==!0||r!==void 0)||(this._$AL.has(e)||(this.hasUpdated||n||(t=void 0),this._$AL.set(e,t)),s===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[o,r]of this._$Ep)this[o]=r;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[o,r]of s){const{wrapped:c}=r,u=this[o];c!==!0||this._$AL.has(o)||u===void 0||this.C(o,void 0,r,u)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),(n=this._$EO)==null||n.forEach(s=>{var o;return(o=s.hostUpdate)==null?void 0:o.call(s)}),this.update(t)):this._$EM()}catch(s){throw e=!1,this._$EM(),s}e&&this._$AE(t)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(n=>{var s;return(s=n.hostUpdated)==null?void 0:s.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(e){}firstUpdated(e){}};ct.elementStyles=[],ct.shadowRootOptions={mode:"open"},ct[$t("elementProperties")]=new Map,ct[$t("finalized")]=new Map,Nn==null||Nn({ReactiveElement:ct}),(Me.reactiveElementVersions??(Me.reactiveElementVersions=[])).push("2.1.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Nt=globalThis,vn=Nt.trustedTypes,bo=vn?vn.createPolicy("lit-html",{createHTML:i=>i}):void 0,Nr="$lit$",Ae=`lit$${Math.random().toFixed(9).slice(2)}$`,Lr="?"+Ae,ag=`<${Lr}>`,Je=document,Vt=()=>Je.createComment(""),Bt=i=>i===null||typeof i!="object"&&typeof i!="function",Ri=Array.isArray,lg=i=>Ri(i)||typeof(i==null?void 0:i[Symbol.iterator])=="function",Ln=`[ 	
\f\r]`,Et=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Co=/-->/g,xo=/>/g,Oe=RegExp(`>|${Ln}(?:([^\\s"'>=/]+)(${Ln}*=${Ln}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),To=/'/g,So=/"/g,Or=/^(?:script|style|textarea|title)$/i,Ur=i=>(e,...t)=>({_$litType$:i,strings:e,values:t}),A=Ur(1),On=Ur(2),Re=Symbol.for("lit-noChange"),Q=Symbol.for("lit-nothing"),Eo=new WeakMap,qe=Je.createTreeWalker(Je,129);function Fr(i,e){if(!Ri(i)||!i.hasOwnProperty("raw"))throw Error("invalid template strings array");return bo!==void 0?bo.createHTML(e):e}const cg=(i,e)=>{const t=i.length-1,n=[];let s,o=e===2?"<svg>":e===3?"<math>":"",r=Et;for(let c=0;c<t;c++){const u=i[c];let d,h,f=-1,p=0;for(;p<u.length&&(r.lastIndex=p,h=r.exec(u),h!==null);)p=r.lastIndex,r===Et?h[1]==="!--"?r=Co:h[1]!==void 0?r=xo:h[2]!==void 0?(Or.test(h[2])&&(s=RegExp("</"+h[2],"g")),r=Oe):h[3]!==void 0&&(r=Oe):r===Oe?h[0]===">"?(r=s??Et,f=-1):h[1]===void 0?f=-2:(f=r.lastIndex-h[2].length,d=h[1],r=h[3]===void 0?Oe:h[3]==='"'?So:To):r===So||r===To?r=Oe:r===Co||r===xo?r=Et:(r=Oe,s=void 0);const g=r===Oe&&i[c+1].startsWith("/>")?" ":"";o+=r===Et?u+ag:f>=0?(n.push(d),u.slice(0,f)+Nr+u.slice(f)+Ae+g):u+Ae+(f===-2?c:g)}return[Fr(i,o+(i[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),n]};class qt{constructor({strings:e,_$litType$:t},n){let s;this.parts=[];let o=0,r=0;const c=e.length-1,u=this.parts,[d,h]=cg(e,t);if(this.el=qt.createElement(d,n),qe.currentNode=this.el.content,t===2||t===3){const f=this.el.content.firstChild;f.replaceWith(...f.childNodes)}for(;(s=qe.nextNode())!==null&&u.length<c;){if(s.nodeType===1){if(s.hasAttributes())for(const f of s.getAttributeNames())if(f.endsWith(Nr)){const p=h[r++],g=s.getAttribute(f).split(Ae),m=/([.?@])?(.*)/.exec(p);u.push({type:1,index:o,name:m[2],strings:g,ctor:m[1]==="."?dg:m[1]==="?"?hg:m[1]==="@"?fg:kn}),s.removeAttribute(f)}else f.startsWith(Ae)&&(u.push({type:6,index:o}),s.removeAttribute(f));if(Or.test(s.tagName)){const f=s.textContent.split(Ae),p=f.length-1;if(p>0){s.textContent=vn?vn.emptyScript:"";for(let g=0;g<p;g++)s.append(f[g],Vt()),qe.nextNode(),u.push({type:2,index:++o});s.append(f[p],Vt())}}}else if(s.nodeType===8)if(s.data===Lr)u.push({type:2,index:o});else{let f=-1;for(;(f=s.data.indexOf(Ae,f+1))!==-1;)u.push({type:7,index:o}),f+=Ae.length-1}o++}}static createElement(e,t){const n=Je.createElement("template");return n.innerHTML=e,n}}function _t(i,e,t=i,n){var r,c;if(e===Re)return e;let s=n!==void 0?(r=t._$Co)==null?void 0:r[n]:t._$Cl;const o=Bt(e)?void 0:e._$litDirective$;return(s==null?void 0:s.constructor)!==o&&((c=s==null?void 0:s._$AO)==null||c.call(s,!1),o===void 0?s=void 0:(s=new o(i),s._$AT(i,t,n)),n!==void 0?(t._$Co??(t._$Co=[]))[n]=s:t._$Cl=s),s!==void 0&&(e=_t(i,s._$AS(i,e.values),s,n)),e}class ug{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:n}=this._$AD,s=((e==null?void 0:e.creationScope)??Je).importNode(t,!0);qe.currentNode=s;let o=qe.nextNode(),r=0,c=0,u=n[0];for(;u!==void 0;){if(r===u.index){let d;u.type===2?d=new Wt(o,o.nextSibling,this,e):u.type===1?d=new u.ctor(o,u.name,u.strings,this,e):u.type===6&&(d=new pg(o,this,e)),this._$AV.push(d),u=n[++c]}r!==(u==null?void 0:u.index)&&(o=qe.nextNode(),r++)}return qe.currentNode=Je,s}p(e){let t=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class Wt{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,t,n,s){this.type=2,this._$AH=Q,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=s,this._$Cv=(s==null?void 0:s.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=_t(this,e,t),Bt(e)?e===Q||e==null||e===""?(this._$AH!==Q&&this._$AR(),this._$AH=Q):e!==this._$AH&&e!==Re&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):lg(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Q&&Bt(this._$AH)?this._$AA.nextSibling.data=e:this.T(Je.createTextNode(e)),this._$AH=e}$(e){var o;const{values:t,_$litType$:n}=e,s=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=qt.createElement(Fr(n.h,n.h[0]),this.options)),n);if(((o=this._$AH)==null?void 0:o._$AD)===s)this._$AH.p(t);else{const r=new ug(s,this),c=r.u(this.options);r.p(t),this.T(c),this._$AH=r}}_$AC(e){let t=Eo.get(e.strings);return t===void 0&&Eo.set(e.strings,t=new qt(e)),t}k(e){Ri(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,s=0;for(const o of e)s===t.length?t.push(n=new Wt(this.O(Vt()),this.O(Vt()),this,this.options)):n=t[s],n._$AI(o),s++;s<t.length&&(this._$AR(n&&n._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,t);e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var t;this._$AM===void 0&&(this._$Cv=e,(t=this._$AP)==null||t.call(this,e))}}class kn{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,n,s,o){this.type=1,this._$AH=Q,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=o,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Q}_$AI(e,t=this,n,s){const o=this.strings;let r=!1;if(o===void 0)e=_t(this,e,t,0),r=!Bt(e)||e!==this._$AH&&e!==Re,r&&(this._$AH=e);else{const c=e;let u,d;for(e=o[0],u=0;u<o.length-1;u++)d=_t(this,c[n+u],t,u),d===Re&&(d=this._$AH[u]),r||(r=!Bt(d)||d!==this._$AH[u]),d===Q?e=Q:e!==Q&&(e+=(d??"")+o[u+1]),this._$AH[u]=d}r&&!s&&this.j(e)}j(e){e===Q?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class dg extends kn{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Q?void 0:e}}class hg extends kn{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Q)}}class fg extends kn{constructor(e,t,n,s,o){super(e,t,n,s,o),this.type=5}_$AI(e,t=this){if((e=_t(this,e,t,0)??Q)===Re)return;const n=this._$AH,s=e===Q&&n!==Q||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,o=e!==Q&&(n===Q||s);s&&this.element.removeEventListener(this.name,this,n),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}}class pg{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){_t(this,e)}}const Un=Nt.litHtmlPolyfillSupport;Un==null||Un(qt,Wt),(Nt.litHtmlVersions??(Nt.litHtmlVersions=[])).push("3.3.1");const gg=(i,e,t)=>{const n=(t==null?void 0:t.renderBefore)??e;let s=n._$litPart$;if(s===void 0){const o=(t==null?void 0:t.renderBefore)??null;n._$litPart$=s=new Wt(e.insertBefore(Vt(),o),o,void 0,t??{})}return s._$AI(i),s};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ge=globalThis;let ie=class extends ct{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t;const e=super.createRenderRoot();return(t=this.renderOptions).renderBefore??(t.renderBefore=e.firstChild),e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=gg(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return Re}};var rr;ie._$litElement$=!0,ie.finalized=!0,(rr=Ge.litElementHydrateSupport)==null||rr.call(Ge,{LitElement:ie});const Fn=Ge.litElementPolyfillSupport;Fn==null||Fn({LitElement:ie});(Ge.litElementVersions??(Ge.litElementVersions=[])).push("4.2.1");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ye=i=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(i,e)}):customElements.define(i,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const mg={attribute:!0,type:String,converter:yn,reflect:!1,hasChanged:Pi},yg=(i=mg,e,t)=>{const{kind:n,metadata:s}=t;let o=globalThis.litPropertyMetadata.get(s);if(o===void 0&&globalThis.litPropertyMetadata.set(s,o=new Map),n==="setter"&&((i=Object.create(i)).wrapped=!0),o.set(t.name,i),n==="accessor"){const{name:r}=t;return{set(c){const u=e.get.call(this);e.set.call(this,c),this.requestUpdate(r,u,i)},init(c){return c!==void 0&&this.C(r,void 0,i,c),c}}}if(n==="setter"){const{name:r}=t;return function(c){const u=this[r];e.call(this,c),this.requestUpdate(r,u,i)}}throw Error("Unsupported decorator location: "+n)};function U(i){return(e,t)=>typeof t=="object"?yg(i,e,t):((n,s,o)=>{const r=s.hasOwnProperty(o);return s.constructor.createProperty(o,n),r?Object.getOwnPropertyDescriptor(s,o):void 0})(i,e,t)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function G(i){return U({...i,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const vg=(i,e,t)=>(t.configurable=!0,t.enumerable=!0,Reflect.decorate&&typeof e!="object"&&Object.defineProperty(i,e,t),t);/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Vr(i,e){return(t,n,s)=>{const o=r=>{var c;return((c=r.renderRoot)==null?void 0:c.querySelector(i))??null};return vg(t,n,{get(){return o(this)}})}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/function Br(i,e){let t=-1/0,n;return(...s)=>{const o=Date.now();return o-t>=e&&(n=i(...s),t=o),n}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const qr={ATTRIBUTE:1},Gr=i=>(...e)=>({_$litDirective$:i,values:e});let Hr=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,n){this._$Ct=e,this._$AM=t,this._$Ci=n}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Wr=Gr(class extends Hr{constructor(i){var e;if(super(i),i.type!==qr.ATTRIBUTE||i.name!=="class"||((e=i.strings)==null?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(i){return" "+Object.keys(i).filter(e=>i[e]).join(" ")+" "}update(i,[e]){var n,s;if(this.st===void 0){this.st=new Set,i.strings!==void 0&&(this.nt=new Set(i.strings.join(" ").split(/\s/).filter(o=>o!=="")));for(const o in e)e[o]&&!((n=this.nt)!=null&&n.has(o))&&this.st.add(o);return this.render(e)}const t=i.element.classList;for(const o of this.st)o in e||(t.remove(o),this.st.delete(o));for(const o in e){const r=!!e[o];r===this.st.has(o)||(s=this.nt)!=null&&s.has(o)||(r?(t.add(o),this.st.add(o)):(t.remove(o),this.st.delete(o)))}return Re}});/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const zr="important",_g=" !"+zr,Vn=Gr(class extends Hr{constructor(i){var e;if(super(i),i.type!==qr.ATTRIBUTE||i.name!=="style"||((e=i.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(i){return Object.keys(i).reduce((e,t)=>{const n=i[t];return n==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${n};`},"")}update(i,[e]){const{style:t}=i.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(const n of this.ft)e[n]==null&&(this.ft.delete(n),n.includes("-")?t.removeProperty(n):t[n]=null);for(const n in e){const s=e[n];if(s!=null){this.ft.add(n);const o=typeof s=="string"&&s.endsWith(_g);n.includes("-")||o?t.setProperty(n,o?s.slice(0,-11):s,o?zr:""):t[n]=s}}return Re}});var wg=Object.defineProperty,bg=Object.getOwnPropertyDescriptor,In=(i,e,t,n)=>{for(var s=n>1?void 0:n?bg(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&wg(e,t,s),s};let wt=class extends ie{constructor(){super(),this.value=0,this.color="#000",this.audioLevel=0,this.isDragging=!1,this.dragStartX=0,this.dragStartValue=0,this.handlePointerDown=this.handlePointerDown.bind(this),this.handlePointerMove=this.handlePointerMove.bind(this),this.handlePointerUp=this.handlePointerUp.bind(this),this.handleWheel=this.handleWheel.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}updated(i){i.has("value")&&console.log("WeightSlider value updated to:",this.value)}handlePointerDown(i){i.preventDefault(),this.isDragging=!0,this.dragStartX=i.clientX,this.dragStartValue=this.value,document.body.classList.add("dragging"),window.addEventListener("pointermove",this.handlePointerMove),window.addEventListener("pointerup",this.handlePointerUp)}handlePointerMove(i){if(!this.isDragging)return;const e=i.clientX-this.dragStartX,t=this.dragStartValue+e*.01;this.setValue(Math.max(0,Math.min(2,t)))}handlePointerUp(){this.isDragging=!1,window.removeEventListener("pointermove",this.handlePointerMove),window.removeEventListener("pointerup",this.handlePointerUp),document.body.classList.remove("dragging")}handleWheel(i){i.preventDefault();const e=i.deltaX||i.deltaY,t=this.value+e*-.0025;this.setValue(Math.max(0,Math.min(2,t)))}handleKeyDown(i){let e=0;if((i.key==="ArrowRight"||i.key==="ArrowUp")&&(e=.1),(i.key==="ArrowLeft"||i.key==="ArrowDown")&&(e=-.1),e!==0){i.preventDefault();const t=Math.max(0,Math.min(2,this.value+e));this.setValue(t)}}setValue(i){this.value=i,this.dispatchEvent(new CustomEvent("input",{detail:this.value}))}getSliderFillWidth(){return`${this.value/2*100}%`}getSliderThumbPosition(){return`calc(${this.value/2*100}% + 16px)`}getAudioBars(){if(this.audioLevel===0)return[0,0,0,0,0];const e=Math.max(3,this.audioLevel*25);return[e*.6,e*.8,e,e*.7,e*.5]}getTickMarks(){const i=[];for(let e=0;e<=10;e++){const t=e/10*100,n=e%2===0;i.push(A`
        <div class="tick-mark ${n?"major":""}" style="left: ${t}%"></div>
        ${n?A`<div class="value-marker" style="left: ${t}%">${(e/10*2).toFixed(1)}</div>`:""}
      `)}return i}render(){const i=this.getSliderFillWidth(),e=this.getSliderThumbPosition(),t=this.getAudioBars(),n=Vn({width:i,background:this.color}),s=Vn({left:e}),o=Vn({background:this.color,opacity:this.value>0?"0.2":"0"});return A`
      <div class="slider-container"
           role="slider"
           tabindex="0"
           aria-label="Style weight"
           aria-valuemin="0"
           aria-valuemax="2"
           aria-valuenow=${this.value.toFixed(2)}
           @pointerdown=${this.handlePointerDown}
           @wheel=${this.handleWheel}
           @keydown=${this.handleKeyDown}>
        
        <div class="value-display">
          ${this.value.toFixed(2)}
        </div>
        
        <div class="slider-track">
          <div class="track-inner">
            <div class="tick-marks">
              ${this.getTickMarks()}
            </div>
            <div class="slider-fill" style=${n}></div>
            <div class="slider-thumb" style=${s}></div>
          </div>
        </div>
        
        <div class="audio-visualizer" style="color: ${this.color}">
          ${t.map(r=>A`
            <div class="audio-bar" style="height: ${r}px"></div>
          `)}
        </div>

        <div class="halo-effect ${this.value>0?"active":""}" style=${o}></div>
      </div>
    `}};wt.styles=me`
    :host {
      cursor: pointer;
      position: relative;
      width: 100%;
      height: 140px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      touch-action: none;
    }

    .slider-container {
      position: relative;
      width: 100%;
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .slider-track {
      position: relative;
      width: 100%;
      height: 14px;
      background: linear-gradient(to bottom, #2a2a2a 0%, #1a1a1a 50%, #0f0f0f 100%);
      border-radius: 7px;
      box-shadow: 
        inset 0 3px 6px rgba(0, 0, 0, 0.8), 
        0 2px 4px rgba(255, 255, 255, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      overflow: hidden;
      border: 2px solid #333;
      position: relative;
      z-index: 1;
    }

    .track-inner {
      position: relative;
      width: 100%;
      height: 100%;
      margin: 0;
    }
    
    .slider-track::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        rgba(0, 255, 136, 0.1) 0%, 
        transparent 20%, 
        transparent 80%, 
        rgba(0, 255, 136, 0.1) 100%);
      opacity: 0.3;
    }

    .slider-fill {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0%;
      border-radius: 7px;
      transition: width 0.1s ease;
      box-shadow: 
        inset 0 2px 4px rgba(255, 255, 255, 0.2),
        0 0 20px currentColor;
      background: linear-gradient(135deg, currentColor 0%, rgba(255, 255, 255, 0.8) 100%);
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .slider-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.3) 50%, 
        transparent 100%);
      animation: shimmer 2s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { transform: translateX(-100%); }
      50% { transform: translateX(100%); }
    }

    .slider-thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #444 0%, #333 50%, #222 100%);
      border: 3px solid #555;
      border-radius: 50%;
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.8), 
        inset 0 2px 4px rgba(255, 255, 255, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.1);
      cursor: grab;
      transition: all 0.2s ease;
      z-index: 2;
      position: relative;
      display: none; /* hide thumb visually */
    }
    
    .slider-thumb::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 12px;
      height: 12px;
      background: linear-gradient(135deg, #666 0%, #444 100%);
      border-radius: 50%;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.5);
    }

    .slider-thumb:hover {
      transform: translateY(-50%) scale(1.15);
      box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.9), 
        inset 0 2px 4px rgba(255, 255, 255, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.2);
      border-color: #777;
    }

    .slider-thumb:active {
      cursor: grabbing;
      transform: translateY(-50%) scale(1.05);
      box-shadow: 
        0 3px 10px rgba(0, 0, 0, 1), 
        inset 0 2px 4px rgba(255, 255, 255, 0.1);
    }

    .value-display {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      color: #00ff88;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
      z-index: 20;
      border: 2px solid #333;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
      letter-spacing: 0.5px;
    }
    
    .value-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #00ff88 50%, transparent 100%);
      opacity: 0.6;
    }

    .slider-container:hover .value-display {
      opacity: 1;
      transform: translateX(-50%) translateY(-5px);
    }

    .audio-visualizer {
      position: absolute;
      top: -52px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 30px;
      display: flex;
      align-items: end;
      justify-content: center;
      gap: 4px;
    }

    .audio-bar {
      width: 5px;
      background: currentColor;
      border-radius: 3px;
      transition: height 0.1s ease;
      box-shadow: 0 0 8px currentColor;
      position: relative;
    }
    
    .audio-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(180deg, 
        rgba(255, 255, 255, 0.8) 0%, 
        currentColor 50%, 
        rgba(0, 0, 0, 0.3) 100%);
      border-radius: 3px;
    }

    

    .halo-effect {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 140px;
      height: 140px;
      border-radius: 50%;
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
      z-index: -1;
      background: radial-gradient(circle, currentColor 0%, transparent 70%);
    }

    .halo-effect.active {
      opacity: 0.15;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.15; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.25; }
    }

    /* Professional DAW-style tick marks */
    .tick-marks {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 0;
    }

    .tick-mark {
      position: absolute;
      top: 50%;
      width: 1px;
      height: 10px;
      background: #444;
      transform: translateY(-50%);
      transition: all 0.2s ease;
    }
    
    .tick-mark:hover {
      background: #666;
      height: 12px;
    }

    .tick-mark.major {
      height: 14px;
      background: #666;
      width: 2px;
    }
    
    .tick-mark.major:hover {
      background: #888;
      height: 16px;
    }

    /* Value markers */
    .value-marker {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: #666;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      transition: all 0.2s ease;
    }
    
    .value-marker:hover {
      color: #888;
      transform: translateX(-50%) scale(1.1);
    }

    @media (max-width: 768px) {
      :host { height: 110px; }
      .slider-container { height: 80px; }
      .slider-track { height: 10px; }
      .slider-thumb { width: 24px; height: 24px; }
      .value-display { font-size: 11px; padding: 6px 10px; }
      .audio-visualizer { width: 48px; height: 22px; }
      .audio-bar { width: 3px; }
    }
    
    @media (max-width: 480px) {
      :host { height: 100px; }
      .slider-container { height: 72px; }
      .slider-track { height: 9px; }
      .slider-thumb { width: 22px; height: 22px; }
      .value-display { font-size: 10px; padding: 5px 8px; }
      .audio-visualizer { width: 44px; height: 20px; }
    }
  `;In([U({type:Number})],wt.prototype,"value",2);In([U({type:String})],wt.prototype,"color",2);In([U({type:Number})],wt.prototype,"audioLevel",2);wt=In([ye("weight-slider")],wt);var Cg=Object.defineProperty,xg=Object.getOwnPropertyDescriptor,se=(i,e,t,n)=>{for(var s=n>1?void 0:n?xg(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Cg(e,t,s),s};let j=class extends ie{constructor(){super(...arguments),this.promptId="",this.text="",this.weight=0,this.color="",this.filtered=!1,this.cc=0,this.channel=0,this.learnMode=!1,this.showCC=!1,this.midiDispatcher=null,this.audioLevel=0}connectedCallback(){var i;super.connectedCallback(),(i=this.midiDispatcher)==null||i.addEventListener("cc-message",e=>{const t=e,{channel:n,cc:s,value:o}=t.detail;this.learnMode?(this.cc=s,this.channel=n,this.learnMode=!1,this.dispatchPromptChange()):s===this.cc&&(this.weight=o/127*2,this.dispatchPromptChange())})}firstUpdated(){this.textInput.setAttribute("contenteditable","plaintext-only"),this.textInput.textContent=this.text,this.lastValidText=this.text}update(i){i.has("showCC")&&!this.showCC&&(this.learnMode=!1),i.has("text")&&this.textInput&&(this.textInput.textContent=this.text),super.update(i)}dispatchPromptChange(){this.dispatchEvent(new CustomEvent("prompt-changed",{detail:{promptId:this.promptId,text:this.text,weight:this.weight,cc:this.cc,color:this.color}}))}onKeyDown(i){i.key==="Enter"&&(i.preventDefault(),this.textInput.blur()),i.key==="Escape"&&(i.preventDefault(),this.resetText(),this.textInput.blur())}resetText(){this.text=this.lastValidText,this.textInput.textContent=this.lastValidText}async updateText(){var e;const i=(e=this.textInput.textContent)==null?void 0:e.trim();i?(this.text=i,this.lastValidText=i):this.resetText(),this.dispatchPromptChange(),this.textInput.scrollLeft=0}onFocus(){const i=window.getSelection();if(!i)return;const e=document.createRange();e.selectNodeContents(this.textInput),i.removeAllRanges(),i.addRange(e)}updateWeight(){this.weight=this.weightInput.value,this.dispatchPromptChange()}toggleLearnMode(){this.learnMode=!this.learnMode}render(){const i=Wr({prompt:!0,"learn-mode":this.learnMode,"show-cc":this.showCC});return A`<div class=${i}>
      <div class="prompt-indicator ${this.weight>0?"active":""}" style="color: ${this.color}"></div>
      
      <weight-slider
        id="weight"
        value=${this.weight}
        color=${this.filtered?"#888":this.color}
        audioLevel=${this.filtered?0:this.audioLevel}
        @input=${this.updateWeight}></weight-slider>
      
      <span
        id="text"
        spellcheck="false"
        @focus=${this.onFocus}
        @keydown=${this.onKeyDown}
        @blur=${this.updateText}></span>
      
      <div id="midi" @click=${this.toggleLearnMode}>
        ${this.learnMode?"Learn":`CC:${this.cc}`}
      </div>
    </div>`}};j.styles=me`
    .prompt {
      width: 95%;
      height: 95%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 0.6rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      margin: auto;
    }
    
    .prompt::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }
    
    .prompt:hover::before {
      opacity: 1;
    }
    
    .prompt:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    weight-slider {
      width: 80%;
      flex-shrink: 0;
      margin-bottom: 0.5rem;
    }
    
    #midi {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      text-align: center;
      font-size: 0.75rem;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      padding: 0.25rem 0.5rem;
      color: rgba(255, 255, 255, 0.8);
      background: rgba(0, 0, 0, 0.3);
      cursor: pointer;
      visibility: hidden;
      user-select: none;
      margin-top: 0.5rem;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
      font-weight: 500;
      
      .learn-mode & {
        color: #fbbf24;
        border-color: #fbbf24;
        background: rgba(251, 191, 36, 0.1);
        animation: pulse 1.5s ease-in-out infinite;
      }
      
      .show-cc & {
        visibility: visible;
      }
      
      &:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-1px);
      }
    }
    
    #text {
      font-weight: 600;
      font-size: 0.9rem;
      max-width: 100%;
      min-width: 60px;
      padding: 0.5rem 0.75rem;
      margin: 0.5rem 0;
      flex-shrink: 0;
      border-radius: 8px;
      text-align: center;
      white-space: pre;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      outline: none;
      -webkit-font-smoothing: antialiased;
      background: rgba(0, 0, 0, 0.4);
      color: #fff;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
      
      &:not(:focus) {
        text-overflow: ellipsis;
      }
      
      &:focus {
        border-color: rgba(255, 255, 255, 0.4);
        background: rgba(0, 0, 0, 0.6);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
      }
    }
    
    :host([filtered]) {
      weight-slider { 
        opacity: 0.5;
      }
      
      #text {
        background: rgba(220, 38, 38, 0.8);
        border-color: rgba(220, 38, 38, 0.6);
        color: #fff;
        position: relative;
        z-index: 1;
      }
      
      .prompt::after {
        content: 'FILTERED';
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background: rgba(220, 38, 38, 0.9);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.6rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
    }
    
    .prompt-indicator {
      position: absolute;
      top: 0.5rem;
      left: 0.5rem;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }
    
    .prompt-indicator.active {
      background: currentColor;
      box-shadow: 0 0 10px currentColor;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }
    
    @media only screen and (max-width: 768px) {
      .prompt {
        width: 92%;
        height: 92%;
        padding: 0.5rem;
        border-radius: 12px;
      }
      
      #text {
        font-size: 0.8rem;
        padding: 0.4rem 0.6rem;
      }
      
      #midi {
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
      }
      
      weight-slider {
        width: 70%;
      }
    }
  `;se([U({type:String})],j.prototype,"promptId",2);se([U({type:String})],j.prototype,"text",2);se([U({type:Number})],j.prototype,"weight",2);se([U({type:String})],j.prototype,"color",2);se([U({type:Boolean,reflect:!0})],j.prototype,"filtered",2);se([U({type:Number})],j.prototype,"cc",2);se([U({type:Number})],j.prototype,"channel",2);se([U({type:Boolean})],j.prototype,"learnMode",2);se([U({type:Boolean})],j.prototype,"showCC",2);se([Vr("weight-slider")],j.prototype,"weightInput",2);se([Vr("#text")],j.prototype,"textInput",2);se([U({type:Object})],j.prototype,"midiDispatcher",2);se([U({type:Number})],j.prototype,"audioLevel",2);j=se([ye("prompt-controller")],j);var Tg=Object.defineProperty,Sg=Object.getOwnPropertyDescriptor,Jr=(i,e,t,n)=>{for(var s=n>1?void 0:n?Sg(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Tg(e,t,s),s};let _n=class extends ie{constructor(){super(...arguments),this.playbackState="stopped"}renderIcon(){const e="0 0 24 24";return this.playbackState==="playing"?On`<svg viewBox=${e} fill="currentColor">
        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
      </svg>`:this.playbackState==="loading"?On`<svg viewBox=${e} fill="none" stroke="currentColor">
        <circle class="loader" cx="12" cy="12" r="10" stroke-width="2"/>
      </svg>`:On`<svg viewBox=${e} fill="currentColor">
        <path d="M8 5v14l11-7z"/>
      </svg>`}render(){const i=this.playbackState==="playing"?"playing":"",e=this.playbackState==="playing"?"Pause":"Play";return A`
      <button
        class="button-container ${i}"
        type="button"
        aria-label="${e}"
        aria-pressed="${this.playbackState==="playing"}">
        <div class="icon-container">
          ${this.renderIcon()}
        </div>
        <div class="status-indicator ${this.playbackState==="playing"?"playing":""}"></div>
      </button>
    `}};_n.styles=me`
    :host {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 48px;
    }
    
    :host(:hover) .button-container {
      transform: scale(1.05);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
    }
    
    .button-container {
      position: relative;
      width: 100%;
      height: 100%;
      padding: 0;
      border: 3px solid #444;
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 50%, #0f0f0f 100%);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 1.56, 0.32, 0.99);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.6), 
        inset 0 2px 4px rgba(255, 255, 255, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.05);
    }
    
    .button-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #29F2C6 0%, #0FC9A7 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .button-container:hover::before {
      opacity: 0.15;
    }
    
    .button-container.playing {
      border-color: #29F2C6;
      box-shadow: 
        0 6px 30px rgba(41, 242, 198, 0.4), 
        inset 0 2px 4px rgba(255, 255, 255, 0.2),
        0 0 0 1px rgba(41, 242, 198, 0.3);
      animation: playingPulse 2s ease-in-out infinite;
    }
    
    @keyframes playingPulse {
      0%, 100% { 
        box-shadow: 
          0 6px 30px rgba(41, 242, 198, 0.4), 
          inset 0 2px 4px rgba(255, 255, 255, 0.2),
          0 0 0 1px rgba(41, 242, 198, 0.3);
      }
      50% { 
        box-shadow: 
          0 8px 40px rgba(41, 242, 198, 0.6), 
          inset 0 2px 4px rgba(255, 255, 255, 0.3),
          0 0 0 2px rgba(41, 242, 198, 0.5);
      }
    }
    
    .button-container.playing::before {
      opacity: 0.25;
    }
    
    .icon-container {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 65%;
      height: 65%;
      color: #e0e0e0;
      transition: all 0.3s ease;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
    }
    
    .icon-container svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.8));
    }
    
    .button-container.playing .icon-container {
      color: #29F2C6;
      filter: drop-shadow(0 0 15px rgba(41, 242, 198, 0.8));
    }
    
    .loader {
      stroke: currentColor;
      stroke-width: 3;
      stroke-linecap: round;
      animation: spin linear 1s infinite;
      transform-origin: center;
      transform-box: fill-box;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(359deg); }
    }
    
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(41, 242, 198, 0.4);
      transform: scale(0);
      animation: ripple 0.8s linear;
      pointer-events: none;
    }
    
    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    
    .status-indicator {
      position: absolute;
      top: -10px;
      right: -10px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: linear-gradient(135deg, #29F2C6 0%, #0FC9A7 100%);
      border: 3px solid #1a1a1a;
      opacity: 0;
      transition: opacity 0.3s ease;
      box-shadow: 0 4px 15px rgba(41, 242, 198, 0.6);
    }
    
    .status-indicator.playing {
      opacity: 1;
      animation: statusPulse 2s ease-in-out infinite;
    }
    
    @keyframes statusPulse {
      0%, 100% { 
        transform: scale(1); 
        box-shadow: 0 4px 15px rgba(41, 242, 198, 0.6);
      }
      50% { 
        transform: scale(1.2); 
        box-shadow: 0 6px 25px rgba(41, 242, 198, 0.8);
      }
    }
    
    /* Professional DAW-style button states */
    .button-container:active {
      transform: scale(0.98);
      box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.8), 
        inset 0 2px 4px rgba(255, 255, 255, 0.05);
    }
    
    .button-container:focus {
      outline: none;
      border-color: #29F2C6;
      box-shadow: 
        0 0 0 4px rgba(41, 242, 198, 0.3),
        0 6px 20px rgba(0, 0, 0, 0.6);
    }
    
    /* Enhanced hover effects */
    .button-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 255, 255, 0.1) 50%, 
        transparent 100%);
      transition: left 0.6s ease;
    }
    
    .button-container:hover::after {
      left: 100%;
    }
    
    /* Professional button glow effect */
    .button-container.playing::after {
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(41, 242, 198, 0.2) 50%, 
        transparent 100%);
    }
  `;Jr([U({type:String})],_n.prototype,"playbackState",2);_n=Jr([ye("play-pause-button")],_n);var Eg=Object.defineProperty,Ag=Object.getOwnPropertyDescriptor,Ye=(i,e,t,n)=>{for(var s=n>1?void 0:n?Ag(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Eg(e,t,s),s};let xe=class extends ie{constructor(){super(...arguments),this.currentTime=0,this.duration=120,this.bpm=120,this.timeSignature=4,this.zoom=1,this.isPlaying=!1}getMeasures(){const i=[],e=this.timeSignature,t=60/this.bpm,n=e*t;for(let s=0;s<=Math.ceil(this.duration/n);s++){const o=s*n/this.duration*100;i.push({position:o,number:s+1,isMajor:s%4===0})}return i}getBeats(){const i=[],e=60/this.bpm;for(let t=0;t<=Math.ceil(this.duration/e);t++){const n=t*e/this.duration*100;i.push({position:n,isStrong:t%this.timeSignature===0})}return i}formatTime(i){const e=Math.floor(i/60),t=Math.floor(i%60),n=Math.floor(i%1*30);return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}getPlayheadPosition(){return`${this.currentTime/this.duration*100}%`}render(){const i=this.getMeasures(),e=this.getBeats(),t=this.getPlayheadPosition();return A`
      <div class="timeline-container">
        <!-- Measure Ruler -->
        <div class="measure-ruler">
          ${i.map(n=>A`
            <div class="measure-marker ${n.isMajor?"major":""}" style="left: ${n.position}%">
              ${n.isMajor?A`<span class="measure-label">${n.number}</span>`:""}
            </div>
          `)}
        </div>
        
        <!-- Beat Ruler -->
        <div class="beat-ruler">
          ${e.map(n=>A`
            <div class="beat-marker ${n.isStrong?"strong":"weak"}" style="left: ${n.position}%"></div>
          `)}
        </div>
        
        <!-- Playhead -->
        <div class="playhead" style="left: ${t}"></div>
        
        <!-- Grid Snap Lines -->
        <div class="grid-snap">
          ${e.map(n=>A`
            <div class="snap-line ${n.isStrong?"active":""}" style="left: ${n.position}%"></div>
          `)}
        </div>
        
        <!-- Time Display -->
        <div class="time-display">
          ${this.formatTime(this.currentTime)}
        </div>
        
        <!-- Tempo Display -->
        <div class="tempo-display">
          ${this.bpm} BPM
        </div>
      </div>
    `}};xe.styles=me`
    :host {
      display: block;
      width: 100%;
      height: 50px;
      background: linear-gradient(180deg, var(--panel-2) 0%, var(--bg) 100%);
      border-bottom: 2px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    
    .timeline-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    .measure-ruler {
      height: 25px;
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border-bottom: 2px solid var(--border);
      position: relative;
      display: flex;
      align-items: center;
      padding: 0 25px;
    }
    
    .beat-ruler {
      height: 25px;
      background: linear-gradient(180deg, #222 0%, var(--panel-2) 100%);
      position: relative;
      display: flex;
      align-items: center;
      padding: 0 25px;
    }
    
    .measure-marker {
      position: absolute;
      height: 100%;
      width: 1px;
      background: #555;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 3px;
      transition: all 0.2s ease;
    }
    
    .measure-marker:hover {
      background: #777;
      width: 2px;
    }
    
    .measure-marker.major {
      background: #777;
      width: 2px;
    }
    
    .measure-marker.major:hover {
      background: #999;
      width: 3px;
    }
    
    .measure-label {
      font-size: 11px;
      color: var(--muted);
      font-weight: 700;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      transform: rotate(-45deg);
      transform-origin: center;
      white-space: nowrap;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      transition: all 0.2s ease;
    }
    
    .measure-marker:hover .measure-label {
      color: #ccc;
      transform: rotate(-45deg) scale(1.1);
    }
    
    .beat-marker {
      position: absolute;
      height: 100%;
      width: 1px;
      background: #333;
      transition: all 0.2s ease;
    }
    
    .beat-marker:hover {
      background: #555;
      width: 2px;
    }
    
    .beat-marker.strong {
      background: #555;
      width: 1px;
    }
    
    .beat-marker.strong:hover {
      background: #777;
      width: 2px;
    }
    
    .beat-marker.weak {
      background: #222;
      width: 1px;
    }
    
    .beat-marker.weak:hover {
      background: #444;
      width: 2px;
    }
    
    .playhead {
      position: absolute;
      top: 0;
      width: 3px;
      height: 100%;
      background: linear-gradient(180deg, var(--brand) 0%, var(--brand-2) 100%);
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
      z-index: 10;
      transition: left 0.1s ease;
      position: relative;
    }
    
    .playhead::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 255, 136, 0.3) 50%, 
        transparent 100%);
      animation: playheadGlow 2s ease-in-out infinite;
    }
    
    @keyframes playheadGlow {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }
    
    .playhead::after {
      content: '';
      position: absolute;
      top: 0;
      left: -4px;
      width: 10px;
      height: 10px;
      background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.9);
      border: 2px solid #0f0f0f;
    }
    
    .time-display {
      position: absolute;
      top: 3px;
      right: 25px;
      background: linear-gradient(135deg, var(--panel-2) 0%, var(--bg) 100%);
      color: var(--brand);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      border: 2px solid var(--border);
      z-index: 20;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
      letter-spacing: 0.5px;
    }
    
    .time-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #00ff88 50%, transparent 100%);
      opacity: 0.6;
    }
    
    .tempo-display {
      position: absolute;
      top: 3px;
      left: 25px;
      background: linear-gradient(135deg, var(--panel-2) 0%, var(--bg) 100%);
      color: var(--muted);
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      border: 2px solid var(--border);
      z-index: 20;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
      letter-spacing: 0.5px;
    }
    
    .tempo-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #aaa 50%, transparent 100%);
      opacity: 0.4;
    }
    
    .grid-snap {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    
    .snap-line {
      position: absolute;
      height: 100%;
      width: 1px;
      background: rgba(0, 255, 136, 0.15);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .snap-line.active {
      opacity: 1;
      background: rgba(0, 255, 136, 0.25);
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
    }
    
    /* Grid overlay for better visual reference */
    .grid-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background-image: 
        linear-gradient(90deg, rgba(0, 255, 136, 0.02) 1px, transparent 1px),
        linear-gradient(180deg, rgba(0, 255, 136, 0.02) 1px, transparent 1px);
      background-size: 20px 20px;
      opacity: 0.3;
    }
  `;Ye([U({type:Number})],xe.prototype,"currentTime",2);Ye([U({type:Number})],xe.prototype,"duration",2);Ye([U({type:Number})],xe.prototype,"bpm",2);Ye([U({type:Number})],xe.prototype,"timeSignature",2);Ye([U({type:Number})],xe.prototype,"zoom",2);Ye([U({type:Boolean})],xe.prototype,"isPlaying",2);xe=Ye([ye("timeline-ruler")],xe);var kg=Object.defineProperty,Ig=Object.getOwnPropertyDescriptor,Kr=(i,e,t,n)=>{for(var s=n>1?void 0:n?Ig(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&kg(e,t,s),s};let wn=class extends ie{constructor(){super(...arguments),this.open=!1,this.close=()=>this.dispatchEvent(new CustomEvent("close"))}render(){return this.open?A`
      <div class="backdrop" @click=${this.close}></div>
      <div class="sheet" @click=${i=>i.stopPropagation()}>
        <div class="head">
          <div class="brand">Music Maker  Quick Guide</div>
          <button class="close" @click=${this.close}>Close</button>
        </div>
        <div class="content">
          <h3>Make music</h3>
          <ul>
            <li>Select styles from the left panel to add them to the grid (max slots shown in toolbar).</li>
            <li>Press Play. Move grid sliders to blend styles; higher = louder/denser for that style.</li>
            <li>Remove a style: click the  on its tile. Nongrid styles are silent.</li>
          </ul>

          <h3>Scenes (instant morphs)</h3>
          <ul>
            <li>Open Scenes in the toolbar. Click Save Scene to capture current mix and grid.</li>
            <li>Recall a scene to morph weights over 1/2/4/8s. Use  to rename,  to delete.</li>
          </ul>

          <h3>Evolve (auto changes)</h3>
          <ul>
            <li>Toggle EVOLVE in the toolbar for subtle, periodic variation of active styles.</li>
            <li>Use Rate and Depth selects to set how often and how much it changes.</li>
          </ul>

          <h3>MIDI control</h3>
          <ul>
            <li>Click Click to learn on a grid slot, then turn a knob to bind that slot to a MIDI CC.</li>
            <li>Instrument sliders can also be mapped via their Click to learn.</li>
            <li>Desktop: enter Up,Up,Down,Down,Left,Right,Left,Right to unlock slot CC presets (CC4855).</li>
          </ul>

          <h3>Record & export</h3>
          <ul>
            <li>Use  to capture a take. Open Export to download WAV or MP3.</li>
          </ul>

          <h3>Tips</h3>
          <ul>
            <li>For clean transitions, lower one style while raising another, or recall a Scene.</li>
            <li>Keep drums/bass steady while morphing leads/chords for DJtight blends.</li>
          </ul>

          <h3>Troubleshooting</h3>
          <ul>
            <li>No sound: ensure at least one grid slider is above zero; then press Play.</li>
            <li>Connection lost: app autoreconnects; you may hear a short bumper, then music resumes.</li>
            <li>Filtered text: if a style is blocked, try a different wording/genre.</li>
          </ul>
        </div>
      </div>
    `:A``}};wn.styles=me`
    :host { position: fixed; inset: 0; display: block; z-index: 2000; }
    .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.6); }
    .sheet {
      position: absolute; right: 0; top: 0; bottom: 0; width: min(520px, 100%);
      background: var(--panel-2, #151515);
      border-left: 1px solid var(--border, #262626);
      box-shadow: -20px 0 60px rgba(0,0,0,0.5);
      display: flex; flex-direction: column;
    }
    .head { display:flex; align-items:center; justify-content:space-between; padding:16px 18px; border-bottom:1px solid var(--border, #262626); }
    .brand { display:flex; align-items:center; gap:10px; color: var(--text, #e5e5e5); font-weight: 900; letter-spacing: .5px; }
    .close { background: transparent; border: 1px solid var(--border, #262626); color: var(--text, #e5e5e5); border-radius: 6px; padding: 6px 10px; cursor: pointer; }
    .content { padding: 16px 18px; overflow: auto; }
    h3 { margin: 16px 0 8px; color: var(--brand, #29F2C6); }
    ul { margin: 0 0 12px 20px; }
    li { margin: 6px 0; line-height: 1.5; color: var(--text, #e5e5e5); }
    .kbd { display:inline-block; padding:2px 6px; border:1px solid var(--border,#262626); border-radius:4px; background: var(--panel,#111); font-size: 12px; }
  `;Kr([U({type:Boolean,reflect:!0})],wn.prototype,"open",2);wn=Kr([ye("help-panel")],wn);var Mg=Object.defineProperty,Pg=Object.getOwnPropertyDescriptor,Yr=(i,e,t,n)=>{for(var s=n>1?void 0:n?Pg(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Mg(e,t,s),s};let bn=class extends ie{constructor(){super(...arguments),this.step=0,this.steps=[{title:"Welcome to deeprabbit",text:"Use the Styles panel to choose styles for your performance."},{title:"Blend styles",text:"Adjust the sliders in the grid and click Click to learn to map MIDI controls."},{title:"Manage instruments",text:"Use the mixer panel to balance instrument layers and map their controls."}]}next(){this.step<this.steps.length-1?this.step++:this.finish()}prev(){this.step>0&&this.step--}skip(){this.finish()}finish(){this.dispatchEvent(new CustomEvent("finish"))}render(){const i=this.steps[this.step];return A`
      <div class="backdrop"></div>
      <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="onboard-title" aria-live="polite">
        <h2 id="onboard-title">${i.title}</h2>
        <p>${i.text}</p>
        <div class="actions">
          ${this.step>0?A`<button @click=${this.prev} aria-label="Previous step">Back</button>`:""}
          ${this.step<this.steps.length-1?A`
            <button @click=${this.skip} aria-label="Skip tutorial">Skip</button>
            <button @click=${this.next} aria-label="Next step">Next</button>
          `:A`<button @click=${this.finish} aria-label="Finish tutorial">Finish</button>`}
        </div>
      </div>
    `}};bn.styles=me`
    :host { position: fixed; inset: 0; z-index: 3000; display: flex; align-items: center; justify-content: center; }
    .backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.7); }
    .sheet {
      position: relative;
      background: var(--panel-2, #151515);
      border: 1px solid var(--border, #262626);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
      padding: 24px;
      width: 90%;
      max-width: 400px;
      color: var(--text, #e5e5e5);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    h2 { margin: 0; font-size: 20px; color: var(--brand, #29F2C6); }
    p { margin: 0; line-height: 1.4; }
    .actions { display: flex; justify-content: space-between; gap: 10px; }
    button { flex: 1; padding: 10px 14px; border: 1px solid var(--border, #262626); border-radius: 6px; background: var(--panel, #111); color: var(--text, #e5e5e5); cursor: pointer; }
    button:hover { background: var(--panel-2, #151515); }
    @media (max-width: 480px) {
      .sheet { width: 95%; padding: 20px; }
      h2 { font-size: 18px; }
    }
  `;Yr([G()],bn.prototype,"step",2);bn=Yr([ye("onboarding-tutorial")],bn);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/class Rg extends EventTarget{constructor(){super(...arguments),this.access=null,this.activeMidiInputId=null}async getMidiAccess(){if(this.access)return[...this.access.inputs.keys()];if(!navigator.requestMIDIAccess)throw new Error("Your browser does not support the Web MIDI API. For a list of compatible browsers, see https://caniuse.com/midi");if(this.access=await navigator.requestMIDIAccess({sysex:!1}).catch(t=>t),this.access===null)throw new Error("Unable to acquire MIDI access.");const e=[...this.access.inputs.keys()];e.length>0&&this.activeMidiInputId===null&&(this.activeMidiInputId=e[0]);for(const t of this.access.inputs.values())t.onmidimessage=n=>{if(t.id!==this.activeMidiInputId)return;const{data:s}=n;if(!s){console.error("MIDI message has no data");return}const o=s[0],r=o&15;if(!((o&240)===176))return;const d={cc:s[1],value:s[2],channel:r};this.dispatchEvent(new CustomEvent("cc-message",{detail:d}))};return e}getDeviceName(e){if(!this.access)return null;const t=this.access.inputs.get(e);return t?t.name:null}}async function Dg(i){const e=await fetch(`/api/plan?userId=${encodeURIComponent(i)}`);if(!e.ok)throw new Error("plan fetch failed");return await e.json()}var $g=Object.defineProperty,Ng=Object.getOwnPropertyDescriptor,zt=(i,e,t,n)=>{for(var s=n>1?void 0:n?Ng(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&$g(e,t,s),s};let Ke=class extends ie{constructor(){super(...arguments),this.userId="",this.email="",this.inline=!1,this.plan="loading"}connectedCallback(){super.connectedCallback(),this.loadPlan()}async loadPlan(){if(!this.userId){this.plan="free";return}try{const i=await Dg(this.userId);this.plan=i.plan}catch{this.plan="free"}}async upgrade(){const e=await(await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,email:this.email})})).json();window.location.href=e.url}async manage(){const e=await(await fetch("/api/portal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId})})).json();window.location.href=e.url}render(){return this.plan==="loading"?A`<span style="opacity:.7"></span>`:this.plan==="pro"?A`<slot></slot>`:this.inline?A`<button class="inline-btn" @click=${this.upgrade} title="Upgrade to Pro to use this">Pro</button>`:A`<div class="upgrade">
      <slot name="fallback"><p>Unlock DeepRabbit Pro to use this feature.</p></slot>
      <button @click=${this.upgrade}>Upgrade</button>
      <button @click=${this.manage}>Manage billing</button>
    </div>`}};Ke.styles=me`
    :host { display: inline-block; }
    .upgrade {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 1rem;
      border: 1px solid #333;
      border-radius: 8px;
      background: #1a1a1a;
      color: #fff;
    }
    button {
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #29f2c6;
      color: #000;
      font-weight: 600;
    }
    .inline-btn {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid #444;
      color: #e0e0e0;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }
    .inline-btn:hover {
      background: linear-gradient(135deg, #333 0%, #2a2a2a 100%);
      border-color: #555;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }
  `;zt([U({type:String,attribute:"user-id"})],Ke.prototype,"userId",2);zt([U({type:String})],Ke.prototype,"email",2);zt([U({type:Boolean,reflect:!0})],Ke.prototype,"inline",2);zt([G()],Ke.prototype,"plan",2);Ke=zt([ye("require-pro")],Ke);var Lg=Object.defineProperty,Og=Object.getOwnPropertyDescriptor,B=(i,e,t,n)=>{for(var s=n>1?void 0:n?Og(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Lg(e,t,s),s};let O=class extends ie{constructor(i){var e;if(super(),this.maxSelectedPrompts=8,this.recorder=null,this.showExportMenu=!1,this.userId="",this.userEmail="",this.showTutorial=!1,this.isRecording=!1,this.autoEvolveEnabled=!1,this.autoEvolveRateSec=16,this.autoEvolveDepth=.15,this.evolveTimer=null,this.styleSearchQuery="",this.selectedOrder=[],this.showAllPrompts=!1,this.isMobile=!1,this.showMobileMenu=!1,this.SELECTED_ORDER_STORAGE_KEY="pdjmidi_selected_order",this.PROMPT_WEIGHTS_STORAGE_KEY="pdjmidi_prompt_weights",this.STYLE_COUNT_STORAGE_KEY="pdjmidi_style_count",this.SHOW_ALL_GRID_STORAGE_KEY="pdjmidi_show_all",this.SCENES_STORAGE_KEY="pdjmidi_scenes",this.showMidi=!1,this.playbackState="stopped",this.audioLevel=0,this.currentTime=0,this.midiInputIds=[],this.activeMidiInputId=null,this.learningPromptId=null,this.learningInstrumentId=null,this.selectedPromptIds=new Set,this.selectedInstrumentId=null,this.learningSlotIndex=null,this.slotCcMap=new Map,this.SLOT_CC_STORAGE_KEY="pdjmidi_slot_cc_mappings",this.PROMPT_CC_STORAGE_KEY="pdjmidi_prompt_cc_mappings",this.INSTR_CC_STORAGE_KEY="pdjmidi_instrument_cc_mappings",this.scenes=[],this.showScenesMenu=!1,this.sceneMorphSec=4,this.konamiUnlocked=!1,this.konamiIndex=0,this.konamiSeq=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight"],this.showHelp=!1,this.filteredPrompts=new Set,this.filteredInstruments=new Set,this.makeBackground=Br(()=>{const t=r=>Math.min(Math.max(r,0),1),o=[];return[...this.prompts.values()].forEach((r,c)=>{const u=t(r.weight/.5)*.6,d=Math.round(u*255).toString(16).padStart(2,"0"),h=r.weight/2,f=c%4/3,p=Math.floor(c/4)/3,g=`radial-gradient(circle at ${f*100}% ${p*100}%, ${r.color}${d} 0px, ${r.color}00 ${h*100}%)`;o.push(g)}),o.join(", ")},30),this.saveScene=()=>{const t={};this.prompts.forEach((o,r)=>{t[r]=o.weight||0});const n=this.scenes.length+1,s={id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:`Scene ${n}`,weights:t,selectedOrder:[...this.selectedOrder]};this.scenes=[...this.scenes,s],this.persistScenes(),this.showScenesMenu=!0},this.deleteScene=t=>{this.scenes=this.scenes.filter(n=>n.id!==t),this.persistScenes()},this.renameScene=t=>{var s;const n=prompt("Rename scene to:",((s=this.scenes.find(o=>o.id===t))==null?void 0:s.name)||"Scene");n&&(this.scenes=this.scenes.map(o=>o.id===t?{...o,name:n}:o),this.persistScenes())},this.recallScene=t=>{const n=this.scenes.find(d=>d.id===t);if(!n)return;this.selectedOrder=[...n.selectedOrder],this.selectedPromptIds=new Set(this.selectedOrder);const s={};this.prompts.forEach((d,h)=>{s[h]=d.weight||0});const o=n.weights,r=Math.max(.1,this.sceneMorphSec)*1e3,c=performance.now(),u=()=>{const d=performance.now(),h=Math.min(1,(d-c)/r),f=h,p=new Map(this.prompts);let g=!1;p.forEach((m,y)=>{const v=s[y]??0,w=o[y]??0,S=v+(w-v)*f;Math.abs((m.weight||0)-S)>.001&&(m.weight=Math.max(0,Math.min(2,S)),p.set(y,m),g=!0)}),g&&(this.prompts=p,this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts}))),h<1?requestAnimationFrame(u):this.savePromptWeights()};requestAnimationFrame(u),this.showScenesMenu=!1},this.resetAll=()=>{this.selectedOrder=[],this.selectedPromptIds=new Set;const t=new Map(this.prompts);t.forEach(n=>{n.weight!==0&&(n.weight=0)}),this.prompts=t,this.saveSelectedOrder(),this.savePromptWeights(),this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts}))},this.toggleShowAll=()=>{this.showAllPrompts=!this.showAllPrompts,this.saveShowAll(),this.showAllPrompts||this.resetWeightsForNonDisplayedPrompts(),this.requestUpdate()},this.randomizeGrid=()=>{const t=[...this.prompts.keys()],n=Math.min(this.maxSelectedPrompts,t.length);for(let o=t.length-1;o>0;o--){const r=Math.floor(Math.random()*(o+1));[t[o],t[r]]=[t[r],t[o]]}const s=t.slice(0,n);this.selectedOrder=s,this.selectedPromptIds=new Set(this.selectedOrder),this.resetWeightsForNonDisplayedPrompts(),this.saveSelectedOrder(),this.requestUpdate()},this.presetSlotCcMap=()=>{const t=this.selectedOrder.map(s=>this.prompts.get(s)).filter(s=>!!s).slice(0,this.maxSelectedPrompts),n=new Map;for(let s=0;s<t.length;s++){const o=48+s%8;n.set(s,o)}this.slotCcMap=n,this.saveSlotMappings(),this.requestUpdate()},this.prompts=i,this.instruments=new Map([["piano",{promptId:"piano",text:"Piano",weight:0,color:"#FF6B6B",cc:0}],["guitar",{promptId:"guitar",text:"Guitar",weight:0,color:"#4ECDC4",cc:0}],["drums",{promptId:"drums",text:"Drums",weight:0,color:"#45B7D1",cc:0}],["bass",{promptId:"bass",text:"Bass",weight:0,color:"#96CEB4",cc:0}],["strings",{promptId:"strings",text:"Strings",weight:0,color:"#FFEAA7",cc:0}],["synth",{promptId:"synth",text:"Synth",weight:0,color:"#DDA0DD",cc:0}],["brass",{promptId:"brass",text:"Brass",weight:0,color:"#FFB347",cc:0}],["woodwind",{promptId:"woodwind",text:"Woodwind",weight:0,color:"#98D8C8",cc:0}]]),this.midiDispatcher=new Rg,this.midiDispatcher.addEventListener("cc-message",t=>{const n=t,{cc:s,value:o}=n.detail;if(this.learningSlotIndex!==null){this.slotCcMap=new Map(this.slotCcMap.set(this.learningSlotIndex,s)),this.learningSlotIndex=null,this.saveSlotMappings(),this.requestUpdate();return}if(this.slotCcMap.size>0){const r=this.selectedOrder.map(c=>this.prompts.get(c)).filter(c=>!!c).slice(0,this.maxSelectedPrompts);for(let c=0;c<r.length;c++){const u=this.slotCcMap.get(c);if(u&&u===s){const d=o/127*2;this.handleSliderChange(r[c].promptId,d)}}}if(this.learningPromptId){const r=this.prompts.get(this.learningPromptId);if(r){r.cc=s;const c=new Map(this.prompts);c.set(this.learningPromptId,r),this.prompts=c,this.learningPromptId=null,this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts})),this.saveMidiMappings()}}else if(this.learningInstrumentId){const r=this.instruments.get(this.learningInstrumentId);if(r){r.cc=s;const c=new Map(this.instruments);c.set(this.learningInstrumentId,r),this.instruments=c,this.learningInstrumentId=null,this.requestUpdate(),this.dispatchEvent(new CustomEvent("instrument-changed",{detail:r})),this.saveMidiMappings()}}else{const r=o/127*2;let c=!1;this.prompts.forEach(u=>{u.cc>0&&u.cc===s&&(this.handleSliderChange(u.promptId,r),c=!0)}),this.instruments.forEach(u=>{u.cc>0&&u.cc===s&&this.handleInstrumentChange(u.promptId,r)}),c&&this.requestUpdate()}}),this.loadPromptWeights(),(e=this.loadStyleCount)==null||e.call(this),this.loadSelectedOrder(),this.selectedOrder.length===0){const t=[...this.prompts.values()].filter(n=>(n.weight??0)>.001).sort((n,s)=>(s.weight||0)-(n.weight||0));for(const n of t){if(this.selectedOrder.length>=this.maxSelectedPrompts)break;this.selectedOrder.push(n.promptId)}if(this.selectedOrder.length===0){const n=[...this.prompts.keys()];for(let c=n.length-1;c>0;c--){const u=Math.floor(Math.random()*(c+1));[n[c],n[u]]=[n[u],n[c]]}const s=Math.min(4,n.length),o=n.slice(0,s);this.selectedOrder=o;const r=new Map(this.prompts);o.forEach(c=>{const u=r.get(c);u&&(u.weight=1,r.set(c,u))}),this.prompts=r,this.saveSelectedOrder(),this.savePromptWeights()}}this.selectedPromptIds=new Set(this.selectedOrder),this.loadMidiMappings(),this.loadSlotMappings(),this.loadShowAll(),this.loadScenes()}firstUpdated(){try{localStorage.getItem("deeprabbit_onboarded")||(this.showTutorial=!0)}catch{}}handleTutorialFinish(){this.showTutorial=!1;try{localStorage.setItem("deeprabbit_onboarded","1")}catch{}}connectedCallback(){super.connectedCallback(),this._onKeyDown=this._onKeyDown.bind(this),window.addEventListener("keydown",this._onKeyDown),this.mql=window.matchMedia("(max-width: 768px)");const i=()=>{var e;this.isMobile=!!((e=this.mql)!=null&&e.matches),this.isMobile||(this.showMobileMenu=!1),this.requestUpdate()};this.mql.addEventListener?this.mql.addEventListener("change",i):this.mql.addListener(i),i()}disconnectedCallback(){var i,e;if(window.removeEventListener("keydown",this._onKeyDown),this.mql){const t=()=>{};try{(e=(i=this.mql).removeEventListener)==null||e.call(i,"change",t)}catch{}}super.disconnectedCallback()}_onKeyDown(i){const e=i.key,t=this.konamiSeq[this.konamiIndex];e===t?(this.konamiIndex+=1,this.konamiIndex===this.konamiSeq.length&&(this.konamiUnlocked=!0,this.konamiIndex=0)):this.konamiIndex=e===this.konamiSeq[0]?1:0,i.key==="?"||i.key==="/"?(i.preventDefault(),this.toggleHelp()):i.key==="Escape"&&this.isMobile&&this.showMobileMenu&&(i.preventDefault(),this.showMobileMenu=!1,this.requestUpdate())}saveSlotMappings(){try{const i={};this.slotCcMap.forEach((e,t)=>{i[t.toString()]=e}),localStorage.setItem(this.SLOT_CC_STORAGE_KEY,JSON.stringify(i))}catch{}}loadSlotMappings(){try{const i=localStorage.getItem(this.SLOT_CC_STORAGE_KEY);if(!i)return;const e=JSON.parse(i),t=new Map;Object.entries(e).forEach(([n,s])=>t.set(Number(n),s)),this.slotCcMap=t}catch{}}saveMidiMappings(){try{const i={};this.prompts.forEach(t=>{t.cc&&t.cc>0&&(i[t.promptId]=t.cc)}),localStorage.setItem(this.PROMPT_CC_STORAGE_KEY,JSON.stringify(i));const e={};this.instruments.forEach(t=>{t.cc&&t.cc>0&&(e[t.promptId]=t.cc)}),localStorage.setItem(this.INSTR_CC_STORAGE_KEY,JSON.stringify(e))}catch{}}loadMidiMappings(){try{const i=localStorage.getItem(this.PROMPT_CC_STORAGE_KEY);if(i){const t=JSON.parse(i),n=new Map(this.prompts);Object.entries(t).forEach(([s,o])=>{const r=n.get(s);r&&(r.cc=o,n.set(s,r))}),this.prompts=n}const e=localStorage.getItem(this.INSTR_CC_STORAGE_KEY);if(e){const t=JSON.parse(e),n=new Map(this.instruments);Object.entries(t).forEach(([s,o])=>{const r=n.get(s);r&&(r.cc=o,n.set(s,r))}),this.instruments=n}}catch{}}goHome(){this.dispatchEvent(new CustomEvent("go-home"))}toggleHelp(){this.showHelp=!this.showHelp}toggleExportMenu(){this.showExportMenu=!this.showExportMenu}toggleScenesMenu(){this.showScenesMenu=!this.showScenesMenu}async exportWavOrMp3(i){this.dispatchEvent(new CustomEvent("export-audio",{detail:{kind:i}}))}handlePromptChanged(i){const{promptId:e,text:t,weight:n,cc:s}=i.detail,o=this.prompts.get(e);if(!o){console.error("prompt not found",e);return}o.text=t,o.weight=n,o.cc=s;const r=new Map(this.prompts);r.set(e,o),this.prompts=r,this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts}))}toggleShowMidi(){return this.setShowMidi(!this.showMidi)}async setShowMidi(i){if(this.showMidi=i,!!this.showMidi)try{const e=await this.midiDispatcher.getMidiAccess();this.midiInputIds=e,this.activeMidiInputId=this.midiDispatcher.activeMidiInputId}catch(e){this.showMidi=!1,this.dispatchEvent(new CustomEvent("error",{detail:e.message}))}}handleMidiInputChange(i){const t=i.target.value;this.activeMidiInputId=t,this.midiDispatcher.activeMidiInputId=t}playPause(){this.dispatchEvent(new CustomEvent("play-pause"))}toggleRecording(){this.dispatchEvent(new CustomEvent("toggle-recording"))}toggleAutoEvolve(){this.autoEvolveEnabled=!this.autoEvolveEnabled,this.autoEvolveEnabled?this.startAutoEvolve():this.stopAutoEvolve()}startAutoEvolve(){this.stopAutoEvolve();const i=()=>this.runAutoEvolveOnce();i(),this.evolveTimer=window.setInterval(i,this.autoEvolveRateSec*1e3)}loadScenes(){try{const i=localStorage.getItem(this.SCENES_STORAGE_KEY);if(!i)return;const e=JSON.parse(i);Array.isArray(e)&&(this.scenes=e)}catch{}}persistScenes(){try{localStorage.setItem(this.SCENES_STORAGE_KEY,JSON.stringify(this.scenes))}catch{}}stopAutoEvolve(){this.evolveTimer!==null&&(clearInterval(this.evolveTimer),this.evolveTimer=null)}runAutoEvolveOnce(){const i=this.selectedOrder.map(n=>this.prompts.get(n)).filter(n=>!!n).slice(0,this.maxSelectedPrompts);if(i.length===0)return;const e=new Map(this.prompts);let t=!1;for(const n of i){const s=Math.max(0,Math.min(1,this.autoEvolveDepth)),o=(Math.random()-.5)*.2*s,r=Math.max(0,Math.min(2,(n.weight||0)+o));Math.abs(r-n.weight)>.001&&(n.weight=r,e.set(n.promptId,n),t=!0)}if(Math.random()<.2){const n=[...this.prompts.keys()].filter(s=>!this.selectedOrder.includes(s));if(n.length>0){const s=n[Math.floor(Math.random()*n.length)],o=Math.floor(Math.random()*this.selectedOrder.length),r=[...this.selectedOrder];r[o]=s,this.selectedOrder=r,this.selectedPromptIds=new Set(this.selectedOrder),this.resetWeightsForNonDisplayedPrompts()}}t&&(this.prompts=e,this.savePromptWeights(),this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts})))}addFilteredPrompt(i){this.filteredPrompts=new Set([...this.filteredPrompts,i])}handleSliderChange(i,e){console.log("handleSliderChange called with promptId:",i,"value:",e);const t=this.prompts.get(i);if(t){t.weight=e;const n=new Map(this.prompts);if(n.set(i,t),this.prompts=n,console.log("Slider changed for prompt:",i,"new weight:",e),console.log("Dispatching prompts-changed event with prompts:",this.prompts),this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts})),this.savePromptWeights(),!this.selectedPromptIds.has(i)&&t.weight!==0){t.weight=0;const s=new Map(this.prompts);s.set(i,t),this.prompts=s,this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts}))}}else console.error("Prompt not found for ID:",i)}handleInstrumentChange(i,e){const t=this.instruments.get(i);if(t){t.weight=e;const n=new Map(this.instruments);if(n.set(i,t),this.instruments=n,this.requestUpdate(),this.dispatchEvent(new CustomEvent("instrument-changed",{detail:t})),e>0){if(this.selectedInstrumentId&&this.selectedInstrumentId!==i){const s=this.instruments.get(this.selectedInstrumentId);if(s){s.weight=0;const o=new Map(this.instruments);o.set(s.promptId,s),this.instruments=o,this.dispatchEvent(new CustomEvent("instrument-changed",{detail:s}))}}this.selectedInstrumentId=i}else this.selectedInstrumentId===i&&e===0&&(this.selectedInstrumentId=null)}}toggleStyleSelected(i){if(this.selectedPromptIds.has(i))this.selectedOrder=this.selectedOrder.filter(t=>t!==i),this.selectedPromptIds=new Set(this.selectedOrder);else{if(this.selectedPromptIds.size>=this.maxSelectedPrompts){this.dispatchEvent(new CustomEvent("error",{detail:`You can select up to ${this.maxSelectedPrompts} styles.`}));return}this.selectedOrder=[...this.selectedOrder,i],this.selectedPromptIds=new Set(this.selectedOrder);const t=this.prompts.get(i);if(t&&(!t.weight||t.weight===0)){t.weight=1;const n=new Map(this.prompts);n.set(i,t),this.prompts=n,this.savePromptWeights(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts}))}}this.resetWeightsForNonDisplayedPrompts(),this.saveSelectedOrder()}resetWeightsForNonDisplayedPrompts(){let i=!1;const e=new Map(this.prompts);e.forEach((t,n)=>{!this.selectedPromptIds.has(n)&&t.weight!==0&&(t.weight=0,e.set(n,t),i=!0)}),i&&(this.prompts=e,this.requestUpdate(),this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts})))}async ensureMidiAccess(){try{const i=await this.midiDispatcher.getMidiAccess();return this.midiInputIds=i,this.activeMidiInputId=this.midiDispatcher.activeMidiInputId,i.length===0?(this.dispatchEvent(new CustomEvent("error",{detail:"No MIDI devices found."})),!1):!0}catch(i){return this.dispatchEvent(new CustomEvent("error",{detail:i.message})),!1}}async toggleLearnMode(i){if(this.learningPromptId===i){this.learningPromptId=null;return}await this.ensureMidiAccess()&&(this.learningInstrumentId=null,this.learningPromptId=i)}async toggleSlotLearn(i){if(this.learningSlotIndex===i){this.learningSlotIndex=null;return}await this.ensureMidiAccess()&&(this.learningPromptId=null,this.learningInstrumentId=null,this.learningSlotIndex=i)}async toggleInstrumentLearnMode(i){if(this.learningInstrumentId===i){this.learningInstrumentId=null;return}await this.ensureMidiAccess()&&(this.learningPromptId=null,this.learningInstrumentId=i)}handleStyleSlotChange(i){const e=i.target,t=Number(e.value);[2,4,6,8,16].includes(t)&&(this.maxSelectedPrompts=t,this.selectedOrder.length>t&&(this.selectedOrder=this.selectedOrder.slice(0,t),this.selectedPromptIds=new Set(this.selectedOrder),this.resetWeightsForNonDisplayedPrompts()),this.saveStyleCount())}saveStyleCount(){try{localStorage.setItem(this.STYLE_COUNT_STORAGE_KEY,String(this.maxSelectedPrompts))}catch{}}loadStyleCount(){try{const i=localStorage.getItem(this.STYLE_COUNT_STORAGE_KEY);if(!i)return;const e=Number(i);[2,4,6,8,16].includes(e)&&(this.maxSelectedPrompts=e)}catch{}}toggleStyleMute(i){console.log("Toggle mute for style:",i)}isStyleMuted(i){return!1}render(){return A`
      <!-- DAW Header -->
      <header class="daw-header">
        ${this.isMobile&&!this.showMobileMenu?A`
          <div class="toolbar-left" style="justify-content: space-between; width:100%">
            <gf-brand></gf-brand>
            <div class="transport-controls compact">
              <play-pause-button .playbackState=${this.playbackState} @click=${this.playPause}></play-pause-button>
            </div>
            <button class="toolbar-btn" @click=${()=>{this.showMobileMenu=!0}} title="Open menu"></button>
          </div>
        `:A`
          <div class="toolbar-left">
            ${this.isMobile?A`<button class="toolbar-btn" @click=${()=>{this.showMobileMenu=!1}} title="Close menu"></button>`:""}
            <gf-brand></gf-brand>
            <div class="transport-controls">
              <play-pause-button .playbackState=${this.playbackState} @click=${this.playPause}></play-pause-button>
              <div class="status-indicator">
                <div class="status-dot ${this.playbackState==="playing"?"playing":""}"></div>
                <span>${this.playbackState==="playing"?"Playing":"Stopped"}</span>
              </div>
            </div>
          </div>
          
          <div class="toolbar-right ${this.isMobile&&this.showMobileMenu?"show":""}">
            ${this.isMobile?A`<button class="toolbar-btn" @click=${()=>{this.showMobileMenu=!1}} title="Close menu"></button>`:""}
            <button class="toolbar-btn" @click=${()=>{this.randomizeGrid(),this.isMobile&&(this.showMobileMenu=!1)}} title="Fill grid randomly"></button>
            ${!this.isMobile&&this.konamiUnlocked?A`<button class="toolbar-btn" @click=${()=>{this.presetSlotCcMap(),this.isMobile&&(this.showMobileMenu=!1)}} title="Preset CC 4855">CC4855</button>`:""}
            <button class="toolbar-btn" @click=${()=>{this.resetAll(),this.isMobile&&(this.showMobileMenu=!1)}} title="Reset all"></button>
            <button class="toolbar-btn" @click=${()=>{this.goHome(),this.isMobile&&(this.showMobileMenu=!1)}} title="Return to Home"></button>
            <button class="toolbar-btn ${this.isRecording?"active":""}" @click=${()=>{this.toggleRecording(),this.isMobile&&(this.showMobileMenu=!1)}} title="Record / Stop"></button>
            <button class="toolbar-btn" @click=${()=>{this.toggleHelp(),this.isMobile&&(this.showMobileMenu=!1)}} title="How to use"></button>
            <require-pro .userId=${this.userId} .email=${this.userEmail} inline>
              <div style="position: relative;">
                <button class="toolbar-btn" @click=${()=>{this.toggleExportMenu()}} title="Export"> Export</button>
                ${this.showExportMenu?A`
                  <div style="position:absolute; right:0; top:110%; background:#1a1a1a; border:1px solid #333; border-radius:6px; padding:6px; z-index: 1001;">
                    <button class="toolbar-btn" style="display:block; width:100%; margin:4px 0;" @click=${()=>{this.exportWavOrMp3("wav"),this.isMobile&&(this.showMobileMenu=!1)}}>Export WAV</button>
                    <button class="toolbar-btn" style="display:block; width:100%; margin:4px 0;" @click=${()=>{this.exportWavOrMp3("mp3"),this.isMobile&&(this.showMobileMenu=!1)}}>Export MP3</button>
                  </div>`:""}
              </div>
            </require-pro>
            <div style="position: relative;">
              <button class="toolbar-btn" @click=${()=>{this.toggleScenesMenu()}} title="Scenes"> Scenes</button>
              ${this.showScenesMenu?A`
                <div style="position:absolute; right:0; top:110%; background:#1a1a1a; border:1px solid #333; border-radius:6px; padding:8px; min-width: 220px; z-index: 1001;">
                  <div style="display:flex; gap:6px; margin-bottom:6px; align-items:center;">
                    <button class="toolbar-btn" style="flex:1;" @click=${()=>{this.saveScene()}}>Save Scene</button>
                    <select class="midi-select" title="Morph time" @change=${i=>{this.sceneMorphSec=Number(i.target.value)}} .value=${String(this.sceneMorphSec)}>
                      ${[1,2,4,8].map(i=>A`<option value=${i}>${i}s</option>`)}
                    </select>
                  </div>
                  ${this.scenes.length===0?A`<div style="color:#aaa; font-size:12px; padding:6px;">No scenes yet</div>`:""}
                  ${this.scenes.map(i=>A`
                    <div style="display:flex; align-items:center; gap:6px; margin:4px 0;">
                      <button class="toolbar-btn" style="flex:1; text-align:left;" @click=${()=>{this.recallScene(i.id),this.isMobile&&(this.showMobileMenu=!1)}} title="Recall scene">${i.name}</button>
                      <button class="toolbar-btn" title="Rename" @click=${()=>{this.renameScene(i.id)}}></button>
                      <button class="toolbar-btn" title="Delete" @click=${()=>{this.deleteScene(i.id)}}></button>
                    </div>
                  `)}
                </div>`:""}
            </div>
            <button class="toolbar-btn ${this.autoEvolveEnabled?"active":""}" @click=${()=>{this.toggleAutoEvolve(),this.isMobile&&(this.showMobileMenu=!1)}} title="Autoevolve">EVOLVE</button>
            <select class="midi-select" title="Evolve rate" @change=${i=>{this.autoEvolveRateSec=Number(i.target.value),this.autoEvolveEnabled&&this.startAutoEvolve(),this.isMobile&&(this.showMobileMenu=!1)}} .value=${String(this.autoEvolveRateSec)}>
              ${[8,16,32,64].map(i=>A`<option value=${i}>${i}s</option>`)}
            </select>
            <select class="midi-select" title="Evolve depth" @change=${i=>{this.autoEvolveDepth=Number(i.target.value),this.isMobile&&(this.showMobileMenu=!1)}} .value=${String(this.autoEvolveDepth)}>
              <option value="0.1">Subtle</option>
              <option value="0.15">Light</option>
              <option value="0.25">Medium</option>
              <option value="0.4">Bold</option>
            </select>
          ${this.isMobile?"":A`
            <select class="midi-select" title="Style slots" @change=${this.handleStyleSlotChange} .value=${String(this.maxSelectedPrompts)}>
              ${[2,4,6,8,16].map(i=>A`<option value=${i}>${i} styles</option>`)}
            </select>
          `}
          ${this.isMobile?"":A`
            <button class="toolbar-btn ${this.showMidi?"active":""}" @click=${this.toggleShowMidi}>MIDI</button>
            ${this.showMidi?A`
              <select class="midi-select" @change=${this.handleMidiInputChange} .value=${this.activeMidiInputId||""}>
                <option value="">MIDI Input</option>
                ${this.midiInputIds.length>0?this.midiInputIds.map(i=>A`<option value=${i}>${this.midiDispatcher.getDeviceName(i)}</option>`):A`<option value="">No devices found</option>`}
              </select>
            `:""}
          `}
          </div>
        `}
      </header>

      <!-- Main DAW Layout -->
      <div class="daw-layout">
        <!-- Left Panel: Track List -->
          <aside class="style-panel">
          <div class="panel-header">
            <h3>Styles</h3>
            <input class="midi-select" style="width: 100%; margin-top: 8px;" type="text" placeholder="Search styles..." aria-label="Search styles" @input=${i=>{this.styleSearchQuery=i.target.value.toLowerCase()}} .value=${this.styleSearchQuery} />
          </div>
          <div class="style-list" role="listbox" aria-multiselectable="true" style="${this.isMobile?"max-height: 216px;":""}">
            ${this.renderStyleList()}
          </div>
        </aside>

        <!-- Center: Main Workspace -->
        <main class="workspace">
          ${this.isMobile?"":A`
            <timeline-ruler 
              .currentTime=${this.currentTime||0}
              .duration=${120}
              .bpm=${120}
              .timeSignature=${4}
              .isPlaying=${this.playbackState==="playing"}>
            </timeline-ruler>
          `}
          
          <!-- Timeline/Grid Area -->
          <div class="timeline-area">
            ${this.isMobile?"":A`
              <div class="timeline-header">
                <h3>deeprabbit  Fresh tracks. Forged by AI.</h3>
              </div>
            `}
            <div class="grid-container">
              ${this.renderPrompts()}
            </div>
          </div>
        </main>

        
      </div>
      ${this.showHelp?A`<help-panel open @close=${this.toggleHelp}></help-panel>`:""}
      ${this.showTutorial?A`<onboarding-tutorial @finish=${this.handleTutorialFinish}></onboarding-tutorial>`:""}
    `}renderPrompts(){const i=this.isMobile?!1:this.showAllPrompts,e=i?[...this.prompts.values()]:this.selectedOrder.map(t=>this.prompts.get(t)).filter(t=>!!t).slice(0,this.maxSelectedPrompts);if(!i){const t=new Set(e.map(o=>o.promptId)),n=new Map(this.prompts);let s=!1;n.forEach((o,r)=>{!t.has(r)&&(o.weight??0)>0&&(o.weight=0,n.set(r,o),s=!0)}),s&&(this.prompts=n,this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts})))}return e.map((t,n)=>{const s=this.filteredPrompts.has(t.text),o=t.weight>0;return A`<div class="slider-row ${o?"blending":""}">
        <button class="slot-close" title="Remove from grid" aria-label="Remove ${t.text} from grid" @click=${r=>{r.stopPropagation(),this.removePromptFromGrid(t.promptId)}}></button>
        <div class="slider-label">${t.text}</div>
        <div class="slider-control">
          <weight-slider
            .value=${t.weight}
            color=${s?"#888":t.color}
            audioLevel=${s?0:this.audioLevel}
            @input=${r=>this.handleSliderChange(t.promptId,r.detail)}></weight-slider>
          ${this.isMobile?"":A`
            <button type="button" class="midi-info ${this.learningSlotIndex===n?"active":""}"
              @click=${()=>this.toggleSlotLearn(n)}
              aria-label=${this.learningSlotIndex===n?"Mapping in progress, turn a knob":this.slotCcMap.has(n)?`Mapped to CC ${this.slotCcMap.get(n)}. Click to remap`:"Click to learn MIDI mapping"}>
              ${this.learningSlotIndex===n?"Learning turn a knob":this.slotCcMap.has(n)?`CC:${this.slotCcMap.get(n)}`:"Click to learn"}
            </button>
          `}
        </div>
      </div>`})}removePromptFromGrid(i){this.selectedOrder=this.selectedOrder.filter(t=>t!==i),this.selectedPromptIds=new Set(this.selectedOrder);const e=this.prompts.get(i);if(e&&(e.weight??0)!==0){e.weight=0;const t=new Map(this.prompts);t.set(i,e),this.prompts=t,this.dispatchEvent(new CustomEvent("prompts-changed",{detail:this.prompts})),this.savePromptWeights()}this.saveSelectedOrder(),this.requestUpdate()}saveSelectedOrder(){try{localStorage.setItem(this.SELECTED_ORDER_STORAGE_KEY,JSON.stringify(this.selectedOrder))}catch{}}loadSelectedOrder(){try{const i=localStorage.getItem(this.SELECTED_ORDER_STORAGE_KEY);if(!i)return;const e=JSON.parse(i);this.selectedOrder=e.filter(t=>this.prompts.has(t))}catch{}}savePromptWeights(){try{const i={};this.prompts.forEach((e,t)=>{i[t]=e.weight||0}),localStorage.setItem(this.PROMPT_WEIGHTS_STORAGE_KEY,JSON.stringify(i))}catch{}}loadPromptWeights(){try{const i=localStorage.getItem(this.PROMPT_WEIGHTS_STORAGE_KEY);if(!i)return;const e=JSON.parse(i),t=new Map(this.prompts);Object.entries(e).forEach(([n,s])=>{const o=t.get(n);o&&(o.weight=s,t.set(n,o))}),this.prompts=t}catch{}}saveShowAll(){try{localStorage.setItem(this.SHOW_ALL_GRID_STORAGE_KEY,this.showAllPrompts?"1":"0")}catch{}}loadShowAll(){try{const i=localStorage.getItem(this.SHOW_ALL_GRID_STORAGE_KEY);this.showAllPrompts=i==="1"}catch{}}renderInstruments(){return[...this.instruments.values()].map(i=>{const e=this.filteredInstruments.has(i.text),t=this.selectedInstrumentId===i.promptId;return A`<div class="instrument-slider ${t?"active":""}">
        <div class="instrument-label">${i.text}</div>
        <weight-slider
          .value=${i.weight}
          color=${e?"#888":i.color}
          audioLevel=${e?0:this.audioLevel}
          @input=${n=>this.handleInstrumentChange(i.promptId,n.detail)}></weight-slider>
        <button type="button" class="midi-info ${this.learningInstrumentId===i.promptId?"active":""}"
          @click=${()=>this.toggleInstrumentLearnMode(i.promptId)}
          aria-label=${this.learningInstrumentId===i.promptId?"Mapping in progress, turn a knob":i.cc>0?`Mapped to CC ${i.cc}. Click to remap`:"Click to learn MIDI mapping"}>
          ${this.learningInstrumentId===i.promptId?"Learning turn a knob":i.cc>0?`CC:${i.cc}`:"Click to learn"}
        </button>
      </div>`})}renderStyleList(){const i=this.styleSearchQuery.trim();return[...this.prompts.values()].filter(t=>!i||t.text.toLowerCase().includes(i)).map(t=>{const n=this.filteredPrompts.has(t.text),s=this.selectedPromptIds.has(t.promptId);return A`<div class="style-item ${n?"filtered":""} ${s?"active":""}"
        role="option"
        tabindex="0"
        aria-selected=${s}
        aria-label="${s?"Deselect":"Select"} style ${t.text}"
        @click=${()=>this.toggleStyleSelected(t.promptId)}
        @keydown=${o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),this.toggleStyleSelected(t.promptId))}}>
        <div class="style-color" style="background-color: ${t.color}"></div>
        <div class="style-name">${t.text}</div>
        <button type="button" class="style-mute" @click=${o=>{o.stopPropagation(),this.toggleStyleMute(t.promptId)}} aria-label="${this.isStyleMuted(t.promptId)?"Unmute style":"Mute style"} ${t.text}">
          ${this.isStyleMuted(t.promptId)?"":""}
        </button>
      </div>`})}renderMixerTracks(){return null}};O.styles=me`
    :host {
      height: 100vh;
      height: 100dvh; /* mobile-safe */
      display: flex;
      flex-direction: column;
      background: #0f0f0f;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
      color: #e0e0e0;
      overflow: hidden;
      user-select: none;
    }
    
    /* Professional DAW Header */
    .daw-header {
      height: 70px;
      background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
      border-bottom: 2px solid #2a2a2a;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.8);
      z-index: 1000;
      position: relative;
    }
    
    .daw-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #29F2C6 50%, transparent 100%);
      opacity: 0.6;
    }
    
    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 25px;
    }
    
    .app-title {
      color: #29F2C6;
      font-size: 20px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(41, 242, 198, 0.5);
      position: relative;
    }
    
    .app-title::after {
      content: 'PRO';
      position: absolute;
      top: -8px;
      right: -25px;
      font-size: 10px;
      background: #29F2C6;
      color: #000;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 900;
      letter-spacing: 1px;
    }
    
    .transport-controls {
      display: flex;
      align-items: center;
      gap: 20px;
      background: #1a1a1a;
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid #333;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: #aaa;
      font-weight: 500;
    }
    
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #555;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .status-dot.playing {
      background: #29F2C6;
      box-shadow: 0 0 15px rgba(41, 242, 198, 0.8);
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }
    
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .toolbar-btn {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid #444;
      color: #e0e0e0;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .toolbar-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s ease;
    }
    
    .toolbar-btn:hover::before {
      left: 100%;
    }
    
    .toolbar-btn:hover {
      background: linear-gradient(135deg, #333 0%, #2a2a2a 100%);
      border-color: #555;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }
    
    .toolbar-btn.active {
      background: linear-gradient(135deg, #29F2C6 0%, #0FC9A7 100%);
      color: #000;
      border-color: #29F2C6;
      box-shadow: 0 0 20px rgba(41, 242, 198, 0.4);
    }
    
    .midi-select {
      background: #1a1a1a;
      border: 1px solid #444;
      color: #e0e0e0;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 12px;
      outline: none;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .midi-select:focus {
      border-color: #29F2C6;
      box-shadow: 0 0 0 3px rgba(41, 242, 198, 0.2);
    }
    
    /* Main DAW Layout */
    .daw-layout {
      display: flex;
      flex: 1;
      height: calc(100vh - 70px);
      height: calc(100dvh - 70px); /* mobile-safe */
      min-height: 0; /* allow children to shrink and enable inner scroll areas */
      align-items: stretch; /* ensure children fill height */
      overflow: hidden;
      background: #0f0f0f;
    }
    
    /* Left Panel - Style List */
    .style-panel {
      width: 300px;
      background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
      border-right: 2px solid #2a2a2a;
      display: flex;
      flex-direction: column;
      min-height: 0; /* critical for nested flex scroll */
      height: 100%; /* take full height of layout */
      flex: 0 0 300px; /* fix width in flex row */
      overflow: hidden;
      position: relative;
    }
    
    .style-panel::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 1px;
      height: 100%;
      background: linear-gradient(180deg, transparent 0%, #29F2C6 50%, transparent 100%);
      opacity: 0.3;
    }
    
    .panel-header {
      background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
      padding: 18px 25px;
      border-bottom: 2px solid #333;
      position: relative;
      flex-shrink: 0; /* prevent header from stealing space */
    }
    
    .panel-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #29F2C6 50%, transparent 100%);
      opacity: 0.4;
    }
    
    .panel-header h3 {
      margin: 0;
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #29F2C6;
      text-shadow: 0 0 10px rgba(41, 242, 198, 0.3);
    }
    
    .style-list {
      flex: 1 1 0;
      min-height: 0; /* ensure list can become scroll container */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      padding: 15px 0;
      scroll-snap-type: y mandatory;
    }
    
    .style-item {
      display: flex;
      align-items: center;
      padding: 15px 25px;
      border-bottom: 1px solid #222;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      scroll-snap-align: start;
    }
    
    .style-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: transparent;
      transition: all 0.2s ease;
    }
    
    .style-item:hover {
      background: linear-gradient(90deg, rgba(41, 242, 198, 0.1) 0%, transparent 100%);
      border-left: 3px solid #29F2C6;
    }
    
    .style-item:hover::before {
      background: #29F2C6;
      box-shadow: 0 0 10px rgba(41, 242, 198, 0.5);
    }
    
    .style-item.filtered {
      opacity: 0.4;
      background: rgba(255, 0, 0, 0.1);
    }
    .style-item.active {
      background: linear-gradient(90deg, rgba(41, 242, 198, 0.12) 0%, transparent 100%);
      border-left: 3px solid #29F2C6;
    }
    
    .style-color {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      margin-right: 15px;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .style-name {
      flex: 1;
      font-size: 12px;
      font-weight: 600;
      color: #e0e0e0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .style-mute {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s ease;
      background: #333;
      border: 1px solid #555;
      font-size: 12px;
    }
    
    .style-mute:hover {
      background: #444;
      border-color: #666;
      transform: scale(1.1);
    }
    
    /* Center Workspace */
    .workspace {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #0f0f0f;
      min-height: 0; /* enable inner scroll */
      overflow: hidden;
      position: relative;
    }
    
    .workspace::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(41, 242, 198, 0.02) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(41, 242, 198, 0.02) 0%, transparent 50%);
      pointer-events: none;
    }
    
    .timeline-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0; /* enable grid-container to scroll */
      overflow: hidden;
    }
    
    .timeline-header {
      background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
      padding: 18px 25px;
      border-bottom: 2px solid #333;
      position: relative;
    }
    
    .timeline-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #29F2C6 50%, transparent 100%);
      opacity: 0.4;
    }
    
    .timeline-header h3 {
      margin: 0;
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #29F2C6;
      text-shadow: 0 0 10px rgba(41, 242, 198, 0.3);
    }
    
    .grid-container {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 25px;
      align-content: start;
    }
    
    .slider-row {
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      border: 2px solid #2a2a2a;
      border-radius: 8px;
      padding: 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      transition: all 0.3s ease;
      position: relative;
      overflow: visible;
    }

    .slider-row.blending {
      border-color: #29F2C6;
      box-shadow: 0 0 20px rgba(41, 242, 198, 0.3);
    }

    .slot-close {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 1px solid #444;
      background: #222;
      color: #aaa;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      transition: all 0.2s ease;
    }

    .slot-close:hover {
      background: #333;
      color: #fff;
      border-color: #666;
      transform: scale(1.05);
    }
    
    .slider-row::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent 0%, #29F2C6 50%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .slider-row:hover {
      border-color: #29F2C6;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), 0 0 20px rgba(41, 242, 198, 0.1);
      transform: translateY(-2px);
    }
    
    .slider-row:hover::before {
      opacity: 1;
    }
    
    .slider-label {
      color: #e0e0e0;
      font-weight: 700;
      font-size: 14px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .slider-control {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 100%;
      /* Provide space for slider overlays (labels/visualizer) */
      padding-bottom: 40px;
    }
    
    weight-slider {
      width: 100%;
      max-width: 200px;
    }
    
    .midi-info {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid #555;
      border-radius: 6px;
      padding: 10px 18px;
      font-size: 11px;
      color: #aaa;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      min-width: 90px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    }
    
    .midi-info:hover {
      background: linear-gradient(135deg, #333 0%, #2a2a2a 100%);
      border-color: #29F2C6;
      color: #29F2C6;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    }

    .midi-info.active {
      background: linear-gradient(135deg, #072a25 0%, #05211d 100%);
      border-color: #29F2C6;
      color: #29F2C6;
      box-shadow: 0 0 0 3px rgba(41, 242, 198, 0.15), 0 0 20px rgba(41, 242, 198, 0.15);
    }
    
    /* Right Panel - Mixer */
    
    .instruments-list {
      border-top: 2px solid #333;
      padding: 15px 0;
    }
    
    .instrument-slider {
      padding: 18px 25px;
      border-bottom: 1px solid #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      transition: all 0.2s ease;
    }
    
    .instrument-slider:hover {
      background: rgba(41, 242, 198, 0.05);
    }
    
    .instrument-slider.filtered {
      opacity: 0.4;
      background: rgba(255, 0, 0, 0.1);
    }
    .instrument-slider.active {
      background: linear-gradient(90deg, rgba(41, 242, 198, 0.08) 0%, transparent 100%);
      border-left: 3px solid #29F2C6;
    }
    
    .instrument-label {
      font-size: 12px;
      color: #e0e0e0;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    /* Professional Scrollbars */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: #0f0f0f;
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #333 0%, #222 100%);
      border-radius: 5px;
      border: 1px solid #444;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #444 0%, #333 100%);
    }
    
    ::-webkit-scrollbar-corner {
      background: #0f0f0f;
    }
    
    /* Responsive Design */
    @media (max-width: 1400px) {
      .style-panel {
        width: 260px;
      }
      
      .mixer-panel {
        width: 300px;
      }
      
      .grid-container {
        grid-template-columns: repeat(4, minmax(200px, 1fr));
        gap: 20px;
        padding: 20px;
      }
    }
    
    @media (max-width: 768px) {
      .daw-layout {
        flex-direction: column;
        height: auto; /* let panels size naturally */
      }
      .slot-close { width: 28px; height: 28px; }
      .toolbar-right { display: none; }
      .toolbar-right.show { display: flex; }
      .transport-controls.compact { padding: 6px 10px; gap: 10px; }
      .slider-row { padding: 12px; gap: 12px; }
      .slider-label { font-size: 13px; }
      weight-slider { max-width: 180px; }
      
      .style-panel,
      .mixer-panel {
        width: 100%;
        height: auto;
        max-height: 40vh; /* overall panel cap */
        overflow: auto;
      }
      
      .grid-container {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
        padding: 15px;
        -webkit-overflow-scrolling: touch;
      }
      
      .slider-row {
        padding: 20px;
      }
      
      .daw-header {
        height: auto;
        padding: 20px 25px;
        flex-direction: column;
        gap: 20px;
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      
      .toolbar-left,
      .toolbar-right {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .grid-container {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 10px;
        padding: 10px;
      }

      .style-panel,
      .mixer-panel {
        max-height: 35vh;
      }

      .slider-row { padding: 10px; gap: 10px; }
      .slider-label { font-size: 12px; }
      weight-slider { max-width: 160px; }
      .toolbar-right {
        flex-wrap: wrap;
        gap: 10px;
      }
      .toolbar-btn, .midi-select {
        padding: 8px 12px;
        font-size: 11px;
      }
    }
  `;B([G()],O.prototype,"maxSelectedPrompts",2);B([G()],O.prototype,"showExportMenu",2);B([U({type:String})],O.prototype,"userId",2);B([U({type:String})],O.prototype,"userEmail",2);B([G()],O.prototype,"showTutorial",2);B([G()],O.prototype,"isRecording",2);B([G()],O.prototype,"autoEvolveEnabled",2);B([G()],O.prototype,"autoEvolveRateSec",2);B([G()],O.prototype,"autoEvolveDepth",2);B([G()],O.prototype,"styleSearchQuery",2);B([G()],O.prototype,"selectedOrder",2);B([G()],O.prototype,"showAllPrompts",2);B([G()],O.prototype,"isMobile",2);B([G()],O.prototype,"showMobileMenu",2);B([U({type:Boolean})],O.prototype,"showMidi",2);B([U({type:String})],O.prototype,"playbackState",2);B([G()],O.prototype,"audioLevel",2);B([G()],O.prototype,"currentTime",2);B([G()],O.prototype,"midiInputIds",2);B([G()],O.prototype,"activeMidiInputId",2);B([G()],O.prototype,"learningPromptId",2);B([G()],O.prototype,"learningInstrumentId",2);B([G()],O.prototype,"selectedPromptIds",2);B([G()],O.prototype,"selectedInstrumentId",2);B([G()],O.prototype,"learningSlotIndex",2);B([G()],O.prototype,"slotCcMap",2);B([G()],O.prototype,"scenes",2);B([G()],O.prototype,"showScenesMenu",2);B([G()],O.prototype,"sceneMorphSec",2);B([G()],O.prototype,"konamiUnlocked",2);B([G()],O.prototype,"showHelp",2);B([U({type:Object})],O.prototype,"filteredPrompts",2);B([U({type:Object})],O.prototype,"filteredInstruments",2);O=B([ye("prompt-dj-midi")],O);var Ug=Object.defineProperty,Fg=Object.getOwnPropertyDescriptor,Di=(i,e,t,n)=>{for(var s=n>1?void 0:n?Fg(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Ug(e,t,s),s};let ue=class extends ie{constructor(){super(...arguments),this.message="",this.showing=!1,this.hideTimer=null}renderMessageWithLinks(){const i=/(https?:\/\/[^\s]+)/g;return this.message.split(i).map((t,n)=>n%2===0?t:A`<a href=${t} target="_blank" rel="noopener">${t}</a>`)}render(){return this.showing?A`<div class=${Wr({showing:this.showing,toast:!0})}>
      <div class="message">${this.renderMessageWithLinks()}</div>
      <button @click=${this.hide}></button>
    </div>`:A``}show(i){this.showing=!0,this.message=i,this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null),this.hideTimer=window.setTimeout(()=>this.hide(),4e3)}hide(){this.showing=!1,this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null),setTimeout(()=>{this.message=""},300)}};ue.styles=me`
    .toast {
      line-height: 1.6;
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 1rem 1.25rem;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      width: min(500px, 90vw);
      transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      text-wrap: pretty;
      backdrop-filter: blur(12px);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      z-index: 1000;
    }
    
    .toast::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
      border-radius: inherit;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .toast:hover::before {
      opacity: 1;
    }
    
    .message {
      flex: 1;
      font-weight: 500;
    }
    
    button {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }
    
    button:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      transform: scale(1.1);
    }
    
    .toast:not(.showing) {
      transition-duration: 0.6s;
      transform: translateY(200%);
      opacity: 0;
    }
    
    .toast.showing {
      animation: slideIn 0.4s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translate(-50%, -100%);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    
    a {
      color: #60a5fa;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s ease;
    }
    
    a:hover {
      color: #93c5fd;
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .toast {
        bottom: 10px;
        right: 10px;
        padding: 0.875rem 1rem;
        border-radius: 10px;
        width: calc(100vw - 20px);
      }
      .toast:not(.showing) { transform: translateY(100%); }
      .toast.showing { animation: slideInMobile 0.4s ease-out; }
      @keyframes slideInMobile {
        from { transform: translateY(100%); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
    }
  `;Di([U({type:String})],ue.prototype,"message",2);Di([U({type:Boolean})],ue.prototype,"showing",2);ue=Di([ye("toast-message")],ue);var Vg=Object.defineProperty,Bg=Object.getOwnPropertyDescriptor,Mn=(i,e,t,n)=>{for(var s=n>1?void 0:n?Bg(e,t):e,o=i.length-1,r;o>=0;o--)(r=i[o])&&(s=(n?r(e,t,s):r(s))||s);return n&&s&&Vg(e,t,s),s};let bt=class extends ie{constructor(){super(...arguments),this.userId="",this.email="",this.busy=!1}async upgrade(){if(!this.userId){this.toast("Sign-in required before upgrading.");return}this.busy=!0;try{const e=await(await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,email:this.email})})).json();e!=null&&e.url?window.location.href=e.url:this.toast("Upgrade link unavailable.")}catch(i){this.toast((i==null?void 0:i.message)||"Upgrade failed")}finally{this.busy=!1}}async manage(){if(!this.userId){this.toast("Sign-in required.");return}this.busy=!0;try{const e=await(await fetch("/api/portal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId})})).json();e!=null&&e.url?window.location.href=e.url:this.toast("Portal unavailable.")}catch(i){this.toast((i==null?void 0:i.message)||"Portal failed")}finally{this.busy=!1}}refresh(){this.dispatchEvent(new CustomEvent("refresh-plan",{bubbles:!0,composed:!0}))}toast(i){this.dispatchEvent(new CustomEvent("notify",{detail:i,bubbles:!0,composed:!0}))}render(){var t;const i=(((t=window==null?void 0:window.location)==null?void 0:t.hostname)||"").toLowerCase(),e=i==="localhost"||i==="127.0.0.1";return A`
      <div class="card" role="dialog" aria-modal="true" aria-label="Subscription required">
        <h1>DeepRabbit Pro required</h1>
        <p>Upgrade to use the live music studio. Your account is currently on Free.</p>
        <div class="row">
          <button class="primary" ?disabled=${this.busy} @click=${this.upgrade}>Upgrade</button>
          <button ?disabled=${this.busy} @click=${this.manage}>Manage billing</button>
          <button class="muted" ?disabled=${this.busy} @click=${this.refresh}>Ive upgraded  Refresh</button>
          ${e?A`<button class="muted" @click=${()=>this.dispatchEvent(new CustomEvent("dev-bypass",{bubbles:!0,composed:!0}))}>Skip for Dev</button>`:""}
        </div>
        <div class="hint">Well unlock the studio as soon as your plan is Pro.</div>
      </div>
    `}};bt.styles=me`
    :host { position: fixed; inset: 0; display: grid; place-items: center; background: #0b0b0b; z-index: 4000; }
    .card {
      width: min(720px, 92vw);
      border: 1px solid #262626;
      border-radius: 12px;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(41,242,198,.06), transparent), #111;
      padding: 28px;
      color: #e5e5e5;
      box-shadow: 0 20px 60px rgba(0,0,0,.6);
    }
    h1 { margin: 0 0 8px; font-size: 22px; color: #29F2C6; }
    p { margin: 6px 0; color: #cfcfcf; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 16px; }
    button {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid #444;
      color: #e0e0e0;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .5px;
      transition: all .2s ease;
    }
    button:hover { transform: translateY(-1px); border-color: #666; }
    .primary { background: linear-gradient(135deg, #29F2C6 0%, #0FC9A7 100%); color: #000; border-color: #29F2C6; }
    .muted { opacity: .8; }
    .hint { font-size: 12px; color: #a8a8a8; margin-top: 10px; }
  `;Mn([U({type:String})],bt.prototype,"userId",2);Mn([U({type:String})],bt.prototype,"email",2);Mn([G()],bt.prototype,"busy",2);bt=Mn([ye("subscription-gate")],bt);/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/function qg(i){const e=atob(i),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return n}async function Gg(i,e,t,n){const s=e.createBuffer(n,i.length/2/n,t),o=new Int16Array(i.buffer),r=o.length,c=new Float32Array(r);for(let u=0;u<r;u++)c[u]=o[u]/32768;for(let u=0;u<n;u++){const d=c.filter((h,f)=>f%n===u);s.copyToChannel(d,u)}return s}function Ao(i){const e=i.createDynamicsCompressor();return e.threshold.value=-6,e.knee.value=20,e.ratio.value=12,e.attack.value=.003,e.release.value=.25,e}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/class Hg extends EventTarget{constructor(e,t){super(),this.session=null,this.sessionPromise=null,this.connectionError=!0,this.filteredPrompts=new Set,this.nextStartTime=0,this.bufferTime=2,this.extraDestination=null,this.masterLimiter=null,this.playbackState="stopped",this.reconnecting=!1,this.retryAttempt=0,this.reconnectTimer=null,this.shouldAutoResume=!1,this.interstitialActive=!1,this.adGain=null,this.adOscillators=[],this.ttsUtterance=null,this.setWeightedPrompts=Br(async n=>{if(console.log("LiveMusicHelper.setWeightedPrompts called with:",n),this.prompts=n,this.activePrompts.length===0){console.log("No active prompts, pausing"),this.dispatchEvent(new CustomEvent("error",{detail:"There needs to be one active prompt to play."})),this.pause();return}if(console.log("Active prompts:",this.activePrompts),!this.session){console.log("No session yet, storing prompts for later");return}try{console.log("Setting weighted prompts on session:",this.activePrompts),await this.session.setWeightedPrompts({weightedPrompts:this.activePrompts}),console.log("Successfully set weighted prompts on session")}catch(s){console.error("Error setting weighted prompts:",s),this.dispatchEvent(new CustomEvent("error",{detail:s.message})),this.pause()}},200),this.ai=e,this.model=t,this.prompts=new Map,this.audioContext=new AudioContext({sampleRate:48e3}),this.outputNode=this.audioContext.createGain(),this.recordTap=this.audioContext.createGain()}getSession(){return this.sessionPromise||(this.sessionPromise=this.connect()),this.sessionPromise}async connect(){return this.sessionPromise=this.ai.live.music.connect({model:this.model,callbacks:{onmessage:async e=>{var t;e.setupComplete&&(this.connectionError=!1),e.filteredPrompt&&(this.filteredPrompts=new Set([...this.filteredPrompts,e.filteredPrompt.text]),this.dispatchEvent(new CustomEvent("filtered-prompt",{detail:e.filteredPrompt}))),(t=e.serverContent)!=null&&t.audioChunks&&await this.processAudioChunks(e.serverContent.audioChunks)},onerror:()=>{this.handleTransportClosed("error")},onclose:()=>{this.handleTransportClosed("closed")}}}),this.sessionPromise}handleTransportClosed(e){if(this.connectionError=!0,!this.shouldAutoResume){this.setPlaybackState("paused");return}this.setPlaybackState("loading"),this.nextStartTime=0,this.session=null,this.sessionPromise=null,this.beginReconnect(),this.playInterstitial(),this.retryAttempt===0&&this.dispatchEvent(new CustomEvent("error",{detail:"Connection lost. Reconnecting"}))}beginReconnect(){if(this.reconnecting)return;this.reconnecting=!0,this.retryAttempt=0;const e=async()=>{try{await this.connect(),this.session=await this.sessionPromise,await this.audioContext.resume(),this.masterLimiter||(this.masterLimiter=Ao(this.audioContext),this.outputNode.connect(this.masterLimiter),this.masterLimiter.connect(this.audioContext.destination),this.extraDestination&&this.outputNode.connect(this.extraDestination),this.outputNode.connect(this.recordTap)),await this.setWeightedPrompts(this.prompts),this.session.play(),this.stopInterstitial(),this.reconnecting=!1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null);return}catch{this.retryAttempt+=1;const n=[500,1e3,2e3,4e3,8e3,8e3],s=n[Math.min(this.retryAttempt,n.length-1)];this.reconnectTimer=window.setTimeout(e,s)}};e()}setPlaybackState(e){this.playbackState=e,this.dispatchEvent(new CustomEvent("playback-state-changed",{detail:e}))}async processAudioChunks(e){if(this.playbackState==="paused"||this.playbackState==="stopped")return;const t=await Gg(qg(e[0].data),this.audioContext,48e3,2),n=this.audioContext.createBufferSource();if(n.buffer=t,n.connect(this.outputNode),this.nextStartTime===0&&(this.nextStartTime=this.audioContext.currentTime+this.bufferTime,setTimeout(()=>{this.setPlaybackState("playing")},this.bufferTime*1e3)),this.nextStartTime<this.audioContext.currentTime){this.setPlaybackState("loading"),this.nextStartTime=0;return}n.start(this.nextStartTime),this.nextStartTime+=t.duration}get activePrompts(){return Array.from(this.prompts.values()).filter(e=>!this.filteredPrompts.has(e.text)&&(e.weight??0)>.001)}async play(){this.setPlaybackState("loading"),this.shouldAutoResume=!0,this.session=await this.getSession(),await this.setWeightedPrompts(this.prompts),this.audioContext.resume(),this.session.play(),this.masterLimiter=Ao(this.audioContext),this.outputNode.connect(this.masterLimiter),this.masterLimiter.connect(this.audioContext.destination),this.extraDestination&&this.outputNode.connect(this.extraDestination),this.outputNode.connect(this.recordTap),this.outputNode.gain.setValueAtTime(0,this.audioContext.currentTime),this.outputNode.gain.linearRampToValueAtTime(1,this.audioContext.currentTime+.1)}pause(){this.session&&this.session.pause(),this.setPlaybackState("paused"),this.shouldAutoResume=!1,this.outputNode.gain.setValueAtTime(1,this.audioContext.currentTime),this.outputNode.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.1),this.nextStartTime=0,this.outputNode=this.audioContext.createGain(),this.stopInterstitial()}stop(){this.session&&this.session.stop(),this.setPlaybackState("stopped"),this.shouldAutoResume=!1,this.outputNode.gain.setValueAtTime(0,this.audioContext.currentTime),this.outputNode.gain.linearRampToValueAtTime(1,this.audioContext.currentTime+.1),this.nextStartTime=0,this.session=null,this.sessionPromise=null,this.stopInterstitial()}playInterstitial(){if(this.interstitialActive)return;this.interstitialActive=!0,this.adGain=this.audioContext.createGain(),this.adGain.gain.setValueAtTime(0,this.audioContext.currentTime),this.adGain.gain.linearRampToValueAtTime(.2,this.audioContext.currentTime+.15);const e=this.masterLimiter??this.audioContext.destination;this.adGain.connect(e);const t=this.audioContext.currentTime,n=(u,d,h)=>{const f=this.audioContext.createGain();f.gain.setValueAtTime(0,d),f.gain.linearRampToValueAtTime(.35,d+.03),f.gain.linearRampToValueAtTime(0,d+h),u.connect(f).connect(this.adGain)},s=(u,d,h)=>{const f=this.audioContext.createOscillator();f.type="sine",f.frequency.setValueAtTime(u,t+d),n(f,t+d,h),f.start(t+d),f.stop(t+d+h+.05),this.adOscillators.push(f)},o=[261.63,311.13,392,523.25];for(let u=0;u<16;u++){const d=o[u%o.length]*(u%8===0?.5:1);s(d,u*.35,.28)}const r=["Thanks for listening to deeprabbit dot net.","DeepRabbit: fresh tracks, forged by A I. Thanks for tuning in.","We'll be back in a beat. Thanks for listening to deeprabbit dot net."],c=r[Math.floor(Math.random()*r.length)];try{const u=window==null?void 0:window.speechSynthesis;if(u){this.ttsUtterance=new SpeechSynthesisUtterance(c);const d=u.getVoices();if(d&&d.length>0){const h=d.filter(p=>!/default/i.test(p.name)),f=(h.length?h:d)[Math.floor(Math.random()*(h.length?h.length:d.length))];this.ttsUtterance.voice=f}this.ttsUtterance.rate=1,this.ttsUtterance.pitch=1,u.speak(this.ttsUtterance)}}catch{}}stopInterstitial(){if(!this.interstitialActive)return;this.interstitialActive=!1;try{const t=window==null?void 0:window.speechSynthesis;t&&t.speaking&&t.cancel(),this.ttsUtterance=null}catch{}const e=this.audioContext.currentTime;if(this.adGain){try{this.adGain.gain.cancelScheduledValues(e)}catch{}this.adGain.gain.setValueAtTime(this.adGain.gain.value,e),this.adGain.gain.linearRampToValueAtTime(0,e+.15),setTimeout(()=>{var t;try{(t=this.adGain)==null||t.disconnect()}catch{}this.adGain=null},200)}this.adOscillators.forEach(t=>{try{t.stop(),t.disconnect()}catch{}}),this.adOscillators=[]}async playPause(){switch(this.playbackState){case"playing":return this.pause();case"paused":case"stopped":return this.play();case"loading":return this.stop()}}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/class Wg extends EventTarget{constructor(e){super(),this.rafId=null,this.start=this.loop,this.node=e.createAnalyser(),this.node.smoothingTimeConstant=0,this.freqData=new Uint8Array(this.node.frequencyBinCount),this.loop=this.loop.bind(this)}getCurrentLevel(){return this.node.getByteFrequencyData(this.freqData),this.freqData.reduce((t,n)=>t+n,0)/this.freqData.length/255}loop(){this.rafId=requestAnimationFrame(this.loop);const e=this.getCurrentLevel();this.dispatchEvent(new CustomEvent("audio-level-changed",{detail:e}))}stop(){this.rafId&&cancelAnimationFrame(this.rafId)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */class ko{constructor(e,t,n="audio/webm;codecs=opus",s=!1){this.mediaDest=null,this.recorder=null,this.chunks=[],this.scriptNode=null,this.pcmLeft=[],this.pcmRight=[],this.wavBuffer=null,this.audioContext=e,this.tapNode=t,this.mimeType=MediaRecorder.isTypeSupported(n)?n:"audio/webm",this.asMp3=s}start(){var e,t,n,s;if(this.asMp3){if(this.scriptNode)return;const o=4096,r=2;this.scriptNode=this.audioContext.createScriptProcessor(o,r,r),this.pcmLeft=[],this.pcmRight=[],this.scriptNode.onaudioprocess=c=>{const u=c.inputBuffer,d=new Float32Array(u.getChannelData(0)),h=u.numberOfChannels>1?new Float32Array(u.getChannelData(1)):new Float32Array(d);this.pcmLeft.push(d),this.pcmRight.push(h),this.wavBuffer=u},(t=(e=this.tapNode).connect)==null||t.call(e,this.scriptNode),this.scriptNode.connect(this.audioContext.destination);return}this.recorder||(this.mediaDest=this.audioContext.createMediaStreamDestination(),(s=(n=this.tapNode).connect)==null||s.call(n,this.mediaDest),this.recorder=new MediaRecorder(this.mediaDest.stream,{mimeType:this.mimeType}),this.chunks=[],this.recorder.ondataavailable=o=>{o.data&&o.data.size>0&&this.chunks.push(o.data)},this.recorder.start())}async stop(){var s,o,r,c;if(this.asMp3){if(!this.scriptNode)throw new Error("Recorder not started");try{(o=(s=this.tapNode).disconnect)==null||o.call(s,this.scriptNode)}catch{}try{this.scriptNode.disconnect()}catch{}this.scriptNode.onaudioprocess=null,this.scriptNode=null;const u=Io(this.pcmLeft),d=Io(this.pcmRight);this.pcmLeft=[],this.pcmRight=[];const h=await Jg();return zg(u,d,this.audioContext.sampleRate,h)}if(!this.recorder)throw new Error("Recorder not started");const e=this.recorder,t=this.mediaDest,n=new Promise(u=>{e.onstop=()=>u()});e.stop(),await n;try{(c=(r=this.tapNode).disconnect)==null||c.call(r,t)}catch{}return this.recorder=null,this.mediaDest=null,new Blob(this.chunks,{type:this.mimeType})}}function Io(i){let e=0;for(const s of i)e+=s.length;const t=new Float32Array(e);let n=0;for(const s of i)t.set(s,n),n+=s.length;return t}function zg(i,e,t,n){const s=n.Mp3Encoder||n.default&&n.default.Mp3Encoder;if(!s)throw new Error("MP3 encoder not available");const o=new s(2,t,128),r=1152,c=[];let u=0;const d=Math.min(i.length,e.length);for(;u<d;){const f=Mo(i.subarray(u,u+r)),p=Mo(e.subarray(u,u+r)),g=o.encodeBuffer(f,p);g.length>0&&c.push(g),u+=r}const h=o.flush();return h.length>0&&c.push(h),new Blob(c,{type:"audio/mpeg"})}function Mo(i){const e=new Int16Array(i.length);for(let t=0;t<i.length;t++){let n=Math.max(-1,Math.min(1,i[t]));e[t]=n<0?n*32768:n*32767}return e}async function Jg(){const i=window;return i.lamejs?i.lamejs:new Promise((e,t)=>{const n=document.createElement("script");n.src="https://unpkg.com/lamejs@1.2.0/lame.min.js",n.onload=()=>e(window.lamejs),n.onerror=s=>t(new Error("Failed to load MP3 encoder")),document.head.appendChild(n)})}function Po(i){const e=i.numberOfChannels,t=i.sampleRate,n=i.length,s=2,o=e*s,r=n*o,c=44,u=c+r,d=new ArrayBuffer(u),h=new DataView(d);function f(y,v){for(let w=0;w<v.length;w++)h.setUint8(y+w,v.charCodeAt(w))}let p=0;f(p,"RIFF"),p+=4,h.setUint32(p,u-8,!0),p+=4,f(p,"WAVE"),p+=4,f(p,"fmt "),p+=4,h.setUint32(p,16,!0),p+=4,h.setUint16(p,1,!0),p+=2,h.setUint16(p,e,!0),p+=2,h.setUint32(p,t,!0),p+=4,h.setUint32(p,t*o,!0),p+=4,h.setUint16(p,o,!0),p+=2,h.setUint16(p,s*8,!0),p+=2,f(p,"data"),p+=4,h.setUint32(p,r,!0),p+=4;const g=[];for(let y=0;y<e;y++)g[y]=i.getChannelData(y);let m=c;for(let y=0;y<n;y++)for(let v=0;v<e;v++){let w=g[v][y];w=Math.max(-1,Math.min(1,w)),h.setInt16(m,w<0?w*32768:w*32767,!0),m+=2}return new Blob([d],{type:"audio/wav"})}const Kg="modulepreload",Yg=function(i){return"/"+i},Ro={},Jt=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let r=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=r(t.map(d=>{if(d=Yg(d),d in Ro)return;Ro[d]=!0;const h=d.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":Kg,h||(p.as="script"),p.crossOrigin="",p.href=d,u&&p.setAttribute("nonce",u),document.head.appendChild(p),h)return new Promise((g,m)=>{p.addEventListener("load",g),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return s.then(r=>{for(const c of r||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})},Zg=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Jt(async()=>{const{default:n}=await Promise.resolve().then(()=>Tt);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class $i extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class Xg extends $i{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Do extends $i{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class $o extends $i{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var fi;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(fi||(fi={}));var Qg=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};class jg{constructor(e,{headers:t={},customFetch:n,region:s=fi.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Zg(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Qg(this,void 0,void 0,function*(){try{const{headers:s,method:o,body:r}=t;let c={},{region:u}=t;u||(u=this.region);const d=new URL(`${this.url}/${e}`);u&&u!=="any"&&(c["x-region"]=u,d.searchParams.set("forceFunctionRegion",u));let h;r&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&r instanceof Blob||r instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",h=r):typeof r=="string"?(c["Content-Type"]="text/plain",h=r):typeof FormData<"u"&&r instanceof FormData?h=r:(c["Content-Type"]="application/json",h=JSON.stringify(r)));const f=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),s),body:h}).catch(y=>{throw new Xg(y)}),p=f.headers.get("x-relay-error");if(p&&p==="true")throw new Do(f);if(!f.ok)throw new $o(f);let g=((n=f.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),m;return g==="application/json"?m=yield f.json():g==="application/octet-stream"?m=yield f.blob():g==="text/event-stream"?m=f:g==="multipart/form-data"?m=yield f.formData():m=yield f.text(),{data:m,error:null,response:f}}catch(s){return{data:null,error:s,response:s instanceof $o||s instanceof Do?s.context:void 0}}})}}function em(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function tm(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var Z={},Qe={},je={},et={},tt={},nt={},nm=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ct=nm();const im=Ct.fetch,Zr=Ct.fetch.bind(Ct),Xr=Ct.Headers,sm=Ct.Request,om=Ct.Response,Tt=Object.freeze(Object.defineProperty({__proto__:null,Headers:Xr,Request:sm,Response:om,default:Zr,fetch:im},Symbol.toStringTag,{value:"Module"})),rm=tm(Tt);var Xt={},No;function Qr(){if(No)return Xt;No=1,Object.defineProperty(Xt,"__esModule",{value:!0});class i extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Xt.default=i,Xt}var Lo;function jr(){if(Lo)return nt;Lo=1;var i=nt&&nt.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(nt,"__esModule",{value:!0});const e=i(rm),t=i(Qr());class n{constructor(o){this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=o.headers,this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=o.shouldThrowOnError,this.signal=o.signal,this.isMaybeSingle=o.isMaybeSingle,o.fetch?this.fetch=o.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,r){return this.headers=Object.assign({},this.headers),this.headers[o]=r,this}then(o,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const c=this.fetch;let u=c(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var h,f,p;let g=null,m=null,y=null,v=d.status,w=d.statusText;if(d.ok){if(this.method!=="HEAD"){const P=await d.text();P===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?m=P:m=JSON.parse(P))}const _=(h=this.headers.Prefer)===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),C=(f=d.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");_&&C&&C.length>1&&(y=parseInt(C[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(g={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,y=null,v=406,w="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const _=await d.text();try{g=JSON.parse(_),Array.isArray(g)&&d.status===404&&(m=[],g=null,v=200,w="OK")}catch{d.status===404&&_===""?(v=204,w="No Content"):g={message:_}}if(g&&this.isMaybeSingle&&(!((p=g==null?void 0:g.details)===null||p===void 0)&&p.includes("0 rows"))&&(g=null,v=200,w="OK"),g&&this.shouldThrowOnError)throw new t.default(g)}return{error:g,data:m,count:y,status:v,statusText:w}});return this.shouldThrowOnError||(u=u.catch(d=>{var h,f,p;return{error:{message:`${(h=d==null?void 0:d.name)!==null&&h!==void 0?h:"FetchError"}: ${d==null?void 0:d.message}`,details:`${(f=d==null?void 0:d.stack)!==null&&f!==void 0?f:""}`,hint:"",code:`${(p=d==null?void 0:d.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),u.then(o,r)}returns(){return this}overrideTypes(){return this}}return nt.default=n,nt}var Oo;function ea(){if(Oo)return tt;Oo=1;var i=tt&&tt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(tt,"__esModule",{value:!0});const e=i(jr());class t extends e.default{select(s){let o=!1;const r=(s??"*").split("").map(c=>/\s/.test(c)&&!o?"":(c==='"'&&(o=!o),c)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:o=!0,nullsFirst:r,foreignTable:c,referencedTable:u=c}={}){const d=u?`${u}.order`:"order",h=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${h?`${h},`:""}${s}.${o?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:o,referencedTable:r=o}={}){const c=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(c,`${s}`),this}range(s,o,{foreignTable:r,referencedTable:c=r}={}){const u=typeof c>"u"?"offset":`${c}.offset`,d=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(u,`${s}`),this.url.searchParams.set(d,`${o-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:o=!1,settings:r=!1,buffers:c=!1,wal:u=!1,format:d="text"}={}){var h;const f=[s?"analyze":null,o?"verbose":null,r?"settings":null,c?"buffers":null,u?"wal":null].filter(Boolean).join("|"),p=(h=this.headers.Accept)!==null&&h!==void 0?h:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${d}; for="${p}"; options=${f};`,d==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return tt.default=t,tt}var Uo;function Ni(){if(Uo)return et;Uo=1;var i=et&&et.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(et,"__esModule",{value:!0});const e=i(ea());class t extends e.default{eq(s,o){return this.url.searchParams.append(s,`eq.${o}`),this}neq(s,o){return this.url.searchParams.append(s,`neq.${o}`),this}gt(s,o){return this.url.searchParams.append(s,`gt.${o}`),this}gte(s,o){return this.url.searchParams.append(s,`gte.${o}`),this}lt(s,o){return this.url.searchParams.append(s,`lt.${o}`),this}lte(s,o){return this.url.searchParams.append(s,`lte.${o}`),this}like(s,o){return this.url.searchParams.append(s,`like.${o}`),this}likeAllOf(s,o){return this.url.searchParams.append(s,`like(all).{${o.join(",")}}`),this}likeAnyOf(s,o){return this.url.searchParams.append(s,`like(any).{${o.join(",")}}`),this}ilike(s,o){return this.url.searchParams.append(s,`ilike.${o}`),this}ilikeAllOf(s,o){return this.url.searchParams.append(s,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(s,o){return this.url.searchParams.append(s,`ilike(any).{${o.join(",")}}`),this}is(s,o){return this.url.searchParams.append(s,`is.${o}`),this}in(s,o){const r=Array.from(new Set(o)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(s,`in.(${r})`),this}contains(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cs.{${o.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(o)}`),this}containedBy(s,o){return typeof o=="string"?this.url.searchParams.append(s,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(s,`cd.{${o.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(o)}`),this}rangeGt(s,o){return this.url.searchParams.append(s,`sr.${o}`),this}rangeGte(s,o){return this.url.searchParams.append(s,`nxl.${o}`),this}rangeLt(s,o){return this.url.searchParams.append(s,`sl.${o}`),this}rangeLte(s,o){return this.url.searchParams.append(s,`nxr.${o}`),this}rangeAdjacent(s,o){return this.url.searchParams.append(s,`adj.${o}`),this}overlaps(s,o){return typeof o=="string"?this.url.searchParams.append(s,`ov.${o}`):this.url.searchParams.append(s,`ov.{${o.join(",")}}`),this}textSearch(s,o,{config:r,type:c}={}){let u="";c==="plain"?u="pl":c==="phrase"?u="ph":c==="websearch"&&(u="w");const d=r===void 0?"":`(${r})`;return this.url.searchParams.append(s,`${u}fts${d}.${o}`),this}match(s){return Object.entries(s).forEach(([o,r])=>{this.url.searchParams.append(o,`eq.${r}`)}),this}not(s,o,r){return this.url.searchParams.append(s,`not.${o}.${r}`),this}or(s,{foreignTable:o,referencedTable:r=o}={}){const c=r?`${r}.or`:"or";return this.url.searchParams.append(c,`(${s})`),this}filter(s,o,r){return this.url.searchParams.append(s,`${o}.${r}`),this}}return et.default=t,et}var Fo;function ta(){if(Fo)return je;Fo=1;var i=je&&je.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(je,"__esModule",{value:!0});const e=i(Ni());class t{constructor(s,{headers:o={},schema:r,fetch:c}){this.url=s,this.headers=o,this.schema=r,this.fetch=c}select(s,{head:o=!1,count:r}={}){const c=o?"HEAD":"GET";let u=!1;const d=(s??"*").split("").map(h=>/\s/.test(h)&&!u?"":(h==='"'&&(u=!u),h)).join("");return this.url.searchParams.set("select",d),r&&(this.headers.Prefer=`count=${r}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:o,defaultToNull:r=!0}={}){const c="POST",u=[];if(this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),r||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(s)){const d=s.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(d.length>0){const h=[...new Set(d)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:o,ignoreDuplicates:r=!1,count:c,defaultToNull:u=!0}={}){const d="POST",h=[`resolution=${r?"ignore":"merge"}-duplicates`];if(o!==void 0&&this.url.searchParams.set("on_conflict",o),this.headers.Prefer&&h.push(this.headers.Prefer),c&&h.push(`count=${c}`),u||h.push("missing=default"),this.headers.Prefer=h.join(","),Array.isArray(s)){const f=s.reduce((p,g)=>p.concat(Object.keys(g)),[]);if(f.length>0){const p=[...new Set(f)].map(g=>`"${g}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:o}={}){const r="PATCH",c=[];return this.headers.Prefer&&c.push(this.headers.Prefer),o&&c.push(`count=${o}`),this.headers.Prefer=c.join(","),new e.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const o="DELETE",r=[];return s&&r.push(`count=${s}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return je.default=t,je}var At={},kt={},Vo;function am(){return Vo||(Vo=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.version=void 0,kt.version="0.0.0-automated"),kt}var Bo;function lm(){if(Bo)return At;Bo=1,Object.defineProperty(At,"__esModule",{value:!0}),At.DEFAULT_HEADERS=void 0;const i=am();return At.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${i.version}`},At}var qo;function cm(){if(qo)return Qe;qo=1;var i=Qe&&Qe.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Qe,"__esModule",{value:!0});const e=i(ta()),t=i(Ni()),n=lm();class s{constructor(r,{headers:c={},schema:u,fetch:d}={}){this.url=r,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),c),this.schemaName=u,this.fetch=d}from(r){const c=new URL(`${this.url}/${r}`);return new e.default(c,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new s(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,c={},{head:u=!1,get:d=!1,count:h}={}){let f;const p=new URL(`${this.url}/rpc/${r}`);let g;u||d?(f=u?"HEAD":"GET",Object.entries(c).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{p.searchParams.append(y,v)})):(f="POST",g=c);const m=Object.assign({},this.headers);return h&&(m.Prefer=`count=${h}`),new t.default({method:f,url:p,headers:m,schema:this.schemaName,body:g,fetch:this.fetch,allowEmpty:!1})}}return Qe.default=s,Qe}var Go;function um(){if(Go)return Z;Go=1;var i=Z&&Z.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(Z,"__esModule",{value:!0}),Z.PostgrestError=Z.PostgrestBuilder=Z.PostgrestTransformBuilder=Z.PostgrestFilterBuilder=Z.PostgrestQueryBuilder=Z.PostgrestClient=void 0;const e=i(cm());Z.PostgrestClient=e.default;const t=i(ta());Z.PostgrestQueryBuilder=t.default;const n=i(Ni());Z.PostgrestFilterBuilder=n.default;const s=i(ea());Z.PostgrestTransformBuilder=s.default;const o=i(jr());Z.PostgrestBuilder=o.default;const r=i(Qr());return Z.PostgrestError=r.default,Z.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:o.default,PostgrestError:r.default},Z}var dm=um();const hm=em(dm),{PostgrestClient:fm,PostgrestQueryBuilder:uv,PostgrestFilterBuilder:dv,PostgrestTransformBuilder:hv,PostgrestBuilder:fv,PostgrestError:pv}=hm;class pm{static dynamicRequire(e){try{return typeof process<"u"&&process.versions&&process.versions.node&&typeof require<"u"?require(e):null}catch{return null}}static detectEnvironment(){var e,t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const n=parseInt(process.versions.node.split(".")[0]);if(n>=22)try{if(typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};const s=this.dynamicRequire("undici");if(s&&s.WebSocket)return{type:"native",constructor:s.WebSocket};throw new Error("undici not available")}catch{return{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:'Install the "ws" package or check your Node.js installation.'}}try{const s=this.dynamicRequire("ws");if(s)return{type:"ws",constructor:(t=s.WebSocket)!==null&&t!==void 0?t:s};throw new Error("ws package not available")}catch{return{type:"unsupported",error:`Node.js ${n} detected without WebSocket support.`,workaround:'Install the "ws" package: npm install ws'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const gm="2.15.0",mm=`realtime-js/${gm}`,ym="1.0.0",pi=1e4,vm=1e3,_m=100;var Lt;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Lt||(Lt={}));var Y;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(Y||(Y={}));var le;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(le||(le={}));var gi;(function(i){i.websocket="websocket"})(gi||(gi={}));var Be;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(Be||(Be={}));class wm{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),o=t.getUint8(2);let r=this.HEADER_LENGTH+2;const c=n.decode(e.slice(r,r+s));r=r+s;const u=n.decode(e.slice(r,r+o));r=r+o;const d=JSON.parse(n.decode(e.slice(r,e.byteLength)));return{ref:null,topic:c,event:u,payload:d}}}class na{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var W;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(W||(W={}));const Ho=(i,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((o,r)=>(o[r]=bm(r,i,e,s),o),{})},bm=(i,e,t,n)=>{const s=e.find(c=>c.name===i),o=s==null?void 0:s.type,r=t[i];return o&&!n.includes(o)?ia(o,r):mi(r)},ia=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return Sm(e,t)}switch(i){case W.bool:return Cm(e);case W.float4:case W.float8:case W.int2:case W.int4:case W.int8:case W.numeric:case W.oid:return xm(e);case W.json:case W.jsonb:return Tm(e);case W.timestamp:return Em(e);case W.abstime:case W.date:case W.daterange:case W.int4range:case W.int8range:case W.money:case W.reltime:case W.text:case W.time:case W.timestamptz:case W.timetz:case W.tsrange:case W.tstzrange:return mi(e);default:return mi(e)}},mi=i=>i,Cm=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},xm=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},Tm=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},Sm=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,n=i[t];if(i[0]==="{"&&n==="}"){let o;const r=i.slice(1,t);try{o=JSON.parse("["+r+"]")}catch{o=r?r.split(","):[]}return o.map(c=>ia(e,c))}return i},Em=i=>typeof i=="string"?i.replace(" ","T"):i,sa=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Bn{constructor(e,t,n={},s=pi){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Wo;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(Wo||(Wo={}));class Ot{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:r,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ot.syncState(this.state,s,o,r),this.pendingDiffs.forEach(u=>{this.state=Ot.syncDiff(this.state,u,o,r)}),this.pendingDiffs=[],c()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:r,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ot.syncDiff(this.state,s,o,r),c())}),this.onJoin((s,o,r)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:r})}),this.onLeave((s,o,r)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const o=this.cloneDeep(e),r=this.transformState(t),c={},u={};return this.map(o,(d,h)=>{r[d]||(u[d]=h)}),this.map(r,(d,h)=>{const f=o[d];if(f){const p=h.map(v=>v.presence_ref),g=f.map(v=>v.presence_ref),m=h.filter(v=>g.indexOf(v.presence_ref)<0),y=f.filter(v=>p.indexOf(v.presence_ref)<0);m.length>0&&(c[d]=m),y.length>0&&(u[d]=y)}else c[d]=h}),this.syncDiff(o,{joins:c,leaves:u},n,s)}static syncDiff(e,t,n,s){const{joins:o,leaves:r}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(c,u)=>{var d;const h=(d=e[c])!==null&&d!==void 0?d:[];if(e[c]=this.cloneDeep(u),h.length>0){const f=e[c].map(g=>g.presence_ref),p=h.filter(g=>f.indexOf(g.presence_ref)<0);e[c].unshift(...p)}n(c,h,u)}),this.map(r,(c,u)=>{let d=e[c];if(!d)return;const h=u.map(f=>f.presence_ref);d=d.filter(f=>h.indexOf(f.presence_ref)<0),e[c]=d,s(c,d,u),d.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var zo;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(zo||(zo={}));var Ut;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Ut||(Ut={}));var we;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(we||(we={}));class Li{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Y.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Bn(this,le.join,this.params,this.timeout),this.rejoinTimer=new na(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Y.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Y.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Y.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Y.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=Y.errored,this.rejoinTimer.scheduleTimeout())}),this._on(le.reply,{},(s,o)=>{this._trigger(this._replyEventName(o),s)}),this.presence=new Ot(this),this.broadcastEndpointURL=sa(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Y.closed){const{config:{broadcast:o,presence:r,private:c}}=this.params,u=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[Ut.PRESENCE]&&this.bindings[Ut.PRESENCE].length>0,h={},f={broadcast:o,presence:Object.assign(Object.assign({},r),{enabled:d}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(we.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(we.CLOSED)),this.updateJoinPayload(Object.assign({config:f},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var g;if(this.socket.setAuth(),p===void 0){e==null||e(we.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,y=(g=m==null?void 0:m.length)!==null&&g!==void 0?g:0,v=[];for(let w=0;w<y;w++){const S=m[w],{filter:{event:_,schema:C,table:P,filter:R}}=S,$=p&&p[w];if($&&$.event===_&&$.schema===C&&$.table===P&&$.filter===R)v.push(Object.assign(Object.assign({},S),{id:$.id}));else{this.unsubscribe(),this.state=Y.errored,e==null||e(we.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(we.SUBSCRIBED);return}}).receive("error",p=>{this.state=Y.errored,e==null||e(we.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(we.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Y.joined&&e===Ut.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:r}=e,u={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:r,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var r,c,u;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((u=(c=(r=this.params)===null||r===void 0?void 0:r.config)===null||c===void 0?void 0:c.broadcast)===null||u===void 0)&&u.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Y.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(le.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Bn(this,le.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Y.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),r=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(o),r}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Bn(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>_m){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,o;const r=e.toLocaleLowerCase(),{close:c,error:u,leave:d,join:h}=le;if(n&&[c,u,d,h].indexOf(r)>=0&&n!==this._joinRef())return;let p=this._onMessage(r,t,n);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(r)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var m,y,v;return((m=g.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(y=g.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===r}).map(g=>g.callback(p,n)):(o=this.bindings[r])===null||o===void 0||o.filter(g=>{var m,y,v,w,S,_;if(["broadcast","presence","postgres_changes"].includes(r))if("id"in g){const C=g.id,P=(m=g.filter)===null||m===void 0?void 0:m.event;return C&&((y=t.ids)===null||y===void 0?void 0:y.includes(C))&&(P==="*"||(P==null?void 0:P.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const C=(S=(w=g==null?void 0:g.filter)===null||w===void 0?void 0:w.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return C==="*"||C===((_=t==null?void 0:t.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===r}).map(g=>{if(typeof p=="object"&&"ids"in p){const m=p.data,{schema:y,table:v,commit_timestamp:w,type:S,errors:_}=m;p=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:w,eventType:S,new:{},old:{},errors:_}),this._getPayloadRecords(m))}g.callback(p,n)})}_isClosed(){return this.state===Y.closed}_isJoined(){return this.state===Y.joined}_isJoining(){return this.state===Y.joining}_isLeaving(){return this.state===Y.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),o={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&Li.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(le.close,{},e)}_onError(e){this._on(le.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Y.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ho(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ho(e.columns,e.old_record)),t}}const Jo=()=>{},Qt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Am=[1e3,2e3,5e3,1e4],km=1e4,Im=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Mm{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=pi,this.transport=null,this.heartbeatIntervalMs=Qt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Jo,this.ref=0,this.reconnectTimer=null,this.logger=Jo,this.conn=null,this.sendBuffer=[],this.serializer=new wm,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let o;return s?o=s:typeof fetch>"u"?o=(...r)=>Jt(async()=>{const{default:c}=await Promise.resolve().then(()=>Tt);return{default:c}},void 0).then(({default:c})=>c(...r)).catch(c=>{throw new Error(`Failed to load @supabase/node-fetch: ${c.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...r)=>o(...r)},!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${gi.websocket}`,this.httpEndpoint=sa(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=pm.createWebSocket(this.endpointURL())}catch(e){throw this._setConnectionState("disconnected"),new Error(`WebSocket not available: ${e.message}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ym}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Lt.connecting:return Be.Connecting;case Lt.open:return Be.Open;case Lt.closing:return Be.Closing;default:return Be.Closed}}isConnected(){return this.connectionState()===Be.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new Li(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:n,payload:s,ref:o}=e,r=()=>{this.encode(e,c=>{var u;(u=this.conn)===null||u===void 0||u.send(c)})};this.log("push",`${t} ${n} (${o})`,s),this.isConnected()?r():this.sendBuffer.push(r)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(vm,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Qt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:o,ref:r}=t,c=r?`(${r})`:"",u=o.status||"";this.log("receive",`${u} ${n} ${s} ${c}`.trim(),o),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(s,o,r)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(le.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([Im],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:mm};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(le.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new na(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Qt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,o,r,c,u,d;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:pi,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Qt.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(r=e==null?void 0:e.accessToken)!==null&&r!==void 0?r:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:h=>Am[h-1]||km,this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(h,f)=>f(JSON.stringify(h)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Oi extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function X(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Pm extends Oi{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class yi extends Oi{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Rm=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};const oa=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Jt(async()=>{const{default:n}=await Promise.resolve().then(()=>Tt);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Dm=()=>Rm(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Jt(()=>Promise.resolve().then(()=>Tt),void 0)).Response:Response}),vi=i=>{if(Array.isArray(i))return i.map(t=>vi(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[s]=vi(n)}),e},$m=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var Ze=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};const qn=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Nm=(i,e,t)=>Ze(void 0,void 0,void 0,function*(){const n=yield Dm();i instanceof n&&!(t!=null&&t.noResolveJson)?i.json().then(s=>{const o=i.status||500,r=(s==null?void 0:s.statusCode)||o+"";e(new Pm(qn(s),o,r))}).catch(s=>{e(new yi(qn(s),s))}):e(new yi(qn(i),i))}),Lm=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||!n?s:($m(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,Object.assign(Object.assign({},s),t))};function Kt(i,e,t,n,s,o){return Ze(this,void 0,void 0,function*(){return new Promise((r,c)=>{i(t,Lm(e,n,s,o)).then(u=>{if(!u.ok)throw u;return n!=null&&n.noResolveJson?u:u.json()}).then(u=>r(u)).catch(u=>Nm(u,c,n))})})}function Cn(i,e,t,n){return Ze(this,void 0,void 0,function*(){return Kt(i,"GET",e,t,n)})}function be(i,e,t,n,s){return Ze(this,void 0,void 0,function*(){return Kt(i,"POST",e,n,s,t)})}function _i(i,e,t,n,s){return Ze(this,void 0,void 0,function*(){return Kt(i,"PUT",e,n,s,t)})}function Om(i,e,t,n){return Ze(this,void 0,void 0,function*(){return Kt(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function ra(i,e,t,n,s){return Ze(this,void 0,void 0,function*(){return Kt(i,"DELETE",e,n,s,t)})}var te=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};const Um={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ko={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Fm{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=oa(s)}uploadOrUpdate(e,t,n,s){return te(this,void 0,void 0,function*(){try{let o;const r=Object.assign(Object.assign({},Ko),s);let c=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(r.upsert)});const u=r.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",r.cacheControl),u&&o.append("metadata",this.encodeMetadata(u)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",r.cacheControl),u&&o.append("metadata",this.encodeMetadata(u))):(o=n,c["cache-control"]=`max-age=${r.cacheControl}`,c["content-type"]=r.contentType,u&&(c["x-metadata"]=this.toBase64(this.encodeMetadata(u)))),s!=null&&s.headers&&(c=Object.assign(Object.assign({},c),s.headers));const d=this._removeEmptyFolders(t),h=this._getFinalPath(d),f=yield(e=="PUT"?_i:be)(this.fetch,`${this.url}/object/${h}`,o,Object.assign({headers:c},r!=null&&r.duplex?{duplex:r.duplex}:{}));return{data:{path:d,id:f.Id,fullPath:f.Key},error:null}}catch(o){if(X(o))return{data:null,error:o};throw o}})}upload(e,t,n){return te(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return te(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),r=this._getFinalPath(o),c=new URL(this.url+`/object/upload/sign/${r}`);c.searchParams.set("token",t);try{let u;const d=Object.assign({upsert:Ko.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(u=new FormData,u.append("cacheControl",d.cacheControl),u.append("",n)):typeof FormData<"u"&&n instanceof FormData?(u=n,u.append("cacheControl",d.cacheControl)):(u=n,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType);const f=yield _i(this.fetch,c.toString(),u,{headers:h});return{data:{path:o,fullPath:f.Key},error:null}}catch(u){if(X(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e,t){return te(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const o=yield be(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),r=new URL(this.url+o.url),c=r.searchParams.get("token");if(!c)throw new Oi("No token returned by API");return{data:{signedUrl:r.toString(),path:e,token:c},error:null}}catch(n){if(X(n))return{data:null,error:n};throw n}})}update(e,t,n){return te(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return te(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(X(s))return{data:null,error:s};throw s}})}copy(e,t,n){return te(this,void 0,void 0,function*(){try{return{data:{path:(yield be(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(X(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return te(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),o=yield be(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const r=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${r}`)},{data:o,error:null}}catch(s){if(X(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return te(this,void 0,void 0,function*(){try{const s=yield be(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(r=>Object.assign(Object.assign({},r),{signedUrl:r.signedURL?encodeURI(`${this.url}${r.signedURL}${o}`):null})),error:null}}catch(s){if(X(s))return{data:null,error:s};throw s}})}download(e,t){return te(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),r=o?`?${o}`:"";try{const c=this._getFinalPath(e);return{data:yield(yield Cn(this.fetch,`${this.url}/${s}/${c}${r}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(c){if(X(c))return{data:null,error:c};throw c}})}info(e){return te(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield Cn(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:vi(n),error:null}}catch(n){if(X(n))return{data:null,error:n};throw n}})}exists(e){return te(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Om(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(X(n)&&n instanceof yi){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],o=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&s.push(o);const c=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",u=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});u!==""&&s.push(u);let d=s.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${c}/public/${n}${d}`)}}}remove(e){return te(this,void 0,void 0,function*(){try{return{data:yield ra(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(X(t))return{data:null,error:t};throw t}})}list(e,t,n){return te(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Um),t),{prefix:e||""});return{data:yield be(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(X(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Vm="2.10.4",Bm={"X-Client-Info":`storage-js/${Vm}`};var it=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};class qm{constructor(e,t={},n,s){const o=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},Bm),t),this.fetch=oa(n)}listBuckets(){return it(this,void 0,void 0,function*(){try{return{data:yield Cn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(X(e))return{data:null,error:e};throw e}})}getBucket(e){return it(this,void 0,void 0,function*(){try{return{data:yield Cn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(X(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return it(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(X(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return it(this,void 0,void 0,function*(){try{return{data:yield _i(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(X(n))return{data:null,error:n};throw n}})}emptyBucket(e){return it(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(X(t))return{data:null,error:t};throw t}})}deleteBucket(e){return it(this,void 0,void 0,function*(){try{return{data:yield ra(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(X(t))return{data:null,error:t};throw t}})}}class Gm extends qm{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new Fm(this.url,this.headers,e,this.fetch)}}const Hm="2.54.0";let Pt="";typeof Deno<"u"?Pt="deno":typeof document<"u"?Pt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Pt="react-native":Pt="node";const Wm={"X-Client-Info":`supabase-js-${Pt}/${Hm}`},zm={headers:Wm},Jm={schema:"public"},Km={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ym={};var Zm=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};const Xm=i=>{let e;return i?e=i:typeof fetch>"u"?e=Zr:e=fetch,(...t)=>e(...t)},Qm=()=>typeof Headers>"u"?Xr:Headers,jm=(i,e,t)=>{const n=Xm(t),s=Qm();return(o,r)=>Zm(void 0,void 0,void 0,function*(){var c;const u=(c=yield e())!==null&&c!==void 0?c:i;let d=new s(r==null?void 0:r.headers);return d.has("apikey")||d.set("apikey",i),d.has("Authorization")||d.set("Authorization",`Bearer ${u}`),n(o,Object.assign(Object.assign({},r),{headers:d}))})};var ey=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};function ty(i){return i.endsWith("/")?i:i+"/"}function ny(i,e){var t,n;const{db:s,auth:o,realtime:r,global:c}=i,{db:u,auth:d,realtime:h,global:f}=e,p={db:Object.assign(Object.assign({},u),s),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},h),r),storage:{},global:Object.assign(Object.assign(Object.assign({},f),c),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(n=c==null?void 0:c.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>ey(this,void 0,void 0,function*(){return""})};return i.accessToken?p.accessToken=i.accessToken:delete p.accessToken,p}const aa="2.71.1",ut=30*1e3,wi=3,Gn=wi*ut,iy="http://localhost:9999",sy="supabase.auth.token",oy={"X-Client-Info":`gotrue-js/${aa}`},bi="X-Supabase-Api-Version",la={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ry=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ay=600*1e3;class Ui extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function D(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class ly extends Ui{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function cy(i){return D(i)&&i.name==="AuthApiError"}class ca extends Ui{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ne extends Ui{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Se extends Ne{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function uy(i){return D(i)&&i.name==="AuthSessionMissingError"}class jt extends Ne{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class en extends Ne{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class tn extends Ne{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function dy(i){return D(i)&&i.name==="AuthImplicitGrantRedirectError"}class Yo extends Ne{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ci extends Ne{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Hn(i){return D(i)&&i.name==="AuthRetryableFetchError"}class Zo extends Ne{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class xi extends Ne{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const xn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Xo=` 	
\r=`.split(""),hy=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<Xo.length;e+=1)i[Xo[e].charCodeAt(0)]=-2;for(let e=0;e<xn.length;e+=1)i[xn[e].charCodeAt(0)]=e;return i})();function Qo(i,e,t){if(i!==null)for(e.queue=e.queue<<8|i,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(xn[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(xn[n]),e.queuedBits-=6}}function ua(i,e,t){const n=hy[i];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function jo(i){const e=[],t=r=>{e.push(String.fromCodePoint(r))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=r=>{gy(r,n,t)};for(let r=0;r<i.length;r+=1)ua(i.charCodeAt(r),s,o);return e.join("")}function fy(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function py(i,e){for(let t=0;t<i.length;t+=1){let n=i.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(i.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}fy(n,e)}}function gy(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let n=1;n<6;n+=1)if((i>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function my(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<i.length;s+=1)ua(i.charCodeAt(s),t,n);return new Uint8Array(e)}function yy(i){const e=[];return py(i,t=>e.push(t)),new Uint8Array(e)}function vy(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return i.forEach(s=>Qo(s,t,n)),Qo(null,t,n),e.join("")}function _y(i){return Math.round(Date.now()/1e3)+i}function wy(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const ae=()=>typeof window<"u"&&typeof document<"u",Ue={tested:!1,writable:!1},da=()=>{if(!ae())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ue.tested)return Ue.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Ue.tested=!0,Ue.writable=!0}catch{Ue.tested=!0,Ue.writable=!1}return Ue.writable};function by(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,o)=>{e[o]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const ha=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>Jt(async()=>{const{default:n}=await Promise.resolve().then(()=>Tt);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Cy=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",dt=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},Fe=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Te=async(i,e)=>{await i.removeItem(e)};class Pn{constructor(){this.promise=new Pn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Pn.promiseConstructor=Promise;function Wn(i){const e=i.split(".");if(e.length!==3)throw new xi("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!ry.test(e[n]))throw new xi("JWT not in base64url format");return{header:JSON.parse(jo(e[0])),payload:JSON.parse(jo(e[1])),signature:my(e[2]),raw:{header:e[0],payload:e[1]}}}async function xy(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function Ty(i,e){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const r=await i(o);if(!e(o,null,r)){n(r);return}}catch(r){if(!e(o,r)){s(r);return}}})()})}function Sy(i){return("0"+i.toString(16)).substr(-2)}function Ey(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let o=0;o<56;o++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Sy).join("")}async function Ay(i){const t=new TextEncoder().encode(i),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function ky(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await Ay(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function st(i,e,t=!1){const n=Ey();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await dt(i,`${e}-code-verifier`,s);const o=await ky(n);return[o,n===o?"plain":"s256"]}const Iy=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function My(i){const e=i.headers.get(bi);if(!e||!e.match(Iy))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Py(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function Ry(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Dy=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ot(i){if(!Dy.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function zn(){const i={};return new Proxy(i,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function er(i){return JSON.parse(JSON.stringify(i))}var $y=function(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t};const Ve=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Ny=[502,503,504];async function tr(i){var e;if(!Cy(i))throw new Ci(Ve(i),0);if(Ny.includes(i.status))throw new Ci(Ve(i),i.status);let t;try{t=await i.json()}catch(o){throw new ca(Ve(o),o)}let n;const s=My(i);if(s&&s.getTime()>=la["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Zo(Ve(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Se}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,r)=>o&&typeof r=="string",!0))throw new Zo(Ve(t),i.status,t.weak_password.reasons);throw new ly(Ve(t),i.status||500,n)}const Ly=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function L(i,e,t,n){var s;const o=Object.assign({},n==null?void 0:n.headers);o[bi]||(o[bi]=la["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const r=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(r.redirect_to=n.redirectTo);const c=Object.keys(r).length?"?"+new URLSearchParams(r).toString():"",u=await Oy(i,e,t+c,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(u):{data:Object.assign({},u),error:null}}async function Oy(i,e,t,n,s,o){const r=Ly(e,n,s,o);let c;try{c=await i(t,Object.assign({},r))}catch(u){throw console.error(u),new Ci(Ve(u),0)}if(c.ok||await tr(c),n!=null&&n.noResolveJson)return c;try{return await c.json()}catch(u){await tr(u)}}function _e(i){var e;let t=null;By(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=_y(i.expires_in)));const n=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:n},error:null}}function nr(i){const e=_e(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=i.weak_password),e}function ke(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Uy(i){return{data:i,error:null}}function Fy(i){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:o}=i,r=$y(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:o},u=Object.assign({},r);return{data:{properties:c,user:u},error:null}}function Vy(i){return i}function By(i){return i.access_token&&i.refresh_token&&i.expires_in}const Jn=["global","local","others"];var qy=function(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t};class Gy{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=ha(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Jn[0]){if(Jn.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jn.join(", ")}`);try{return await L(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await L(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ke})}catch(n){if(D(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=qy(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await L(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Fy,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(D(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await L(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ke})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,o,r,c,u;try{const d={nextPage:null,lastPage:0,total:0},h=await L(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:Vy});if(h.error)throw h.error;const f=await h.json(),p=(r=h.headers.get("x-total-count"))!==null&&r!==void 0?r:0,g=(u=(c=h.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&u!==void 0?u:[];return g.length>0&&(g.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);d[`${v}Page`]=y}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(D(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){ot(e);try{return await L(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ke})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ot(e);try{return await L(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ke})}catch(n){if(D(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){ot(e);try{return await L(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ke})}catch(n){if(D(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){ot(e.userId);try{const{data:t,error:n}=await L(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(D(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ot(e.userId),ot(e.id);try{return{data:await L(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}}function ir(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function Hy(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const rt={debug:!!(globalThis&&da()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fa extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Wy extends fa{}async function zy(i,e,t){rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),rt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw rt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Wy(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(rt.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Hy();const Jy={url:iy,storageKey:sy,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:oy,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function sr(i,e,t){return await t()}const at={};class Gt{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Gt.nextInstanceID,Gt.nextInstanceID+=1,this.instanceID>0&&ae()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Jy),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Gy({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=ha(s.fetch),this.lock=s.lock||sr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ae()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=zy:this.lock=sr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:da()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ir(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=ir(this.memoryStorage)),ae()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=at[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){at[this.storageKey]=Object.assign(Object.assign({},at[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=at[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){at[this.storageKey]=Object.assign(Object.assign({},at[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${aa}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=by(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),ae()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(t,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),dy(o)){const u=(e=o.details)===null||e===void 0?void 0:e.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:r,redirectType:c}=s;return this._debug("#_initialize()","detected session in URL",r,"redirect type",c),await this._saveSession(r),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",r):await this._notifyAllSubscribers("SIGNED_IN",r)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return D(t)?{error:t}:{error:new ca("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const o=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:_e}),{data:r,error:c}=o;if(c||!r)return{data:{user:null,session:null},error:c};const u=r.session,d=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:d,session:u},error:null}}catch(o){if(D(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,n,s;try{let o;if("email"in e){const{email:h,password:f,options:p}=e;let g=null,m=null;this.flowType==="pkce"&&([g,m]=await st(this.storage,this.storageKey)),o=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:h,password:f,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:g,code_challenge_method:m},xform:_e})}else if("phone"in e){const{phone:h,password:f,options:p}=e;o=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:f,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},channel:(s=p==null?void 0:p.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:_e})}else throw new en("You must provide either an email or phone number and a password");const{data:r,error:c}=o;if(c||!r)return{data:{user:null,session:null},error:c};const u=r.session,d=r.user;return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",u)),{data:{user:d,session:u},error:null}}catch(o){if(D(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:r,options:c}=e;t=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:r,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:nr})}else if("phone"in e){const{phone:o,password:r,options:c}=e;t=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:r,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:nr})}else throw new en("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new jt}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,o,r,c,u,d,h,f,p,g;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:v,wallet:w,statement:S,options:_}=e;let C;if(ae())if(typeof w=="object")C=w;else{const R=window;if("solana"in R&&typeof R.solana=="object"&&("signIn"in R.solana&&typeof R.solana.signIn=="function"||"signMessage"in R.solana&&typeof R.solana.signMessage=="function"))C=R.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=w}const P=new URL((t=_==null?void 0:_.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in C&&C.signIn){const R=await C.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_==null?void 0:_.signInWithSolana),{version:"1",domain:P.host,uri:P.href}),S?{statement:S}:null));let $;if(Array.isArray(R)&&R[0]&&typeof R[0]=="object")$=R[0];else if(R&&typeof R=="object"&&"signedMessage"in R&&"signature"in R)$=R;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in $&&"signature"in $&&(typeof $.signedMessage=="string"||$.signedMessage instanceof Uint8Array)&&$.signature instanceof Uint8Array)m=typeof $.signedMessage=="string"?$.signedMessage:new TextDecoder().decode($.signedMessage),y=$.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in C)||typeof C.signMessage!="function"||!("publicKey"in C)||typeof C!="object"||!C.publicKey||!("toBase58"in C.publicKey)||typeof C.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${P.host} wants you to sign in with your Solana account:`,C.publicKey.toBase58(),...S?["",S,""]:[""],"Version: 1",`URI: ${P.href}`,`Issued At: ${(s=(n=_==null?void 0:_.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=_==null?void 0:_.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((r=_==null?void 0:_.signInWithSolana)===null||r===void 0)&&r.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((c=_==null?void 0:_.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((u=_==null?void 0:_.signInWithSolana)===null||u===void 0)&&u.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((d=_==null?void 0:_.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((f=(h=_==null?void 0:_.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||f===void 0)&&f.length?["Resources",..._.signInWithSolana.resources.map($=>`- ${$}`)]:[]].join(`
`);const R=await C.signMessage(new TextEncoder().encode(m),"utf8");if(!R||!(R instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=R}}try{const{data:v,error:w}=await L(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:vy(y)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:_e});if(w)throw w;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new jt}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:w})}catch(v){if(D(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await Fe(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:o,error:r}=await L(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:_e});if(await Te(this.storage,`${this.storageKey}-code-verifier`),r)throw r;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new jt}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:r})}catch(o){if(D(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:o,nonce:r}=e,c=await L(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:r,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:_e}),{data:u,error:d}=c;return d?{data:{user:null,session:null},error:d}:!u||!u.session||!u.user?{data:{user:null,session:null},error:new jt}:(u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),{data:u,error:d})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,o,r;try{if("email"in e){const{email:c,options:u}=e;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await st(this.storage,this.storageKey));const{error:f}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=u==null?void 0:u.data)!==null&&t!==void 0?t:{},create_user:(n=u==null?void 0:u.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:u==null?void 0:u.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:c,options:u}=e,{data:d,error:h}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(s=u==null?void 0:u.data)!==null&&s!==void 0?s:{},create_user:(o=u==null?void 0:u.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(r=u==null?void 0:u.channel)!==null&&r!==void 0?r:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:h}}throw new en("You must provide either an email or phone number.")}catch(c){if(D(c))return{data:{user:null,session:null},error:c};throw c}}async verifyOtp(e){var t,n;try{let s,o;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:r,error:c}=await L(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:_e});if(c)throw c;if(!r)throw new Error("An error occurred on token verification.");const u=r.session,d=r.user;return u!=null&&u.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),{data:{user:d,session:u},error:null}}catch(s){if(D(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let o=null,r=null;return this.flowType==="pkce"&&([o,r]=await st(this.storage,this.storageKey)),await L(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:r}),headers:this.headers,xform:Uy})}catch(o){if(D(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Se;const{error:s}=await L(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(D(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:o}=e,{error:r}=await L(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:r}}else if("phone"in e){const{phone:n,type:s,options:o}=e,{data:r,error:c}=await L(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:r==null?void 0:r.message_id},error:c}}throw new en("You must provide either an email or phone number and a type")}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Fe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Gn:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const r=await Fe(this.userStorage,this.storageKey+"-user");r!=null&&r.user?e.user=r.user:e.user=zn()}if(this.storage.isServer&&e.user){let r=this.suppressGetSessionWarning;e=new Proxy(e,{get:(u,d,h)=>(!r&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),r=!0,this.suppressGetSessionWarning=!0),Reflect.get(u,d,h))})}return{data:{session:e},error:null}}const{session:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ke}):await this._useSession(async t=>{var n,s,o;const{data:r,error:c}=t;if(c)throw c;return!(!((n=r.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Se}:await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=r.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:ke})})}catch(t){if(D(t))return uy(t)&&(await this._removeSession(),await Te(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new Se;const r=s.session;let c=null,u=null;this.flowType==="pkce"&&e.email!=null&&([c,u]=await st(this.storage,this.storageKey));const{data:d,error:h}=await L(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:u}),jwt:r.access_token,xform:ke});if(h)throw h;return r.user=d.user,await this._saveSession(r),await this._notifyAllSubscribers("USER_UPDATED",r),{data:{user:r.user},error:null}})}catch(n){if(D(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Se;const t=Date.now()/1e3;let n=t,s=!0,o=null;const{payload:r}=Wn(e.access_token);if(r.exp&&(n=r.exp,s=n<=t),s){const{session:c,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return{data:{user:null,session:null},error:u};if(!c)return{data:{user:null,session:null},error:null};o=c}else{const{data:c,error:u}=await this._getUser(e.access_token);if(u)throw u;o={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(D(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:r,error:c}=t;if(c)throw c;e=(n=r.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Se;const{session:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ae())throw new tn("No browser detected.");if(e.error||e.error_description||e.error_code)throw new tn(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Yo("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new tn("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Yo("No code detected.");const{data:S,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const C=new URL(window.location.href);return C.searchParams.delete("code"),window.history.replaceState(window.history.state,"",C.toString()),{data:{session:S.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:r,expires_in:c,expires_at:u,token_type:d}=e;if(!o||!c||!r||!d)throw new tn("No session defined in URL");const h=Math.round(Date.now()/1e3),f=parseInt(c);let p=h+f;u&&(p=parseInt(u));const g=p-h;g*1e3<=ut&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${f}s`);const m=p-f;h-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,p,h):h-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,p,h);const{data:y,error:v}=await this._getUser(o);if(v)throw v;const w={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:f,expires_at:p,refresh_token:r,token_type:d,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(n){if(D(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Fe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o)return{error:o};const r=(n=s.session)===null||n===void 0?void 0:n.access_token;if(r){const{error:c}=await this.admin.signOut(r,e);if(c&&!(cy(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(await this._removeSession(),await Te(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=wy(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:o},error:r}=t;if(r)throw r;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await st(this.storage,this.storageKey,!0));try{return await L(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(D(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async o=>{var r,c,u,d,h;const{data:f,error:p}=o;if(p)throw p;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await L(this.fetch,"GET",g,{headers:this.headers,jwt:(h=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return ae()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(D(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:o,error:r}=t;if(r)throw r;return await L(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await Ty(async s=>(s>0&&await xy(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await L(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:_e})),(s,o)=>{const r=200*Math.pow(2,s);return o&&Hn(o)&&Date.now()+r-n<ut})}catch(n){if(this._debug(t,"error",n),D(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),ae()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Fe(this.storage,this.storageKey);if(s&&this.userStorage){let r=await Fe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!r&&(r={user:s.user},await dt(this.userStorage,this.storageKey+"-user",r)),s.user=(e=r==null?void 0:r.user)!==null&&e!==void 0?e:zn()}else if(s&&!s.user&&!s.user){const r=await Fe(this.storage,this.storageKey+"-user");r&&(r!=null&&r.user)?(s.user=r.user,await Te(this.storage,this.storageKey+"-user"),await dt(this.storage,this.storageKey,s)):s.user=zn()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Gn;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${Gn}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:r}=await this._callRefreshToken(s.refresh_token);r&&(console.error(r),Hn(r)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",r),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:r,error:c}=await this._getUser(s.access_token);!c&&(r!=null&&r.user)?(s.user=r.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(n,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Se;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Pn;const{data:o,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!o.session)throw new Se;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const c={session:o.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(o){if(this._debug(s,"error",o),D(o)){const r={session:null,error:o};return Hn(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(r),r}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],r=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(u){o.push(u)}});if(await Promise.all(r),o.length>0){for(let c=0;c<o.length;c+=1)console.error(o[c]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await dt(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const o=er(s);await dt(this.storage,this.storageKey,o)}else{const s=er(t);await dt(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Te(this.storage,this.storageKey),await Te(this.storage,this.storageKey+"-code-verifier"),await Te(this.storage,this.storageKey+"-user"),this.userStorage&&await Te(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ae()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ut);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/ut);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${ut}ms, refresh threshold is ${wi} ticks`),s<=wi&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof fa)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ae()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,r]=await st(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(r)}`});s.push(c.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;return o?{data:null,error:o}:await L(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:o,error:r}=t;if(r)return{data:null,error:r};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:u,error:d}=await L(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((s=u==null?void 0:u.totp)===null||s===void 0)&&s.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),{data:u,error:null})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o)return{data:null,error:o};const{data:r,error:c}=await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+r.expires_in},r)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",r),{data:r,error:c})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;return o?{data:null,error:o}:await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],s=n.filter(r=>r.factor_type==="totp"&&r.status==="verified"),o=n.filter(r=>r.factor_type==="phone"&&r.status==="verified");return{data:{all:n,totp:s,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:o}=e;if(o)return{data:null,error:o};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:r}=Wn(s.access_token);let c=null;r.aal&&(c=r.aal);let u=c;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(u="aal2");const h=r.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(c=>c.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(c=>c.kid===e),n&&this.jwks_cached_at+ay>s)return n;const{data:o,error:r}=await L(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(r)throw r;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(c=>c.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:g,error:m}=await this.getSession();if(m||!g.session)return{data:null,error:m};n=g.session.access_token}const{header:s,payload:o,signature:r,raw:{header:c,payload:u}}=Wn(n);t!=null&&t.allowExpired||Py(o.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!d){const{error:g}=await this.getUser(n);if(g)throw g;return{data:{claims:o,header:s,signature:r},error:null}}const h=Ry(s.alg),f=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,f,r,yy(`${c}.${u}`)))throw new xi("Invalid JWT signature");return{data:{claims:o,header:s,signature:r},error:null}}catch(n){if(D(n))return{data:null,error:n};throw n}}}Gt.nextInstanceID=0;const Ky=Gt;class Yy extends Ky{constructor(e){super(e)}}var Zy=function(i,e,t,n){function s(o){return o instanceof t?o:new t(function(r){r(o)})}return new(t||(t=Promise))(function(o,r){function c(h){try{d(n.next(h))}catch(f){r(f)}}function u(h){try{d(n.throw(h))}catch(f){r(f)}}function d(h){h.done?o(h.value):s(h.value).then(c,u)}d((n=n.apply(i,e||[])).next())})};class Xy{constructor(e,t,n){var s,o,r;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const c=ty(e),u=new URL(c);this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const d=`sb-${u.hostname.split(".")[0]}-auth-token`,h={db:Jm,realtime:Ym,auth:Object.assign(Object.assign({},Km),{storageKey:d}),global:zm},f=ny(n??{},h);this.storageKey=(s=f.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(o=f.global.headers)!==null&&o!==void 0?o:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(p,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((r=f.auth)!==null&&r!==void 0?r:{},this.headers,f.global.fetch),this.fetch=jm(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new fm(new URL("rest/v1",u).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new Gm(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new jg(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Zy(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,storageKey:o,flowType:r,lock:c,debug:u},d,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Yy({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),d),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,flowType:r,lock:c,debug:u,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Mm(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Qy=(i,e,t)=>new Xy(i,e,t);function jy(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const e=i.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}jy()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Kn={},ev=Kn==null?void 0:Kn.VITE_GEMINI_API_KEY,tv=new Xp({apiKey:ev,apiVersion:"v1alpha"}),nv="lyria-realtime-exp",pa=Qy(void 0,void 0);function iv(){sv()}async function Ti(){const{data:{user:i}}=await pa.auth.getUser(),e=(i==null?void 0:i.id)??"",t=(i==null?void 0:i.email)??"",n=ov(),s=new O(n);s.userId=e,s.userEmail=t,document.body.appendChild(s);const o=new ue;document.body.appendChild(o);const r=new Hg(tv,nv);r.setWeightedPrompts(n);let c=null,u=null;const d=new Wg(r.audioContext);r.extraDestination=d.node,s.addEventListener("prompts-changed",f=>{const g=f.detail;console.log("Main app received prompts-changed event:",g),r.setWeightedPrompts(g)}),s.addEventListener("play-pause",()=>{r.playPause()}),s.addEventListener("toggle-recording",async()=>{try{if(!c)c=new ko(r.audioContext,r.recordTap,"audio/webm;codecs=opus",!0),c.start(),s.isRecording=!0;else{const f=await c.stop();c=null,s.isRecording=!1,u=f;const p=URL.createObjectURL(f),g=document.createElement("a");g.href=p;const m=new Date().toISOString().replace(/[:.]/g,"-"),y=f.type==="audio/mpeg";g.download=`deeprabbit-${m}.${y?"mp3":"webm"}`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(p)}}catch(f){console.error(f);const p=new ue;document.body.appendChild(p),p.show(f.message||"Recording error")}}),s.addEventListener("export-audio",async f=>{const p=f.detail;try{const g=new Date().toISOString().replace(/[:.]/g,"-");if(u){if(p.kind==="mp3"){const v=URL.createObjectURL(u),w=document.createElement("a");w.href=v,w.download=`deeprabbit-${g}.mp3`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(v)}else{const v=await u.arrayBuffer(),w=await r.audioContext.decodeAudioData(v.slice(0)),S=Po(w),_=URL.createObjectURL(S),C=document.createElement("a");C.href=_,C.download=`deeprabbit-${g}.wav`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(_)}return}const m=new ko(r.audioContext,r.recordTap,"audio/webm;codecs=opus",!0);m.start(),await new Promise(v=>setTimeout(v,1500));const y=await m.stop();if(p.kind==="mp3"){const v=URL.createObjectURL(y),w=document.createElement("a");w.href=v,w.download=`deeprabbit-${g}.mp3`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(v)}else{const v=await y.arrayBuffer(),w=await r.audioContext.decodeAudioData(v.slice(0)),S=Po(w),_=URL.createObjectURL(S),C=document.createElement("a");C.href=_,C.download=`deeprabbit-${g}.wav`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(_)}}catch(g){const m=new ue;document.body.appendChild(m),m.show((g==null?void 0:g.message)||"Export failed")}}),r.addEventListener("playback-state-changed",f=>{const g=f.detail;s.playbackState=g,g==="playing"?d.start():d.stop()}),r.addEventListener("filtered-prompt",f=>{const g=f.detail;o.show(g.filteredReason),s.addFilteredPrompt(g.text)});const h=f=>{const g=f.detail;o.show(g)};r.addEventListener("error",h),s.addEventListener("error",h),d.addEventListener("audio-level-changed",f=>{const g=f.detail;s.audioLevel=g})}async function sv(){try{const{data:{user:i}}=await pa.auth.getUser(),e=(i==null?void 0:i.id)??"",t=(i==null?void 0:i.email)??"";if(!e){Yn(e,t);return}const s=await(await fetch(`/api/plan?userId=${encodeURIComponent(e)}`)).json();(s==null?void 0:s.plan)==="pro"?Ti():Yn(e,t)}catch{Yn("","")}}function Yn(i,e){const t=document.createElement("subscription-gate");t.userId=i,t.email=e,t.addEventListener("refresh-plan",async()=>{try{if(!i){const o=new ue;document.body.appendChild(o),o.show("Sign in required before refreshing plan.");return}const n=await fetch(`/api/plan?userId=${encodeURIComponent(i)}`);if(!n.ok){const o=await n.text(),r=new ue;document.body.appendChild(r),r.show(o||"Plan check failed");return}const s=await n.json();(s==null?void 0:s.plan)==="pro"&&(t.remove(),Ti())}catch{}}),t.addEventListener("notify",n=>{const s=n.detail,o=new ue;document.body.appendChild(o),o.show(s)}),t.addEventListener("dev-bypass",()=>{var s;const n=(((s=window==null?void 0:window.location)==null?void 0:s.hostname)||"").toLowerCase();(n==="localhost"||n==="127.0.0.1")&&(t.remove(),Ti())}),document.body.appendChild(t)}function ov(){const i=new Map;for(let e=0;e<or.length;e++){const t=`prompt-${e}`,n=or[e],{text:s,color:o}=n;i.set(t,{promptId:t,text:s,weight:0,cc:0,color:o})}return i}const or=[{color:"#9900ff",text:"Bossa Nova"},{color:"#5200ff",text:"Chillwave"},{color:"#ff25f6",text:"Drum and Bass"},{color:"#2af6de",text:"Post Punk"},{color:"#ffdd28",text:"Shoegaze"},{color:"#2af6de",text:"Funk"},{color:"#9900ff",text:"Chiptune"},{color:"#3dffab",text:"Lush Strings"},{color:"#d8ff3e",text:"Sparkling Arpeggios"},{color:"#d9b2ff",text:"Staccato Rhythms"},{color:"#3dffab",text:"Punchy Kick"},{color:"#ffdd28",text:"Dubstep"},{color:"#ff25f6",text:"K Pop"},{color:"#d8ff3e",text:"Neo Soul"},{color:"#5200ff",text:"Trip Hop"},{color:"#d9b2ff",text:"Thrash"},{color:"#ff6b6b",text:"Jazz"},{color:"#4ecdc4",text:"R&B"},{color:"#45b7d1",text:"Hip Hop"},{color:"#96ceb4",text:"House"},{color:"#ffeaa7",text:"Techno"},{color:"#dda0dd",text:"Ambient"},{color:"#ffb347",text:"Classical"},{color:"#98d8c8",text:"Reggae"},{color:"#9900ff",text:"Afrobeat"},{color:"#5200ff",text:"Lo-Fi"},{color:"#ff25f6",text:"Trap"},{color:"#2af6de",text:"Blues"},{color:"#ffdd28",text:"Country"},{color:"#3dffab",text:"Latin Pop"},{color:"#d8ff3e",text:"Salsa"},{color:"#d9b2ff",text:"Samba"},{color:"#ff6b6b",text:"Trance"},{color:"#4ecdc4",text:"Future Bass"},{color:"#45b7d1",text:"Melodic Techno"},{color:"#96ceb4",text:"Progressive House"},{color:"#ffeaa7",text:"UK Garage"},{color:"#dda0dd",text:"Psytrance"},{color:"#ffb347",text:"Hardstyle"},{color:"#98d8c8",text:"Vaporwave"},{color:"#9900ff",text:"Synthwave"},{color:"#5200ff",text:"City Pop"},{color:"#ff25f6",text:"Disco"},{color:"#2af6de",text:"Soul"},{color:"#ffdd28",text:"Motown"},{color:"#3dffab",text:"Bluegrass"},{color:"#d8ff3e",text:"Flamenco"},{color:"#d9b2ff",text:"Reggaeton"},{color:"#ff6b6b",text:"Drill"},{color:"#4ecdc4",text:"Grime"},{color:"#45b7d1",text:"Industrial"},{color:"#96ceb4",text:"IDM"},{color:"#ffeaa7",text:"Glitch"},{color:"#dda0dd",text:"Minimal"},{color:"#ffb347",text:"Electro"},{color:"#98d8c8",text:"Breakbeat"},{color:"#9900ff",text:"Jungle"},{color:"#5200ff",text:"Liquid DnB"},{color:"#ff25f6",text:"Neurofunk"},{color:"#2af6de",text:"Future Garage"},{color:"#ffdd28",text:"Chillstep"},{color:"#3dffab",text:"Synth Pop"},{color:"#d8ff3e",text:"Indie Rock"},{color:"#d9b2ff",text:"Alternative Rock"},{color:"#ff6b6b",text:"Progressive Rock"},{color:"#4ecdc4",text:"Math Rock"},{color:"#45b7d1",text:"Post Rock"},{color:"#96ceb4",text:"Cinematic"},{color:"#ffeaa7",text:"Trailer Music"},{color:"#dda0dd",text:"Epic Orchestral"},{color:"#ffb347",text:"Dark Ambient"},{color:"#98d8c8",text:"Drone"},{color:"#9900ff",text:"Hyperpop"},{color:"#5200ff",text:"Glitch Hop"},{color:"#ff25f6",text:"Boom Bap"},{color:"#2af6de",text:"Trap Soul"},{color:"#ffdd28",text:"Cloud Rap"},{color:"#3dffab",text:"Afro House"},{color:"#d8ff3e",text:"Amapiano"},{color:"#d9b2ff",text:"Gqom"},{color:"#ff6b6b",text:"Dancehall"},{color:"#4ecdc4",text:"Ska"},{color:"#45b7d1",text:"Dub"},{color:"#96ceb4",text:"Moombahton"},{color:"#ffeaa7",text:"Cumbia"},{color:"#dda0dd",text:"Bachata"},{color:"#ffb347",text:"Merengue"},{color:"#98d8c8",text:"Zouk"},{color:"#9900ff",text:"Kizomba"},{color:"#5200ff",text:"Uplifting Trance"},{color:"#ff25f6",text:"Tech Trance"},{color:"#2af6de",text:"Hard Trance"},{color:"#ffdd28",text:"Big Room"},{color:"#3dffab",text:"Deep House"},{color:"#d8ff3e",text:"Tech House"},{color:"#d9b2ff",text:"Hard Techno"},{color:"#ff6b6b",text:"Microhouse"},{color:"#4ecdc4",text:"Electro Swing"},{color:"#45b7d1",text:"Bollywood"},{color:"#96ceb4",text:"Celtic Folk"},{color:"#ffeaa7",text:"Americana"},{color:"#c19a6b",text:"Western"},{color:"#dda0dd",text:"Delta Blues"},{color:"#ffb347",text:"Chicago Blues"},{color:"#98d8c8",text:"Smooth Jazz"},{color:"#9900ff",text:"Bebop"},{color:"#5200ff",text:"Swing"},{color:"#ff25f6",text:"Latin Jazz"},{color:"#2af6de",text:"Baroque"},{color:"#ffdd28",text:"Orchestral Suite"},{color:"#3dffab",text:"Choir"},{color:"#d8ff3e",text:"Gregorian"},{color:"#d9b2ff",text:"Middle Eastern"},{color:"#ff6b6b",text:"Japanese Instrumental"},{color:"#ff6b6b",text:"Phonk"},{color:"#4ecdc4",text:"Jersey Club"},{color:"#45b7d1",text:"Baile Funk"},{color:"#96ceb4",text:"UK Drill"},{color:"#ffeaa7",text:"Footwork"},{color:"#dda0dd",text:"Juke"},{color:"#ffb347",text:"Future Rave"},{color:"#98d8c8",text:"Afro Tech"},{color:"#9900ff",text:"French House"},{color:"#5200ff",text:"Nu Disco"},{color:"#ff25f6",text:"Italo Disco"},{color:"#2af6de",text:"G-House"},{color:"#ffdd28",text:"Hardwave"},{color:"#3dffab",text:"Eurodance"},{color:"#d8ff3e",text:"Liquid Funk"},{color:"#d9b2ff",text:"Dub Techno"},{color:"#ff6b6b",text:"Breakcore"},{color:"#4ecdc4",text:"Drill & Bass"},{color:"#45b7d1",text:"Organic House"},{color:"#96ceb4",text:"Melodic House"},{color:"#ffeaa7",text:"Detroit Techno"},{color:"#dda0dd",text:"Minimal Techno"},{color:"#ffb347",text:"Lo-Fi House"},{color:"#98d8c8",text:"Ambient Dub"},{color:"#9900ff",text:"Vapor Trap"},{color:"#5200ff",text:"Dream Pop"},{color:"#ff25f6",text:"Indie Pop"},{color:"#2af6de",text:"Midwest Emo"},{color:"#ffdd28",text:"Kawaii Future Bass"},{color:"#3dffab",text:"UK Funky"},{color:"#d8ff3e",text:"Kuduro"},{color:"#d9b2ff",text:"Batida"},{color:"#c19a6b",text:"Neoclassical"},{color:"#ff6b6b",text:"Dark Trap"},{color:"#4ecdc4",text:"Afro Trap"},{color:"#45b7d1",text:"Dungeon Synth"},{color:"#ffd166",text:"Gospel"}];iv();
